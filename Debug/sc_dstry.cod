; Listing generated by Microsoft (R) Optimizing Compiler Version 19.16.27045.0 

	TITLE	C:\Users\nhv90\Projects\eech\aphavoc\source\entity\special\sector\sc_dstry.c
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB MSVCRTD
INCLUDELIB OLDNAMES

PUBLIC	?overload_sector_destroy_functions@@YGXXZ	; overload_sector_destroy_functions
PUBLIC	?destroy_local_sector_entities@@YGXXZ		; destroy_local_sector_entities
EXTRN	?free_mem@@YGXPAX@Z:PROC			; free_mem
EXTRN	?unlink_local_entity_children@@YGXPAUENTITY@@W4LIST_TYPES@@@Z:PROC ; unlink_local_entity_children
EXTRN	?destroy_local_entity@@YGXPAUENTITY@@@Z:PROC	; destroy_local_entity
EXTRN	?destroy_local_entity_children@@YGXPAUENTITY@@W4LIST_TYPES@@@Z:PROC ; destroy_local_entity_children
EXTRN	?set_free_entity@@YGXPAUENTITY@@@Z:PROC		; set_free_entity
EXTRN	?world_map@@3UWORLD_MAP_DATA@@A:BYTE		; world_map
EXTRN	?fn_destroy_local_entity@@3PAP6GXPAUENTITY@@@ZA:BYTE ; fn_destroy_local_entity
EXTRN	?fn_destroy_local_entity_family@@3PAP6GXPAUENTITY@@@ZA:BYTE ; fn_destroy_local_entity_family
EXTRN	?fn_kill_local_entity@@3PAP6GXPAUENTITY@@@ZA:BYTE ; fn_kill_local_entity
EXTRN	?entity_sector_map@@3PAPAUENTITY@@A:DWORD	; entity_sector_map
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\special\sector\sc_dstry.c
;	COMDAT ?destroy_local@@YGXPAUENTITY@@@Z
_TEXT	SEGMENT
_raw$ = -4						; size = 4
_en$ = 8						; size = 4
?destroy_local@@YGXPAUENTITY@@@Z PROC			; destroy_local, COMDAT

; 80   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 44	 sub	 esp, 68			; 00000044H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 81   : 	sector
; 82   : 		*raw;
; 83   : 
; 84   : 	////////////////////////////////////////
; 85   : 	//
; 86   : 	// PRE-AMBLE
; 87   : 	//
; 88   : 	////////////////////////////////////////
; 89   : 
; 90   : 	#if DEBUG_MODULE
; 91   : 
; 92   : 	debug_log_entity_args (ENTITY_DEBUG_LOCAL, ENTITY_DEBUG_DESTROY, en);
; 93   : 
; 94   : 	#endif
; 95   : 
; 96   : 	raw = (sector *) get_local_entity_data (en);

  00009	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  0000c	8b 48 04	 mov	 ecx, DWORD PTR [eax+4]
  0000f	89 4d fc	 mov	 DWORD PTR _raw$[ebp], ecx

; 97   : 
; 98   : 	////////////////////////////////////////
; 99   : 	//
; 100  : 	// VALIDATE
; 101  : 	//
; 102  : 	////////////////////////////////////////
; 103  : 
; 104  : 	////////////////////////////////////////
; 105  : 	//
; 106  : 	// DESTROY COMPONENTS
; 107  : 	//
; 108  : 	////////////////////////////////////////
; 109  : 
; 110  : 	////////////////////////////////////////
; 111  : 	//
; 112  : 	// UNLINK FROM SYSTEM
; 113  : 	//
; 114  : 	////////////////////////////////////////
; 115  : 
; 116  : 	destroy_local_entity_children (en, LIST_TYPE_SPECIAL_EFFECT);

  00012	6a 24		 push	 36			; 00000024H
  00014	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  00017	50		 push	 eax
  00018	e8 00 00 00 00	 call	 ?destroy_local_entity_children@@YGXPAUENTITY@@W4LIST_TYPES@@@Z ; destroy_local_entity_children

; 117  : 
; 118  : 	unlink_local_entity_children (en, LIST_TYPE_SECTOR);

  0001d	6a 21		 push	 33			; 00000021H
  0001f	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  00022	50		 push	 eax
  00023	e8 00 00 00 00	 call	 ?unlink_local_entity_children@@YGXPAUENTITY@@W4LIST_TYPES@@@Z ; unlink_local_entity_children

; 119  : 
; 120  : 	////////////////////////////////////////
; 121  : 	//
; 122  : 	// FREE ENTITY DATA
; 123  : 	//
; 124  : 	////////////////////////////////////////
; 125  : 
; 126  : 	free_mem (raw);

  00028	8b 45 fc	 mov	 eax, DWORD PTR _raw$[ebp]
  0002b	50		 push	 eax
  0002c	e8 00 00 00 00	 call	 ?free_mem@@YGXPAX@Z	; free_mem

; 127  : 
; 128  : 	set_free_entity (en);

  00031	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  00034	50		 push	 eax
  00035	e8 00 00 00 00	 call	 ?set_free_entity@@YGXPAUENTITY@@@Z ; set_free_entity

; 129  : }

  0003a	5f		 pop	 edi
  0003b	5e		 pop	 esi
  0003c	5b		 pop	 ebx
  0003d	8b e5		 mov	 esp, ebp
  0003f	5d		 pop	 ebp
  00040	c2 04 00	 ret	 4
?destroy_local@@YGXPAUENTITY@@@Z ENDP			; destroy_local
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\special\sector\sc_dstry.c
;	COMDAT ?destroy_local_sector_entities@@YGXXZ
_TEXT	SEGMENT
_z_sec$ = -8						; size = 4
_x_sec$ = -4						; size = 4
?destroy_local_sector_entities@@YGXXZ PROC		; destroy_local_sector_entities, COMDAT

; 149  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 48	 sub	 esp, 72			; 00000048H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 150  : 
; 151  : 	int
; 152  : 		x_sec,
; 153  : 		z_sec;
; 154  : 
; 155  : 	if (entity_sector_map)

  00009	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?entity_sector_map@@3PAPAUENTITY@@A, 0 ; entity_sector_map
  00010	0f 84 8c 00 00
	00		 je	 $LN1@destroy_lo

; 156  : 	{
; 157  : 
; 158  : 		for (z_sec = MIN_MAP_Z_SECTOR; z_sec <= MAX_MAP_Z_SECTOR; z_sec++)

  00016	a1 18 00 00 00	 mov	 eax, DWORD PTR ?world_map@@3UWORLD_MAP_DATA@@A+24
  0001b	89 45 f8	 mov	 DWORD PTR _z_sec$[ebp], eax
  0001e	eb 09		 jmp	 SHORT $LN4@destroy_lo
$LN2@destroy_lo:
  00020	8b 45 f8	 mov	 eax, DWORD PTR _z_sec$[ebp]
  00023	83 c0 01	 add	 eax, 1
  00026	89 45 f8	 mov	 DWORD PTR _z_sec$[ebp], eax
$LN4@destroy_lo:
  00029	8b 45 f8	 mov	 eax, DWORD PTR _z_sec$[ebp]
  0002c	3b 05 20 00 00
	00		 cmp	 eax, DWORD PTR ?world_map@@3UWORLD_MAP_DATA@@A+32
  00032	7f 59		 jg	 SHORT $LN3@destroy_lo

; 159  : 		{
; 160  : 
; 161  : 			for (x_sec = MIN_MAP_X_SECTOR; x_sec <= MAX_MAP_X_SECTOR; x_sec++)

  00034	a1 14 00 00 00	 mov	 eax, DWORD PTR ?world_map@@3UWORLD_MAP_DATA@@A+20
  00039	89 45 fc	 mov	 DWORD PTR _x_sec$[ebp], eax
  0003c	eb 09		 jmp	 SHORT $LN7@destroy_lo
$LN5@destroy_lo:
  0003e	8b 45 fc	 mov	 eax, DWORD PTR _x_sec$[ebp]
  00041	83 c0 01	 add	 eax, 1
  00044	89 45 fc	 mov	 DWORD PTR _x_sec$[ebp], eax
$LN7@destroy_lo:
  00047	8b 45 fc	 mov	 eax, DWORD PTR _x_sec$[ebp]
  0004a	3b 05 1c 00 00
	00		 cmp	 eax, DWORD PTR ?world_map@@3UWORLD_MAP_DATA@@A+28
  00050	7f 39		 jg	 SHORT $LN6@destroy_lo

; 162  : 			{
; 163  : 
; 164  : 				if (entity_sector_map [x_sec + (z_sec * NUM_MAP_X_SECTORS)]->type != ENTITY_TYPE_UNKNOWN)

  00052	8b 45 f8	 mov	 eax, DWORD PTR _z_sec$[ebp]
  00055	0f af 05 08 00
	00 00		 imul	 eax, DWORD PTR ?world_map@@3UWORLD_MAP_DATA@@A+8
  0005c	03 45 fc	 add	 eax, DWORD PTR _x_sec$[ebp]
  0005f	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?entity_sector_map@@3PAPAUENTITY@@A ; entity_sector_map
  00065	8b 14 81	 mov	 edx, DWORD PTR [ecx+eax*4]
  00068	83 3a 00	 cmp	 DWORD PTR [edx], 0
  0006b	74 1c		 je	 SHORT $LN9@destroy_lo

; 165  : 				{
; 166  : 
; 167  : 					destroy_local_entity (entity_sector_map [x_sec + (z_sec * NUM_MAP_X_SECTORS)]);

  0006d	8b 45 f8	 mov	 eax, DWORD PTR _z_sec$[ebp]
  00070	0f af 05 08 00
	00 00		 imul	 eax, DWORD PTR ?world_map@@3UWORLD_MAP_DATA@@A+8
  00077	03 45 fc	 add	 eax, DWORD PTR _x_sec$[ebp]
  0007a	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?entity_sector_map@@3PAPAUENTITY@@A ; entity_sector_map
  00080	8b 14 81	 mov	 edx, DWORD PTR [ecx+eax*4]
  00083	52		 push	 edx
  00084	e8 00 00 00 00	 call	 ?destroy_local_entity@@YGXPAUENTITY@@@Z ; destroy_local_entity
$LN9@destroy_lo:

; 168  : 				}
; 169  : 			}

  00089	eb b3		 jmp	 SHORT $LN5@destroy_lo
$LN6@destroy_lo:

; 170  : 		}

  0008b	eb 93		 jmp	 SHORT $LN2@destroy_lo
$LN3@destroy_lo:

; 171  : 
; 172  : 		free_mem (entity_sector_map);

  0008d	a1 00 00 00 00	 mov	 eax, DWORD PTR ?entity_sector_map@@3PAPAUENTITY@@A ; entity_sector_map
  00092	50		 push	 eax
  00093	e8 00 00 00 00	 call	 ?free_mem@@YGXPAX@Z	; free_mem

; 173  : 
; 174  : 		entity_sector_map = NULL;

  00098	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?entity_sector_map@@3PAPAUENTITY@@A, 0 ; entity_sector_map
$LN1@destroy_lo:

; 175  : 	}
; 176  : }

  000a2	5f		 pop	 edi
  000a3	5e		 pop	 esi
  000a4	5b		 pop	 ebx
  000a5	8b e5		 mov	 esp, ebp
  000a7	5d		 pop	 ebp
  000a8	c3		 ret	 0
?destroy_local_sector_entities@@YGXXZ ENDP		; destroy_local_sector_entities
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\special\sector\sc_dstry.c
;	COMDAT ?overload_sector_destroy_functions@@YGXXZ
_TEXT	SEGMENT
?overload_sector_destroy_functions@@YGXXZ PROC		; overload_sector_destroy_functions, COMDAT

; 136  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 40	 sub	 esp, 64			; 00000040H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 137  : 	fn_destroy_local_entity				[ENTITY_TYPE_SECTOR]	= destroy_local;

  00009	b8 04 00 00 00	 mov	 eax, 4
  0000e	6b c8 19	 imul	 ecx, eax, 25
  00011	c7 81 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?fn_destroy_local_entity@@3PAP6GXPAUENTITY@@@ZA[ecx], OFFSET ?destroy_local@@YGXPAUENTITY@@@Z ; destroy_local

; 138  : 
; 139  : 	fn_destroy_local_entity_family	[ENTITY_TYPE_SECTOR]	= destroy_local;

  0001b	b8 04 00 00 00	 mov	 eax, 4
  00020	6b c8 19	 imul	 ecx, eax, 25
  00023	c7 81 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?fn_destroy_local_entity_family@@3PAP6GXPAUENTITY@@@ZA[ecx], OFFSET ?destroy_local@@YGXPAUENTITY@@@Z ; destroy_local

; 140  : 
; 141  : 	fn_kill_local_entity					[ENTITY_TYPE_SECTOR]	= destroy_local;

  0002d	b8 04 00 00 00	 mov	 eax, 4
  00032	6b c8 19	 imul	 ecx, eax, 25
  00035	c7 81 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?fn_kill_local_entity@@3PAP6GXPAUENTITY@@@ZA[ecx], OFFSET ?destroy_local@@YGXPAUENTITY@@@Z ; destroy_local

; 142  : }

  0003f	5f		 pop	 edi
  00040	5e		 pop	 esi
  00041	5b		 pop	 ebx
  00042	8b e5		 mov	 esp, ebp
  00044	5d		 pop	 ebp
  00045	c3		 ret	 0
?overload_sector_destroy_functions@@YGXXZ ENDP		; overload_sector_destroy_functions
_TEXT	ENDS
END
