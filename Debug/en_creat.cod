; Listing generated by Microsoft (R) Optimizing Compiler Version 19.16.27045.0 

	TITLE	C:\Users\nhv90\Projects\eech\aphavoc\source\entity\system\en_funcs\en_creat.c
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB MSVCRTD
INCLUDELIB OLDNAMES

PUBLIC	?fn_create_local_entity@@3PAP6GPAUENTITY@@W4ENTITY_TYPES@@HPAD@ZA ; fn_create_local_entity
PUBLIC	?fn_create_client_server_entity@@3PAY01P6GPAUENTITY@@W4ENTITY_TYPES@@HPAD@ZA ; fn_create_client_server_entity
PUBLIC	?force_local_entity_create_stack_attributes@@3HA ; force_local_entity_create_stack_attributes
_BSS	SEGMENT
?fn_create_local_entity@@3PAP6GPAUENTITY@@W4ENTITY_TYPES@@HPAD@ZA DD 026H DUP (?) ; fn_create_local_entity
?fn_create_client_server_entity@@3PAY01P6GPAUENTITY@@W4ENTITY_TYPES@@HPAD@ZA DD 04cH DUP (?) ; fn_create_client_server_entity
?force_local_entity_create_stack_attributes@@3HA DD 01H DUP (?) ; force_local_entity_create_stack_attributes
_BSS	ENDS
PUBLIC	?initialise_entity_create_default_functions@@YGXXZ ; initialise_entity_create_default_functions
PUBLIC	?create_local_entity@@YAPAUENTITY@@W4ENTITY_TYPES@@HZZ ; create_local_entity
PUBLIC	?create_client_server_entity@@YAPAUENTITY@@W4ENTITY_TYPES@@HZZ ; create_client_server_entity
PUBLIC	?create_local_only_entities@@YGXW4PACK_MODES@@@Z ; create_local_only_entities
PUBLIC	??_C@_0CP@ICMAFCE@default_create_entity?5invoked?3?5@ ; `string'
PUBLIC	?__LINE__Var@?0??create_local_entity@@YAPAUENTITY@@W4ENTITY_TYPES@@HZZ@4JA ; `create_local_entity'::`1'::__LINE__Var
PUBLIC	??_C@_0EO@GMGJFIAE@c?3?2users?2nhv90?2projects?2eech?2ap@ ; `string'
PUBLIC	??_C@_0DK@FHKBEOGD@?$CItype?5?$DO?5ENTITY_TYPE_UNKNOWN?$CJ?5?$CG?$CG@ ; `string'
PUBLIC	??_C@_0GA@OBFDBJAE@?$CB?$CI?$CIget_comms_data_flow?5?$CI?$CJ?5?$DN?$DN?5CO@ ; `string'
PUBLIC	??_C@_0FB@HFCJELOJ@EN_CREATE?3?5CREATE_LOCAL_ENTITY?5@ ; `string'
PUBLIC	?__LINE__Var@?0??create_client_server_entity@@YAPAUENTITY@@W4ENTITY_TYPES@@HZZ@4JA ; `create_client_server_entity'::`1'::__LINE__Var
PUBLIC	??_C@_0FJ@GBGFHIGK@EN_CREATE?3?5CREATE_CLIENT_SERVER@ ; `string'
EXTRN	?process_assert@@YGXPBD0H@Z:PROC		; process_assert
EXTRN	?debug_fatal@@YAXPBDZZ:PROC			; debug_fatal
EXTRN	?set_comms_data_flow@@YGXW4COMMS_DATA_FLOW_TYPES@@@Z:PROC ; set_comms_data_flow
EXTRN	?set_comms_model@@YGXW4COMMS_MODEL_TYPES@@@Z:PROC ; set_comms_model
EXTRN	?update_create_entity_statistics@@YGXW4ENTITY_TYPES@@@Z:PROC ; update_create_entity_statistics
EXTRN	?enable_entity_comms_messages@@YGXXZ:PROC	; enable_entity_comms_messages
EXTRN	?disable_entity_comms_messages@@YGXXZ:PROC	; disable_entity_comms_messages
EXTRN	?create_local_pylon_entities@@YGXW4PACK_MODES@@@Z:PROC ; create_local_pylon_entities
EXTRN	?create_local_bridge_entities@@YGXW4PACK_MODES@@@Z:PROC ; create_local_bridge_entities
EXTRN	?create_local_camera_entity@@YGXXZ:PROC		; create_local_camera_entity
EXTRN	?create_local_sector_entities@@YGXXZ:PROC	; create_local_sector_entities
EXTRN	?create_local_update_entity@@YGXXZ:PROC		; create_local_update_entity
EXTRN	?entity_type_database@@3PAUENTITY_TYPE_DATA@@A:BYTE ; entity_type_database
EXTRN	?system_comms_model@@3W4COMMS_MODEL_TYPES@@A:DWORD ; system_comms_model
EXTRN	?system_comms_data_flow@@3W4COMMS_DATA_FLOW_TYPES@@A:DWORD ; system_comms_data_flow
EXTRN	?number_of_entities@@3HA:DWORD			; number_of_entities
;	COMDAT ??_C@_0FJ@GBGFHIGK@EN_CREATE?3?5CREATE_CLIENT_SERVER@
CONST	SEGMENT
??_C@_0FJ@GBGFHIGK@EN_CREATE?3?5CREATE_CLIENT_SERVER@ DB 'EN_CREATE: CREA'
	DB	'TE_CLIENT_SERVER_ENTITY : unable to create entity %s. Limit o'
	DB	'f %d reached', 00H				; `string'
CONST	ENDS
;	COMDAT ?__LINE__Var@?0??create_client_server_entity@@YAPAUENTITY@@W4ENTITY_TYPES@@HZZ@4JA
_DATA	SEGMENT
?__LINE__Var@?0??create_client_server_entity@@YAPAUENTITY@@W4ENTITY_TYPES@@HZZ@4JA DD 012bH ; `create_client_server_entity'::`1'::__LINE__Var
_DATA	ENDS
;	COMDAT ??_C@_0FB@HFCJELOJ@EN_CREATE?3?5CREATE_LOCAL_ENTITY?5@
CONST	SEGMENT
??_C@_0FB@HFCJELOJ@EN_CREATE?3?5CREATE_LOCAL_ENTITY?5@ DB 'EN_CREATE: CRE'
	DB	'ATE_LOCAL_ENTITY : unable to create entity %s. Limit of %d re'
	DB	'ached', 00H					; `string'
CONST	ENDS
;	COMDAT ??_C@_0GA@OBFDBJAE@?$CB?$CI?$CIget_comms_data_flow?5?$CI?$CJ?5?$DN?$DN?5CO@
CONST	SEGMENT
??_C@_0GA@OBFDBJAE@?$CB?$CI?$CIget_comms_data_flow?5?$CI?$CJ?5?$DN?$DN?5CO@ DB '!'
	DB	'((get_comms_data_flow () == COMMS_DATA_FLOW_TX) && force_loca'
	DB	'l_entity_create_stack_attributes)', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0DK@FHKBEOGD@?$CItype?5?$DO?5ENTITY_TYPE_UNKNOWN?$CJ?5?$CG?$CG@
CONST	SEGMENT
??_C@_0DK@FHKBEOGD@?$CItype?5?$DO?5ENTITY_TYPE_UNKNOWN?$CJ?5?$CG?$CG@ DB '('
	DB	'type > ENTITY_TYPE_UNKNOWN) && (type < NUM_ENTITY_TYPES)', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0EO@GMGJFIAE@c?3?2users?2nhv90?2projects?2eech?2ap@
CONST	SEGMENT
??_C@_0EO@GMGJFIAE@c?3?2users?2nhv90?2projects?2eech?2ap@ DB 'c:\users\nh'
	DB	'v90\projects\eech\aphavoc\source\entity\system\en_funcs\en_cr'
	DB	'eat.c', 00H					; `string'
CONST	ENDS
;	COMDAT ?__LINE__Var@?0??create_local_entity@@YAPAUENTITY@@W4ENTITY_TYPES@@HZZ@4JA
_DATA	SEGMENT
?__LINE__Var@?0??create_local_entity@@YAPAUENTITY@@W4ENTITY_TYPES@@HZZ@4JA DD 0a3H ; `create_local_entity'::`1'::__LINE__Var
_DATA	ENDS
;	COMDAT ??_C@_0CP@ICMAFCE@default_create_entity?5invoked?3?5@
CONST	SEGMENT
??_C@_0CP@ICMAFCE@default_create_entity?5invoked?3?5@ DB 'default_create_'
	DB	'entity invoked: %s (index = %d)', 00H	; `string'
CONST	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\system\en_funcs\en_creat.c
;	COMDAT ?default_create_entity@@YGPAUENTITY@@W4ENTITY_TYPES@@HPAD@Z
_TEXT	SEGMENT
_type$ = 8						; size = 4
_index$ = 12						; size = 4
_pargs$ = 16						; size = 4
?default_create_entity@@YGPAUENTITY@@W4ENTITY_TYPES@@HPAD@Z PROC ; default_create_entity, COMDAT

; 131  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 40	 sub	 esp, 64			; 00000040H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 132  : 	debug_fatal ("default_create_entity invoked: %s (index = %d)", get_entity_type_name (type), index);

  00009	8b 45 0c	 mov	 eax, DWORD PTR _index$[ebp]
  0000c	50		 push	 eax
  0000d	6b 4d 08 0c	 imul	 ecx, DWORD PTR _type$[ebp], 12
  00011	8b 91 00 00 00
	00		 mov	 edx, DWORD PTR ?entity_type_database@@3PAUENTITY_TYPE_DATA@@A[ecx]
  00017	52		 push	 edx
  00018	68 00 00 00 00	 push	 OFFSET ??_C@_0CP@ICMAFCE@default_create_entity?5invoked?3?5@
  0001d	e8 00 00 00 00	 call	 ?debug_fatal@@YAXPBDZZ	; debug_fatal
  00022	83 c4 0c	 add	 esp, 12			; 0000000cH

; 133  : 
; 134  : 	return (NULL);

  00025	33 c0		 xor	 eax, eax

; 135  : }

  00027	5f		 pop	 edi
  00028	5e		 pop	 esi
  00029	5b		 pop	 ebx
  0002a	8b e5		 mov	 esp, ebp
  0002c	5d		 pop	 ebp
  0002d	c2 0c 00	 ret	 12			; 0000000cH
?default_create_entity@@YGPAUENTITY@@W4ENTITY_TYPES@@HPAD@Z ENDP ; default_create_entity
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\system\en_funcs\en_creat.c
;	COMDAT ?create_local_only_entities@@YGXW4PACK_MODES@@@Z
_TEXT	SEGMENT
_temp_comms_data_flow$ = -8				; size = 4
_temp_comms_model$ = -4					; size = 4
_pack_mode$ = 8						; size = 4
?create_local_only_entities@@YGXW4PACK_MODES@@@Z PROC	; create_local_only_entities, COMDAT

; 393  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 48	 sub	 esp, 72			; 00000048H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 394  : 	comms_model_types
; 395  : 		temp_comms_model;
; 396  : 
; 397  : 	comms_data_flow_types
; 398  : 		temp_comms_data_flow;
; 399  : 
; 400  : 	//
; 401  : 	// store comms model and data flow
; 402  : 	//
; 403  : 
; 404  : 	temp_comms_model = get_comms_model ();

  00009	a1 00 00 00 00	 mov	 eax, DWORD PTR ?system_comms_model@@3W4COMMS_MODEL_TYPES@@A ; system_comms_model
  0000e	89 45 fc	 mov	 DWORD PTR _temp_comms_model$[ebp], eax

; 405  : 
; 406  : 	temp_comms_data_flow = get_comms_data_flow ();

  00011	a1 00 00 00 00	 mov	 eax, DWORD PTR ?system_comms_data_flow@@3W4COMMS_DATA_FLOW_TYPES@@A ; system_comms_data_flow
  00016	89 45 f8	 mov	 DWORD PTR _temp_comms_data_flow$[ebp], eax

; 407  : 
; 408  : 	//
; 409  : 	// set comms model and data flow to SERVER/TX
; 410  : 	//
; 411  : 
; 412  : 	set_comms_model (COMMS_MODEL_SERVER);

  00019	6a 00		 push	 0
  0001b	e8 00 00 00 00	 call	 ?set_comms_model@@YGXW4COMMS_MODEL_TYPES@@@Z ; set_comms_model

; 413  : 
; 414  : 	set_comms_data_flow (COMMS_DATA_FLOW_TX);

  00020	6a 00		 push	 0
  00022	e8 00 00 00 00	 call	 ?set_comms_data_flow@@YGXW4COMMS_DATA_FLOW_TYPES@@@Z ; set_comms_data_flow

; 415  : 
; 416  : 	disable_entity_comms_messages ();

  00027	e8 00 00 00 00	 call	 ?disable_entity_comms_messages@@YGXXZ ; disable_entity_comms_messages

; 417  : 
; 418  : 	//
; 419  : 	// create local only entities
; 420  : 	//
; 421  : 
; 422  : 	create_local_sector_entities ();

  0002c	e8 00 00 00 00	 call	 ?create_local_sector_entities@@YGXXZ ; create_local_sector_entities

; 423  : 
; 424  : 	create_local_pylon_entities (pack_mode);

  00031	8b 45 08	 mov	 eax, DWORD PTR _pack_mode$[ebp]
  00034	50		 push	 eax
  00035	e8 00 00 00 00	 call	 ?create_local_pylon_entities@@YGXW4PACK_MODES@@@Z ; create_local_pylon_entities

; 425  : 
; 426  : 	create_local_bridge_entities (pack_mode);

  0003a	8b 45 08	 mov	 eax, DWORD PTR _pack_mode$[ebp]
  0003d	50		 push	 eax
  0003e	e8 00 00 00 00	 call	 ?create_local_bridge_entities@@YGXW4PACK_MODES@@@Z ; create_local_bridge_entities

; 427  : 
; 428  : 	create_local_update_entity ();

  00043	e8 00 00 00 00	 call	 ?create_local_update_entity@@YGXXZ ; create_local_update_entity

; 429  : 
; 430  : 	// create camera entity now so that it is forced to the end of the update list (updated last)
; 431  : 
; 432  : 	create_local_camera_entity ();

  00048	e8 00 00 00 00	 call	 ?create_local_camera_entity@@YGXXZ ; create_local_camera_entity

; 433  : 
; 434  : 	//
; 435  : 	// restore comms model and data flow
; 436  : 	//
; 437  : 
; 438  : 	set_comms_model (temp_comms_model);

  0004d	8b 45 fc	 mov	 eax, DWORD PTR _temp_comms_model$[ebp]
  00050	50		 push	 eax
  00051	e8 00 00 00 00	 call	 ?set_comms_model@@YGXW4COMMS_MODEL_TYPES@@@Z ; set_comms_model

; 439  : 
; 440  : 	set_comms_data_flow (temp_comms_data_flow);

  00056	8b 45 f8	 mov	 eax, DWORD PTR _temp_comms_data_flow$[ebp]
  00059	50		 push	 eax
  0005a	e8 00 00 00 00	 call	 ?set_comms_data_flow@@YGXW4COMMS_DATA_FLOW_TYPES@@@Z ; set_comms_data_flow

; 441  : 
; 442  : 	enable_entity_comms_messages ();

  0005f	e8 00 00 00 00	 call	 ?enable_entity_comms_messages@@YGXXZ ; enable_entity_comms_messages

; 443  : }

  00064	5f		 pop	 edi
  00065	5e		 pop	 esi
  00066	5b		 pop	 ebx
  00067	8b e5		 mov	 esp, ebp
  00069	5d		 pop	 ebp
  0006a	c2 04 00	 ret	 4
?create_local_only_entities@@YGXW4PACK_MODES@@@Z ENDP	; create_local_only_entities
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\system\en_funcs\en_creat.c
;	COMDAT ?create_client_server_entity@@YAPAUENTITY@@W4ENTITY_TYPES@@HZZ
_TEXT	SEGMENT
_en$ = -12						; size = 4
_pargs_buffer$ = -8					; size = 4
_pargs$ = -4						; size = 4
_type$ = 8						; size = 4
_index$ = 12						; size = 4
?create_client_server_entity@@YAPAUENTITY@@W4ENTITY_TYPES@@HZZ PROC ; create_client_server_entity, COMDAT

; 299  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 50	 sub	 esp, 80			; 00000050H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 300  : 	va_list
; 301  : 		pargs;
; 302  : 
; 303  : 	char
; 304  : 		*pargs_buffer;
; 305  : 
; 306  : 	entity
; 307  : 		*en;
; 308  : 
; 309  : 	ASSERT ((type > ENTITY_TYPE_UNKNOWN) && (type < NUM_ENTITY_TYPES));

  00009	83 7d 08 00	 cmp	 DWORD PTR _type$[ebp], 0
  0000d	7e 06		 jle	 SHORT $LN3@create_cli
  0000f	83 7d 08 26	 cmp	 DWORD PTR _type$[ebp], 38 ; 00000026H
  00013	7c 18		 jl	 SHORT $LN2@create_cli
$LN3@create_cli:
  00015	a1 00 00 00 00	 mov	 eax, DWORD PTR ?__LINE__Var@?0??create_client_server_entity@@YAPAUENTITY@@W4ENTITY_TYPES@@HZZ@4JA
  0001a	83 c0 0a	 add	 eax, 10			; 0000000aH
  0001d	50		 push	 eax
  0001e	68 00 00 00 00	 push	 OFFSET ??_C@_0EO@GMGJFIAE@c?3?2users?2nhv90?2projects?2eech?2ap@
  00023	68 00 00 00 00	 push	 OFFSET ??_C@_0DK@FHKBEOGD@?$CItype?5?$DO?5ENTITY_TYPE_UNKNOWN?$CJ?5?$CG?$CG@
  00028	e8 00 00 00 00	 call	 ?process_assert@@YGXPBD0H@Z ; process_assert
$LN2@create_cli:

; 310  : 
; 311  : 	//
; 312  : 	// safe guard - should never need to force stack attributes during transmit
; 313  : 	//
; 314  : 
; 315  : 	ASSERT (!((get_comms_data_flow () == COMMS_DATA_FLOW_TX) && force_local_entity_create_stack_attributes));

  0002d	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?system_comms_data_flow@@3W4COMMS_DATA_FLOW_TYPES@@A, 0 ; system_comms_data_flow
  00034	75 21		 jne	 SHORT $LN4@create_cli
  00036	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?force_local_entity_create_stack_attributes@@3HA, 0 ; force_local_entity_create_stack_attributes
  0003d	74 18		 je	 SHORT $LN4@create_cli
  0003f	a1 00 00 00 00	 mov	 eax, DWORD PTR ?__LINE__Var@?0??create_client_server_entity@@YAPAUENTITY@@W4ENTITY_TYPES@@HZZ@4JA
  00044	83 c0 10	 add	 eax, 16			; 00000010H
  00047	50		 push	 eax
  00048	68 00 00 00 00	 push	 OFFSET ??_C@_0EO@GMGJFIAE@c?3?2users?2nhv90?2projects?2eech?2ap@
  0004d	68 00 00 00 00	 push	 OFFSET ??_C@_0GA@OBFDBJAE@?$CB?$CI?$CIget_comms_data_flow?5?$CI?$CJ?5?$DN?$DN?5CO@
  00052	e8 00 00 00 00	 call	 ?process_assert@@YGXPBD0H@Z ; process_assert
$LN4@create_cli:

; 316  : 
; 317  : 	//
; 318  : 	// update statistics
; 319  : 	//
; 320  : 
; 321  : 	update_create_entity_statistics (type);

  00057	8b 45 08	 mov	 eax, DWORD PTR _type$[ebp]
  0005a	50		 push	 eax
  0005b	e8 00 00 00 00	 call	 ?update_create_entity_statistics@@YGXW4ENTITY_TYPES@@@Z ; update_create_entity_statistics

; 322  : 
; 323  : 	//
; 324  : 	// sort argument list
; 325  : 	//
; 326  : 
; 327  : 	va_start (pargs, index);

  00060	8d 45 10	 lea	 eax, DWORD PTR _index$[ebp+4]
  00063	89 45 fc	 mov	 DWORD PTR _pargs$[ebp], eax

; 328  : 
; 329  : 	if ((get_comms_data_flow () == COMMS_DATA_FLOW_TX) || force_local_entity_create_stack_attributes)

  00066	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?system_comms_data_flow@@3W4COMMS_DATA_FLOW_TYPES@@A, 0 ; system_comms_data_flow
  0006d	74 09		 je	 SHORT $LN7@create_cli
  0006f	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?force_local_entity_create_stack_attributes@@3HA, 0 ; force_local_entity_create_stack_attributes
  00076	74 08		 je	 SHORT $LN5@create_cli
$LN7@create_cli:

; 330  : 	{
; 331  : 		#ifdef __WATCOMC__
; 332  : 
; 333  : 		pargs_buffer = (char *) *pargs;
; 334  : 
; 335  : 		#else
; 336  : 
; 337  : 		pargs_buffer = (char *) pargs;

  00078	8b 45 fc	 mov	 eax, DWORD PTR _pargs$[ebp]
  0007b	89 45 f8	 mov	 DWORD PTR _pargs_buffer$[ebp], eax

; 338  : 
; 339  : 		#endif
; 340  : 	}
; 341  : 	else

  0007e	eb 12		 jmp	 SHORT $LN6@create_cli
$LN5@create_cli:

; 342  : 	{
; 343  : 		pargs_buffer = va_arg (pargs, char *);

  00080	8b 45 fc	 mov	 eax, DWORD PTR _pargs$[ebp]
  00083	83 c0 04	 add	 eax, 4
  00086	89 45 fc	 mov	 DWORD PTR _pargs$[ebp], eax
  00089	8b 4d fc	 mov	 ecx, DWORD PTR _pargs$[ebp]
  0008c	8b 51 fc	 mov	 edx, DWORD PTR [ecx-4]
  0008f	89 55 f8	 mov	 DWORD PTR _pargs_buffer$[ebp], edx
$LN6@create_cli:

; 344  : 	}
; 345  : 
; 346  : 	va_end (pargs);

  00092	c7 45 fc 00 00
	00 00		 mov	 DWORD PTR _pargs$[ebp], 0

; 347  : 
; 348  : 	//
; 349  : 	// create
; 350  : 	//
; 351  : 
; 352  : 	en = NULL;

  00099	c7 45 f4 00 00
	00 00		 mov	 DWORD PTR _en$[ebp], 0

; 353  : 
; 354  : 	en = fn_create_client_server_entity[type][get_comms_model ()] (type, index, pargs_buffer);

  000a0	8b 45 f8	 mov	 eax, DWORD PTR _pargs_buffer$[ebp]
  000a3	50		 push	 eax
  000a4	8b 4d 0c	 mov	 ecx, DWORD PTR _index$[ebp]
  000a7	51		 push	 ecx
  000a8	8b 55 08	 mov	 edx, DWORD PTR _type$[ebp]
  000ab	52		 push	 edx
  000ac	a1 00 00 00 00	 mov	 eax, DWORD PTR ?system_comms_model@@3W4COMMS_MODEL_TYPES@@A ; system_comms_model
  000b1	c1 e0 02	 shl	 eax, 2
  000b4	8b 4d 08	 mov	 ecx, DWORD PTR _type$[ebp]
  000b7	8b 94 c8 00 00
	00 00		 mov	 edx, DWORD PTR ?fn_create_client_server_entity@@3PAY01P6GPAUENTITY@@W4ENTITY_TYPES@@HPAD@ZA[eax+ecx*8]
  000be	ff d2		 call	 edx
  000c0	89 45 f4	 mov	 DWORD PTR _en$[ebp], eax

; 355  : 
; 356  : 	if ((get_comms_model () == COMMS_MODEL_SERVER) && (!en))

  000c3	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?system_comms_model@@3W4COMMS_MODEL_TYPES@@A, 0 ; system_comms_model
  000ca	75 24		 jne	 SHORT $LN8@create_cli
  000cc	83 7d f4 00	 cmp	 DWORD PTR _en$[ebp], 0
  000d0	75 1e		 jne	 SHORT $LN8@create_cli

; 357  : 	{
; 358  : 
; 359  : 		debug_fatal ("EN_CREATE: CREATE_CLIENT_SERVER_ENTITY : unable to create entity %s. Limit of %d reached", get_entity_type_name (type), number_of_entities);

  000d2	a1 00 00 00 00	 mov	 eax, DWORD PTR ?number_of_entities@@3HA ; number_of_entities
  000d7	50		 push	 eax
  000d8	6b 4d 08 0c	 imul	 ecx, DWORD PTR _type$[ebp], 12
  000dc	8b 91 00 00 00
	00		 mov	 edx, DWORD PTR ?entity_type_database@@3PAUENTITY_TYPE_DATA@@A[ecx]
  000e2	52		 push	 edx
  000e3	68 00 00 00 00	 push	 OFFSET ??_C@_0FJ@GBGFHIGK@EN_CREATE?3?5CREATE_CLIENT_SERVER@
  000e8	e8 00 00 00 00	 call	 ?debug_fatal@@YAXPBDZZ	; debug_fatal
  000ed	83 c4 0c	 add	 esp, 12			; 0000000cH
$LN8@create_cli:

; 360  : 	}
; 361  : 
; 362  : 	#if DEBUG_MODULE
; 363  : 
; 364  : 	switch (get_local_entity_type (en))
; 365  : 	{
; 366  : 
; 367  : 		case ENTITY_TYPE_SEGMENT:
; 368  : 		case ENTITY_TYPE_SECTOR:
; 369  : 		case ENTITY_TYPE_CITY_BUILDING:
; 370  : 		{
; 371  : 
; 372  : 			break;
; 373  : 		}
; 374  : 		default:
; 375  : 		{
; 376  : 
; 377  : 			debug_log ("EN_CREAT : CS Created %s (index %d), sub_type %d", entity_type_names [type], get_local_entity_index (en), get_local_entity_int_value (en, INT_TYPE_ENTITY_SUB_TYPE));
; 378  : 
; 379  : 			break;
; 380  : 		} 
; 381  : 	}
; 382  : 
; 383  : 	#endif
; 384  : 
; 385  : 	return (en);

  000f0	8b 45 f4	 mov	 eax, DWORD PTR _en$[ebp]

; 386  : }

  000f3	5f		 pop	 edi
  000f4	5e		 pop	 esi
  000f5	5b		 pop	 ebx
  000f6	8b e5		 mov	 esp, ebp
  000f8	5d		 pop	 ebp
  000f9	c3		 ret	 0
?create_client_server_entity@@YAPAUENTITY@@W4ENTITY_TYPES@@HZZ ENDP ; create_client_server_entity
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\system\en_funcs\en_creat.c
;	COMDAT ?create_local_entity@@YAPAUENTITY@@W4ENTITY_TYPES@@HZZ
_TEXT	SEGMENT
_en$ = -12						; size = 4
_pargs_buffer$ = -8					; size = 4
_pargs$ = -4						; size = 4
_type$ = 8						; size = 4
_index$ = 12						; size = 4
?create_local_entity@@YAPAUENTITY@@W4ENTITY_TYPES@@HZZ PROC ; create_local_entity, COMDAT

; 163  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 50	 sub	 esp, 80			; 00000050H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 164  : 	va_list
; 165  : 		pargs;
; 166  : 
; 167  : 	char
; 168  : 		*pargs_buffer;
; 169  : 
; 170  : 	entity
; 171  : 		*en;
; 172  : 
; 173  : 	ASSERT ((type > ENTITY_TYPE_UNKNOWN) && (type < NUM_ENTITY_TYPES));

  00009	83 7d 08 00	 cmp	 DWORD PTR _type$[ebp], 0
  0000d	7e 06		 jle	 SHORT $LN3@create_loc
  0000f	83 7d 08 26	 cmp	 DWORD PTR _type$[ebp], 38 ; 00000026H
  00013	7c 18		 jl	 SHORT $LN2@create_loc
$LN3@create_loc:
  00015	a1 00 00 00 00	 mov	 eax, DWORD PTR ?__LINE__Var@?0??create_local_entity@@YAPAUENTITY@@W4ENTITY_TYPES@@HZZ@4JA
  0001a	83 c0 0a	 add	 eax, 10			; 0000000aH
  0001d	50		 push	 eax
  0001e	68 00 00 00 00	 push	 OFFSET ??_C@_0EO@GMGJFIAE@c?3?2users?2nhv90?2projects?2eech?2ap@
  00023	68 00 00 00 00	 push	 OFFSET ??_C@_0DK@FHKBEOGD@?$CItype?5?$DO?5ENTITY_TYPE_UNKNOWN?$CJ?5?$CG?$CG@
  00028	e8 00 00 00 00	 call	 ?process_assert@@YGXPBD0H@Z ; process_assert
$LN2@create_loc:

; 174  : 
; 175  : 	//
; 176  : 	// safe guard - should never need to force stack attributes during transmit
; 177  : 	//
; 178  : 
; 179  : 	ASSERT (!((get_comms_data_flow () == COMMS_DATA_FLOW_TX) && force_local_entity_create_stack_attributes));

  0002d	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?system_comms_data_flow@@3W4COMMS_DATA_FLOW_TYPES@@A, 0 ; system_comms_data_flow
  00034	75 21		 jne	 SHORT $LN4@create_loc
  00036	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?force_local_entity_create_stack_attributes@@3HA, 0 ; force_local_entity_create_stack_attributes
  0003d	74 18		 je	 SHORT $LN4@create_loc
  0003f	a1 00 00 00 00	 mov	 eax, DWORD PTR ?__LINE__Var@?0??create_local_entity@@YAPAUENTITY@@W4ENTITY_TYPES@@HZZ@4JA
  00044	83 c0 10	 add	 eax, 16			; 00000010H
  00047	50		 push	 eax
  00048	68 00 00 00 00	 push	 OFFSET ??_C@_0EO@GMGJFIAE@c?3?2users?2nhv90?2projects?2eech?2ap@
  0004d	68 00 00 00 00	 push	 OFFSET ??_C@_0GA@OBFDBJAE@?$CB?$CI?$CIget_comms_data_flow?5?$CI?$CJ?5?$DN?$DN?5CO@
  00052	e8 00 00 00 00	 call	 ?process_assert@@YGXPBD0H@Z ; process_assert
$LN4@create_loc:

; 180  : 
; 181  : 	//
; 182  : 	// update statistics
; 183  : 	//
; 184  : 
; 185  : 	update_create_entity_statistics (type);

  00057	8b 45 08	 mov	 eax, DWORD PTR _type$[ebp]
  0005a	50		 push	 eax
  0005b	e8 00 00 00 00	 call	 ?update_create_entity_statistics@@YGXW4ENTITY_TYPES@@@Z ; update_create_entity_statistics

; 186  : 
; 187  : 	//
; 188  : 	// sort argument list
; 189  : 	//
; 190  : 
; 191  : 	va_start (pargs, index);

  00060	8d 45 10	 lea	 eax, DWORD PTR _index$[ebp+4]
  00063	89 45 fc	 mov	 DWORD PTR _pargs$[ebp], eax

; 192  : 
; 193  : 	if ((get_comms_data_flow () == COMMS_DATA_FLOW_TX) || force_local_entity_create_stack_attributes)

  00066	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?system_comms_data_flow@@3W4COMMS_DATA_FLOW_TYPES@@A, 0 ; system_comms_data_flow
  0006d	74 09		 je	 SHORT $LN7@create_loc
  0006f	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?force_local_entity_create_stack_attributes@@3HA, 0 ; force_local_entity_create_stack_attributes
  00076	74 08		 je	 SHORT $LN5@create_loc
$LN7@create_loc:

; 194  : 	{
; 195  : 		#ifdef __WATCOMC__
; 196  : 
; 197  : 		pargs_buffer = (char *) *pargs;
; 198  : 
; 199  : 		#else
; 200  : 
; 201  : 		pargs_buffer = (char *) pargs;

  00078	8b 45 fc	 mov	 eax, DWORD PTR _pargs$[ebp]
  0007b	89 45 f8	 mov	 DWORD PTR _pargs_buffer$[ebp], eax

; 202  : 
; 203  : 		#endif
; 204  : 	}
; 205  : 	else

  0007e	eb 12		 jmp	 SHORT $LN6@create_loc
$LN5@create_loc:

; 206  : 	{
; 207  : 		pargs_buffer = va_arg (pargs, char *);

  00080	8b 45 fc	 mov	 eax, DWORD PTR _pargs$[ebp]
  00083	83 c0 04	 add	 eax, 4
  00086	89 45 fc	 mov	 DWORD PTR _pargs$[ebp], eax
  00089	8b 4d fc	 mov	 ecx, DWORD PTR _pargs$[ebp]
  0008c	8b 51 fc	 mov	 edx, DWORD PTR [ecx-4]
  0008f	89 55 f8	 mov	 DWORD PTR _pargs_buffer$[ebp], edx
$LN6@create_loc:

; 208  : 	}
; 209  : 
; 210  : 	va_end (pargs);

  00092	c7 45 fc 00 00
	00 00		 mov	 DWORD PTR _pargs$[ebp], 0

; 211  : 
; 212  : 	//
; 213  : 	// create
; 214  : 	//
; 215  : 
; 216  : 	en = NULL;

  00099	c7 45 f4 00 00
	00 00		 mov	 DWORD PTR _en$[ebp], 0

; 217  : 
; 218  : 	en = fn_create_local_entity[type] (type, index, pargs_buffer);

  000a0	8b 45 f8	 mov	 eax, DWORD PTR _pargs_buffer$[ebp]
  000a3	50		 push	 eax
  000a4	8b 4d 0c	 mov	 ecx, DWORD PTR _index$[ebp]
  000a7	51		 push	 ecx
  000a8	8b 55 08	 mov	 edx, DWORD PTR _type$[ebp]
  000ab	52		 push	 edx
  000ac	8b 45 08	 mov	 eax, DWORD PTR _type$[ebp]
  000af	8b 0c 85 00 00
	00 00		 mov	 ecx, DWORD PTR ?fn_create_local_entity@@3PAP6GPAUENTITY@@W4ENTITY_TYPES@@HPAD@ZA[eax*4]
  000b6	ff d1		 call	 ecx
  000b8	89 45 f4	 mov	 DWORD PTR _en$[ebp], eax

; 219  : 
; 220  : 	if (!en)

  000bb	83 7d f4 00	 cmp	 DWORD PTR _en$[ebp], 0
  000bf	75 1e		 jne	 SHORT $LN8@create_loc

; 221  : 	{
; 222  : 
; 223  : 		debug_fatal ("EN_CREATE: CREATE_LOCAL_ENTITY : unable to create entity %s. Limit of %d reached", get_entity_type_name (type), number_of_entities);

  000c1	a1 00 00 00 00	 mov	 eax, DWORD PTR ?number_of_entities@@3HA ; number_of_entities
  000c6	50		 push	 eax
  000c7	6b 4d 08 0c	 imul	 ecx, DWORD PTR _type$[ebp], 12
  000cb	8b 91 00 00 00
	00		 mov	 edx, DWORD PTR ?entity_type_database@@3PAUENTITY_TYPE_DATA@@A[ecx]
  000d1	52		 push	 edx
  000d2	68 00 00 00 00	 push	 OFFSET ??_C@_0FB@HFCJELOJ@EN_CREATE?3?5CREATE_LOCAL_ENTITY?5@
  000d7	e8 00 00 00 00	 call	 ?debug_fatal@@YAXPBDZZ	; debug_fatal
  000dc	83 c4 0c	 add	 esp, 12			; 0000000cH
$LN8@create_loc:

; 224  : 	}
; 225  : 
; 226  : 	#if DEBUG_MODULE
; 227  : 	{
; 228  : 
; 229  : 		static int
; 230  : 			reported_segment = FALSE,
; 231  : 			reported_city_building = FALSE,
; 232  : 			reported_sector = FALSE;
; 233  : 	
; 234  : 		switch (get_local_entity_type (en))
; 235  : 		{
; 236  : 
; 237  : 			case ENTITY_TYPE_SEGMENT:
; 238  : 			case ENTITY_TYPE_SECTOR:
; 239  : 			case ENTITY_TYPE_CITY_BUILDING:
; 240  : 			{
; 241  : 	
; 242  : 				if (get_local_entity_type (en) == ENTITY_TYPE_SEGMENT)
; 243  : 				{
; 244  : 		
; 245  : 					if (reported_segment)
; 246  : 					{
; 247  : 		
; 248  : 						break;
; 249  : 					}
; 250  : 		
; 251  : 					reported_segment = TRUE;
; 252  : 				}
; 253  : 	
; 254  : 				if (get_local_entity_type (en) == ENTITY_TYPE_SECTOR)
; 255  : 				{
; 256  : 		
; 257  : 					if (reported_sector)
; 258  : 					{
; 259  : 		
; 260  : 						break;
; 261  : 					}
; 262  : 		
; 263  : 					reported_sector = TRUE;
; 264  : 				}
; 265  : 	
; 266  : 				if (get_local_entity_type (en) == ENTITY_TYPE_CITY_BUILDING)
; 267  : 				{
; 268  : 		
; 269  : 					if (reported_city_building)
; 270  : 					{
; 271  : 		
; 272  : 						break;
; 273  : 					}
; 274  : 		
; 275  : 					reported_city_building = TRUE;
; 276  : 				}
; 277  : 			}
; 278  : 
; 279  : 			default:
; 280  : 			{
; 281  : 	
; 282  : 				debug_log ("EN_CREAT : Created %s (index %d), sub_type %d", entity_type_names [type], get_local_entity_index (en), get_local_entity_int_value (en, INT_TYPE_ENTITY_SUB_TYPE));
; 283  : 	
; 284  : 				break;
; 285  : 			} 
; 286  : 		}
; 287  : 	
; 288  : 	}
; 289  : 	#endif
; 290  : 
; 291  : 	return (en);

  000df	8b 45 f4	 mov	 eax, DWORD PTR _en$[ebp]

; 292  : }

  000e2	5f		 pop	 edi
  000e3	5e		 pop	 esi
  000e4	5b		 pop	 ebx
  000e5	8b e5		 mov	 esp, ebp
  000e7	5d		 pop	 ebp
  000e8	c3		 ret	 0
?create_local_entity@@YAPAUENTITY@@W4ENTITY_TYPES@@HZZ ENDP ; create_local_entity
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\system\en_funcs\en_creat.c
;	COMDAT ?initialise_entity_create_default_functions@@YGXXZ
_TEXT	SEGMENT
_i$ = -4						; size = 4
?initialise_entity_create_default_functions@@YGXXZ PROC	; initialise_entity_create_default_functions, COMDAT

; 142  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 44	 sub	 esp, 68			; 00000044H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 143  : 	int
; 144  : 		i;
; 145  : 
; 146  : 	for (i = 0; i < NUM_ENTITY_TYPES; i++)

  00009	c7 45 fc 00 00
	00 00		 mov	 DWORD PTR _i$[ebp], 0
  00010	eb 09		 jmp	 SHORT $LN4@initialise
$LN2@initialise:
  00012	8b 45 fc	 mov	 eax, DWORD PTR _i$[ebp]
  00015	83 c0 01	 add	 eax, 1
  00018	89 45 fc	 mov	 DWORD PTR _i$[ebp], eax
$LN4@initialise:
  0001b	83 7d fc 26	 cmp	 DWORD PTR _i$[ebp], 38	; 00000026H
  0001f	7d 3c		 jge	 SHORT $LN3@initialise

; 147  : 	{
; 148  : 		fn_create_local_entity[i]										= default_create_entity;

  00021	8b 45 fc	 mov	 eax, DWORD PTR _i$[ebp]
  00024	c7 04 85 00 00
	00 00 00 00 00
	00		 mov	 DWORD PTR ?fn_create_local_entity@@3PAP6GPAUENTITY@@W4ENTITY_TYPES@@HPAD@ZA[eax*4], OFFSET ?default_create_entity@@YGPAUENTITY@@W4ENTITY_TYPES@@HPAD@Z ; default_create_entity

; 149  : 
; 150  : 		fn_create_client_server_entity[i][COMMS_MODEL_SERVER]	= default_create_entity;

  0002f	b8 04 00 00 00	 mov	 eax, 4
  00034	6b c8 00	 imul	 ecx, eax, 0
  00037	8b 55 fc	 mov	 edx, DWORD PTR _i$[ebp]
  0003a	c7 84 d1 00 00
	00 00 00 00 00
	00		 mov	 DWORD PTR ?fn_create_client_server_entity@@3PAY01P6GPAUENTITY@@W4ENTITY_TYPES@@HPAD@ZA[ecx+edx*8], OFFSET ?default_create_entity@@YGPAUENTITY@@W4ENTITY_TYPES@@HPAD@Z ; default_create_entity

; 151  : 
; 152  : 		fn_create_client_server_entity[i][COMMS_MODEL_CLIENT]	= default_create_entity;

  00045	b8 04 00 00 00	 mov	 eax, 4
  0004a	c1 e0 00	 shl	 eax, 0
  0004d	8b 4d fc	 mov	 ecx, DWORD PTR _i$[ebp]
  00050	c7 84 c8 00 00
	00 00 00 00 00
	00		 mov	 DWORD PTR ?fn_create_client_server_entity@@3PAY01P6GPAUENTITY@@W4ENTITY_TYPES@@HPAD@ZA[eax+ecx*8], OFFSET ?default_create_entity@@YGPAUENTITY@@W4ENTITY_TYPES@@HPAD@Z ; default_create_entity

; 153  : 	}

  0005b	eb b5		 jmp	 SHORT $LN2@initialise
$LN3@initialise:

; 154  : 
; 155  : 	force_local_entity_create_stack_attributes = FALSE;

  0005d	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?force_local_entity_create_stack_attributes@@3HA, 0 ; force_local_entity_create_stack_attributes

; 156  : }

  00067	5f		 pop	 edi
  00068	5e		 pop	 esi
  00069	5b		 pop	 ebx
  0006a	8b e5		 mov	 esp, ebp
  0006c	5d		 pop	 ebp
  0006d	c3		 ret	 0
?initialise_entity_create_default_functions@@YGXXZ ENDP	; initialise_entity_create_default_functions
_TEXT	ENDS
END
