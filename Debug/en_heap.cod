; Listing generated by Microsoft (R) Optimizing Compiler Version 19.16.27045.0 

	TITLE	C:\Users\nhv90\Projects\eech\aphavoc\source\entity\system\en_main\en_heap.c
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB MSVCRTD
INCLUDELIB OLDNAMES

PUBLIC	?start_of_local_entity_heap@@3HA		; start_of_local_entity_heap
PUBLIC	?first_free_local_entity@@3PAUENTITY@@A		; first_free_local_entity
PUBLIC	?first_used_local_entity@@3PAUENTITY@@A		; first_used_local_entity
PUBLIC	?number_of_entities@@3HA			; number_of_entities
PUBLIC	?entities@@3PAUENTITY@@A			; entities
PUBLIC	?first_free_entity@@3PAUENTITY@@A		; first_free_entity
PUBLIC	?first_used_entity@@3PAUENTITY@@A		; first_used_entity
_BSS	SEGMENT
?start_of_local_entity_heap@@3HA DD 01H DUP (?)		; start_of_local_entity_heap
?first_free_local_entity@@3PAUENTITY@@A DD 01H DUP (?)	; first_free_local_entity
?first_used_local_entity@@3PAUENTITY@@A DD 01H DUP (?)	; first_used_local_entity
?number_of_entities@@3HA DD 01H DUP (?)			; number_of_entities
?entities@@3PAUENTITY@@A DD 01H DUP (?)			; entities
?first_free_entity@@3PAUENTITY@@A DD 01H DUP (?)	; first_free_entity
?first_used_entity@@3PAUENTITY@@A DD 01H DUP (?)	; first_used_entity
_BSS	ENDS
PUBLIC	?get_free_local_entity@@YGPAUENTITY@@H@Z	; get_free_local_entity
PUBLIC	?set_free_local_entity@@YGXPAUENTITY@@@Z	; set_free_local_entity
PUBLIC	?initialise_entity_heap@@YGXH@Z			; initialise_entity_heap
PUBLIC	?reinitialise_entity_heap@@YGXXZ		; reinitialise_entity_heap
PUBLIC	?deinitialise_entity_heap@@YGXXZ		; deinitialise_entity_heap
PUBLIC	?get_free_entity@@YGPAUENTITY@@H@Z		; get_free_entity
PUBLIC	?set_free_entity@@YGXPAUENTITY@@@Z		; set_free_entity
PUBLIC	?pack_entity_safe_index@@YGXH@Z			; pack_entity_safe_index
PUBLIC	?unpack_entity_safe_index@@YGHXZ		; unpack_entity_safe_index
PUBLIC	?pack_entity_safe_ptr@@YGXPAUENTITY@@@Z		; pack_entity_safe_ptr
PUBLIC	?unpack_entity_safe_ptr@@YGPAUENTITY@@XZ	; unpack_entity_safe_ptr
PUBLIC	?__LINE__Var@?0??reset_entity_heap@@YGXXZ@4JA	; `reset_entity_heap'::`1'::__LINE__Var
PUBLIC	??_C@_0EM@CMJBMJMN@c?3?2users?2nhv90?2projects?2eech?2ap@ ; `string'
PUBLIC	??_C@_08PNMNOKOB@entities@			; `string'
PUBLIC	??_C@_0EE@LIEGLJLA@?$CInumber_of_entities?5?$DO?50?$CJ?5?$CG?$CG?5?$CInu@ ; `string'
PUBLIC	??_C@_0BP@LAKEGANF@WARNING?$CB?5Entities?5still?5in?5use@ ; `string'
PUBLIC	?__LINE__Var@?0??initialise_entity_heap@@YGXH@Z@4JA ; `initialise_entity_heap'::`1'::__LINE__Var
PUBLIC	??_C@_0DI@HBPAPOOD@?$CInum_entities?5?$DO?50?$CJ?5?$CG?$CG?5?$CInum_enti@ ; `string'
PUBLIC	??_C@_0CL@LPNABDKG@WARNING?$CB?5Failed?5to?5get?5a?5free?5l@ ; `string'
PUBLIC	??_C@_0CH@IHKGGMMB@Entity?5already?5in?5use?3?5?$CFs?5?$CIinde@ ; `string'
PUBLIC	?__LINE__Var@?0??get_free_entity@@YGPAUENTITY@@H@Z@4JA ; `get_free_entity'::`1'::__LINE__Var
PUBLIC	??_C@_0CF@IFCPMCKD@WARNING?$CB?5Failed?5to?5get?5a?5free?5e@ ; `string'
PUBLIC	??_C@_0CN@BMFDOBOO@?$CIindex?5?$DO?$DN?50?$CJ?5?$CG?$CG?5?$CIindex?5?$DM?5number@ ; `string'
PUBLIC	?__LINE__Var@?0??set_free_local_entity@@YGXPAUENTITY@@@Z@4JA ; `set_free_local_entity'::`1'::__LINE__Var
PUBLIC	??_C@_02LFNMGJAP@en@				; `string'
PUBLIC	?__LINE__Var@?0??set_free_entity@@YGXPAUENTITY@@@Z@4JA ; `set_free_entity'::`1'::__LINE__Var
PUBLIC	?__LINE__Var@?0??pack_entity_safe_index@@YGXH@Z@4JA ; `pack_entity_safe_index'::`1'::__LINE__Var
PUBLIC	??_C@_0FE@DHMGHHOK@?$CIindex?5?$DN?$DN?5ENTITY_INDEX_DONT_CAR@ ; `string'
PUBLIC	?__LINE__Var@?0??unpack_entity_safe_index@@YGHXZ@4JA ; `unpack_entity_safe_index'::`1'::__LINE__Var
EXTRN	_memset:PROC
EXTRN	?process_assert@@YGXPBD0H@Z:PROC		; process_assert
EXTRN	?debug_fatal@@YAXPBDZZ:PROC			; debug_fatal
EXTRN	?debug_colour_log@@YAXW4DEBUG_COLOURS@@PBDZZ:PROC ; debug_colour_log
EXTRN	?malloc_heap_memory@@YGPAXI@Z:PROC		; malloc_heap_memory
EXTRN	?free_mem@@YGXPAX@Z:PROC			; free_mem
EXTRN	?pack_signed_data@@YGXHH@Z:PROC			; pack_signed_data
EXTRN	?unpack_signed_data@@YGHH@Z:PROC		; unpack_signed_data
EXTRN	?command_line_downwash@@3HA:DWORD		; command_line_downwash
EXTRN	?null_entity_pointer_message@@3PBDB:DWORD	; null_entity_pointer_message
EXTRN	?entity_type_names@@3PAPBDA:DWORD		; entity_type_names
EXTRN	?entity_type_database@@3PAUENTITY_TYPE_DATA@@A:BYTE ; entity_type_database
;	COMDAT ?__LINE__Var@?0??unpack_entity_safe_index@@YGHXZ@4JA
_DATA	SEGMENT
?__LINE__Var@?0??unpack_entity_safe_index@@YGHXZ@4JA DD 022dH ; `unpack_entity_safe_index'::`1'::__LINE__Var
_DATA	ENDS
;	COMDAT ??_C@_0FE@DHMGHHOK@?$CIindex?5?$DN?$DN?5ENTITY_INDEX_DONT_CAR@
CONST	SEGMENT
??_C@_0FE@DHMGHHOK@?$CIindex?5?$DN?$DN?5ENTITY_INDEX_DONT_CAR@ DB '(index'
	DB	' == ENTITY_INDEX_DONT_CARE) || ((index >= 0) && (index < numb'
	DB	'er_of_entities))', 00H			; `string'
CONST	ENDS
;	COMDAT ?__LINE__Var@?0??pack_entity_safe_index@@YGXH@Z@4JA
_DATA	SEGMENT
?__LINE__Var@?0??pack_entity_safe_index@@YGXH@Z@4JA DD 021cH ; `pack_entity_safe_index'::`1'::__LINE__Var
_DATA	ENDS
;	COMDAT ?__LINE__Var@?0??set_free_entity@@YGXPAUENTITY@@@Z@4JA
_DATA	SEGMENT
?__LINE__Var@?0??set_free_entity@@YGXPAUENTITY@@@Z@4JA DD 01eeH ; `set_free_entity'::`1'::__LINE__Var
_DATA	ENDS
;	COMDAT ??_C@_02LFNMGJAP@en@
CONST	SEGMENT
??_C@_02LFNMGJAP@en@ DB 'en', 00H			; `string'
CONST	ENDS
;	COMDAT ?__LINE__Var@?0??set_free_local_entity@@YGXPAUENTITY@@@Z@4JA
_DATA	SEGMENT
?__LINE__Var@?0??set_free_local_entity@@YGXPAUENTITY@@@Z@4JA DD 01c0H ; `set_free_local_entity'::`1'::__LINE__Var
_DATA	ENDS
;	COMDAT ??_C@_0CN@BMFDOBOO@?$CIindex?5?$DO?$DN?50?$CJ?5?$CG?$CG?5?$CIindex?5?$DM?5number@
CONST	SEGMENT
??_C@_0CN@BMFDOBOO@?$CIindex?5?$DO?$DN?50?$CJ?5?$CG?$CG?5?$CIindex?5?$DM?5number@ DB '('
	DB	'index >= 0) && (index < number_of_entities)', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0CF@IFCPMCKD@WARNING?$CB?5Failed?5to?5get?5a?5free?5e@
CONST	SEGMENT
??_C@_0CF@IFCPMCKD@WARNING?$CB?5Failed?5to?5get?5a?5free?5e@ DB 'WARNING!'
	DB	' Failed to get a free entity', 00H		; `string'
CONST	ENDS
;	COMDAT ?__LINE__Var@?0??get_free_entity@@YGPAUENTITY@@H@Z@4JA
_DATA	SEGMENT
?__LINE__Var@?0??get_free_entity@@YGPAUENTITY@@H@Z@4JA DD 0161H ; `get_free_entity'::`1'::__LINE__Var
_DATA	ENDS
;	COMDAT ??_C@_0CH@IHKGGMMB@Entity?5already?5in?5use?3?5?$CFs?5?$CIinde@
CONST	SEGMENT
??_C@_0CH@IHKGGMMB@Entity?5already?5in?5use?3?5?$CFs?5?$CIinde@ DB 'Entit'
	DB	'y already in use: %s (index = %d)', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0CL@LPNABDKG@WARNING?$CB?5Failed?5to?5get?5a?5free?5l@
CONST	SEGMENT
??_C@_0CL@LPNABDKG@WARNING?$CB?5Failed?5to?5get?5a?5free?5l@ DB 'WARNING!'
	DB	' Failed to get a free local_entity', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0DI@HBPAPOOD@?$CInum_entities?5?$DO?50?$CJ?5?$CG?$CG?5?$CInum_enti@
CONST	SEGMENT
??_C@_0DI@HBPAPOOD@?$CInum_entities?5?$DO?50?$CJ?5?$CG?$CG?5?$CInum_enti@ DB '('
	DB	'num_entities > 0) && (num_entities < MAX_NUM_ENTITIES)', 00H ; `string'
CONST	ENDS
;	COMDAT ?__LINE__Var@?0??initialise_entity_heap@@YGXH@Z@4JA
_DATA	SEGMENT
?__LINE__Var@?0??initialise_entity_heap@@YGXH@Z@4JA DD 0e2H ; `initialise_entity_heap'::`1'::__LINE__Var
_DATA	ENDS
;	COMDAT ??_C@_0BP@LAKEGANF@WARNING?$CB?5Entities?5still?5in?5use@
CONST	SEGMENT
??_C@_0BP@LAKEGANF@WARNING?$CB?5Entities?5still?5in?5use@ DB 'WARNING! En'
	DB	'tities still in use', 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0EE@LIEGLJLA@?$CInumber_of_entities?5?$DO?50?$CJ?5?$CG?$CG?5?$CInu@
CONST	SEGMENT
??_C@_0EE@LIEGLJLA@?$CInumber_of_entities?5?$DO?50?$CJ?5?$CG?$CG?5?$CInu@ DB '('
	DB	'number_of_entities > 0) && (number_of_entities < MAX_NUM_ENTI'
	DB	'TIES)', 00H					; `string'
CONST	ENDS
;	COMDAT ??_C@_08PNMNOKOB@entities@
CONST	SEGMENT
??_C@_08PNMNOKOB@entities@ DB 'entities', 00H		; `string'
CONST	ENDS
;	COMDAT ??_C@_0EM@CMJBMJMN@c?3?2users?2nhv90?2projects?2eech?2ap@
CONST	SEGMENT
??_C@_0EM@CMJBMJMN@c?3?2users?2nhv90?2projects?2eech?2ap@ DB 'c:\users\nh'
	DB	'v90\projects\eech\aphavoc\source\entity\system\en_main\en_hea'
	DB	'p.c', 00H					; `string'
CONST	ENDS
;	COMDAT ?__LINE__Var@?0??reset_entity_heap@@YGXXZ@4JA
_DATA	SEGMENT
?__LINE__Var@?0??reset_entity_heap@@YGXXZ@4JA DD 06aH	; `reset_entity_heap'::`1'::__LINE__Var
_DATA	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\system\en_main\en_heap.c
;	COMDAT ?check_no_entities_in_use@@YGXXZ
_TEXT	SEGMENT
?check_no_entities_in_use@@YGXXZ PROC			; check_no_entities_in_use, COMDAT

; 198  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 40	 sub	 esp, 64			; 00000040H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 199  : 	if (first_used_entity)

  00009	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?first_used_entity@@3PAUENTITY@@A, 0 ; first_used_entity
  00010	74 0f		 je	 SHORT $LN1@check_no_e

; 200  : 	{
; 201  : 		debug_colour_log (DEBUG_COLOUR_RED, "WARNING! Entities still in use");

  00012	68 00 00 00 00	 push	 OFFSET ??_C@_0BP@LAKEGANF@WARNING?$CB?5Entities?5still?5in?5use@
  00017	6a 04		 push	 4
  00019	e8 00 00 00 00	 call	 ?debug_colour_log@@YAXW4DEBUG_COLOURS@@PBDZZ ; debug_colour_log
  0001e	83 c4 08	 add	 esp, 8
$LN1@check_no_e:

; 202  : 
; 203  : 		#if DEBUG_MODULE
; 204  : 		{
; 205  : 			entity
; 206  : 				*en;
; 207  : 
; 208  : 			en = first_used_entity;
; 209  : 
; 210  : 			while (en)
; 211  : 			{
; 212  : 				debug_log ("->ENTITY: %s (index = %d)", get_local_entity_type_name (en), get_local_entity_index (en));
; 213  : 
; 214  : 				en = get_local_entity_succ (en);
; 215  : 			}
; 216  : 		}
; 217  : 		#endif
; 218  : 	}
; 219  : }

  00021	5f		 pop	 edi
  00022	5e		 pop	 esi
  00023	5b		 pop	 ebx
  00024	8b e5		 mov	 esp, ebp
  00026	5d		 pop	 ebp
  00027	c3		 ret	 0
?check_no_entities_in_use@@YGXXZ ENDP			; check_no_entities_in_use
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\system\en_main\en_heap.c
;	COMDAT ?check_no_local_entities_in_use@@YGXXZ
_TEXT	SEGMENT
?check_no_local_entities_in_use@@YGXXZ PROC		; check_no_local_entities_in_use, COMDAT

; 170  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 40	 sub	 esp, 64			; 00000040H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 171  : 	if (first_used_local_entity)

  00009	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?first_used_local_entity@@3PAUENTITY@@A, 0 ; first_used_local_entity
  00010	74 0f		 je	 SHORT $LN1@check_no_l

; 172  : 	{
; 173  : 		debug_colour_log (DEBUG_COLOUR_RED, "WARNING! Entities still in use");

  00012	68 00 00 00 00	 push	 OFFSET ??_C@_0BP@LAKEGANF@WARNING?$CB?5Entities?5still?5in?5use@
  00017	6a 04		 push	 4
  00019	e8 00 00 00 00	 call	 ?debug_colour_log@@YAXW4DEBUG_COLOURS@@PBDZZ ; debug_colour_log
  0001e	83 c4 08	 add	 esp, 8
$LN1@check_no_l:

; 174  : 
; 175  : 		#if DEBUG_MODULE
; 176  : 		{
; 177  : 			entity
; 178  : 				*en;
; 179  : 
; 180  : 			en = first_used_local_entity;
; 181  : 
; 182  : 			while (en)
; 183  : 			{
; 184  : 				debug_log ("->ENTITY: %s (index = %d)", get_local_entity_type_name (en), get_local_entity_index (en));
; 185  : 
; 186  : 				en = get_local_entity_succ (en);
; 187  : 			}
; 188  : 		}
; 189  : 		#endif
; 190  : 	}
; 191  : }

  00021	5f		 pop	 edi
  00022	5e		 pop	 esi
  00023	5b		 pop	 ebx
  00024	8b e5		 mov	 esp, ebp
  00026	5d		 pop	 ebp
  00027	c3		 ret	 0
?check_no_local_entities_in_use@@YGXXZ ENDP		; check_no_local_entities_in_use
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\system\en_main\en_heap.c
;	COMDAT ?reset_entity_heap@@YGXXZ
_TEXT	SEGMENT
_i$ = -4						; size = 4
?reset_entity_heap@@YGXXZ PROC				; reset_entity_heap, COMDAT

; 106  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 44	 sub	 esp, 68			; 00000044H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 107  : 	int
; 108  : 		i;
; 109  : 
; 110  : 	ASSERT (entities);

  00009	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?entities@@3PAUENTITY@@A, 0 ; entities
  00010	75 18		 jne	 SHORT $LN8@reset_enti
  00012	a1 00 00 00 00	 mov	 eax, DWORD PTR ?__LINE__Var@?0??reset_entity_heap@@YGXXZ@4JA
  00017	83 c0 04	 add	 eax, 4
  0001a	50		 push	 eax
  0001b	68 00 00 00 00	 push	 OFFSET ??_C@_0EM@CMJBMJMN@c?3?2users?2nhv90?2projects?2eech?2ap@
  00020	68 00 00 00 00	 push	 OFFSET ??_C@_08PNMNOKOB@entities@
  00025	e8 00 00 00 00	 call	 ?process_assert@@YGXPBD0H@Z ; process_assert
$LN8@reset_enti:

; 111  : 
; 112  : 	ASSERT ((number_of_entities > 0) && (number_of_entities < MAX_NUM_ENTITIES));

  0002a	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?number_of_entities@@3HA, 0 ; number_of_entities
  00031	7e 0c		 jle	 SHORT $LN10@reset_enti
  00033	81 3d 00 00 00
	00 00 00 08 00	 cmp	 DWORD PTR ?number_of_entities@@3HA, 524288 ; number_of_entities, 00080000H
  0003d	7c 18		 jl	 SHORT $LN9@reset_enti
$LN10@reset_enti:
  0003f	a1 00 00 00 00	 mov	 eax, DWORD PTR ?__LINE__Var@?0??reset_entity_heap@@YGXXZ@4JA
  00044	83 c0 06	 add	 eax, 6
  00047	50		 push	 eax
  00048	68 00 00 00 00	 push	 OFFSET ??_C@_0EM@CMJBMJMN@c?3?2users?2nhv90?2projects?2eech?2ap@
  0004d	68 00 00 00 00	 push	 OFFSET ??_C@_0EE@LIEGLJLA@?$CInumber_of_entities?5?$DO?50?$CJ?5?$CG?$CG?5?$CInu@
  00052	e8 00 00 00 00	 call	 ?process_assert@@YGXPBD0H@Z ; process_assert
$LN9@reset_enti:

; 113  : 
; 114  : 	memset (entities, 0, number_of_entities * sizeof (entity));

  00057	a1 00 00 00 00	 mov	 eax, DWORD PTR ?number_of_entities@@3HA ; number_of_entities
  0005c	c1 e0 04	 shl	 eax, 4
  0005f	50		 push	 eax
  00060	6a 00		 push	 0
  00062	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?entities@@3PAUENTITY@@A ; entities
  00068	51		 push	 ecx
  00069	e8 00 00 00 00	 call	 _memset
  0006e	83 c4 0c	 add	 esp, 12			; 0000000cH

; 115  : 
; 116  : 	//VJ 030508 if downwash num entities is 135000 else 125000
; 117  : 	if (command_line_downwash)

  00071	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?command_line_downwash@@3HA, 0 ; command_line_downwash
  00078	0f 84 db 00 00
	00		 je	 $LN11@reset_enti

; 118  : 	{
; 119  : 		for (i = 0; i < number_of_entities; i++)

  0007e	c7 45 fc 00 00
	00 00		 mov	 DWORD PTR _i$[ebp], 0
  00085	eb 09		 jmp	 SHORT $LN4@reset_enti
$LN2@reset_enti:
  00087	8b 45 fc	 mov	 eax, DWORD PTR _i$[ebp]
  0008a	83 c0 01	 add	 eax, 1
  0008d	89 45 fc	 mov	 DWORD PTR _i$[ebp], eax
$LN4@reset_enti:
  00090	8b 45 fc	 mov	 eax, DWORD PTR _i$[ebp]
  00093	3b 05 00 00 00
	00		 cmp	 eax, DWORD PTR ?number_of_entities@@3HA ; number_of_entities
  00099	0f 8d 84 00 00
	00		 jge	 $LN3@reset_enti

; 120  : 		{
; 121  : 			//Xhit: split the heap into two parts, normal entity heap and local created only heap. (030428)
; 122  : 			if ( (i < start_of_local_entity_heap - 1) || ( (i >= start_of_local_entity_heap) && (i < number_of_entities - 1) ) )

  0009f	a1 00 00 00 00	 mov	 eax, DWORD PTR ?start_of_local_entity_heap@@3HA ; start_of_local_entity_heap
  000a4	83 e8 01	 sub	 eax, 1
  000a7	39 45 fc	 cmp	 DWORD PTR _i$[ebp], eax
  000aa	7c 18		 jl	 SHORT $LN14@reset_enti
  000ac	8b 45 fc	 mov	 eax, DWORD PTR _i$[ebp]
  000af	3b 05 00 00 00
	00		 cmp	 eax, DWORD PTR ?start_of_local_entity_heap@@3HA ; start_of_local_entity_heap
  000b5	7c 2c		 jl	 SHORT $LN13@reset_enti
  000b7	a1 00 00 00 00	 mov	 eax, DWORD PTR ?number_of_entities@@3HA ; number_of_entities
  000bc	83 e8 01	 sub	 eax, 1
  000bf	39 45 fc	 cmp	 DWORD PTR _i$[ebp], eax
  000c2	7d 1f		 jge	 SHORT $LN13@reset_enti
$LN14@reset_enti:

; 123  : 			{
; 124  : 				entities[i].succ = &entities[i + 1];

  000c4	8b 45 fc	 mov	 eax, DWORD PTR _i$[ebp]
  000c7	83 c0 01	 add	 eax, 1
  000ca	c1 e0 04	 shl	 eax, 4
  000cd	03 05 00 00 00
	00		 add	 eax, DWORD PTR ?entities@@3PAUENTITY@@A ; entities
  000d3	8b 4d fc	 mov	 ecx, DWORD PTR _i$[ebp]
  000d6	c1 e1 04	 shl	 ecx, 4
  000d9	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?entities@@3PAUENTITY@@A ; entities
  000df	89 44 0a 08	 mov	 DWORD PTR [edx+ecx+8], eax
$LN13@reset_enti:

; 125  : 			}
; 126  : 			
; 127  : 			//Xhit: split the heap into two parts, normal entity heap and local created only heap. (030428)
; 128  : 			if ( ( (i > 0) && (i < start_of_local_entity_heap) ) || (i > start_of_local_entity_heap) )

  000e3	83 7d fc 00	 cmp	 DWORD PTR _i$[ebp], 0
  000e7	7e 0b		 jle	 SHORT $LN17@reset_enti
  000e9	8b 45 fc	 mov	 eax, DWORD PTR _i$[ebp]
  000ec	3b 05 00 00 00
	00		 cmp	 eax, DWORD PTR ?start_of_local_entity_heap@@3HA ; start_of_local_entity_heap
  000f2	7c 0b		 jl	 SHORT $LN16@reset_enti
$LN17@reset_enti:
  000f4	8b 45 fc	 mov	 eax, DWORD PTR _i$[ebp]
  000f7	3b 05 00 00 00
	00		 cmp	 eax, DWORD PTR ?start_of_local_entity_heap@@3HA ; start_of_local_entity_heap
  000fd	7e 1f		 jle	 SHORT $LN15@reset_enti
$LN16@reset_enti:

; 129  : 			{
; 130  : 				entities[i].pred = &entities[i - 1];

  000ff	8b 45 fc	 mov	 eax, DWORD PTR _i$[ebp]
  00102	83 e8 01	 sub	 eax, 1
  00105	c1 e0 04	 shl	 eax, 4
  00108	03 05 00 00 00
	00		 add	 eax, DWORD PTR ?entities@@3PAUENTITY@@A ; entities
  0010e	8b 4d fc	 mov	 ecx, DWORD PTR _i$[ebp]
  00111	c1 e1 04	 shl	 ecx, 4
  00114	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?entities@@3PAUENTITY@@A ; entities
  0011a	89 44 0a 0c	 mov	 DWORD PTR [edx+ecx+12], eax
$LN15@reset_enti:

; 131  : 			}
; 132  : 		}

  0011e	e9 64 ff ff ff	 jmp	 $LN2@reset_enti
$LN3@reset_enti:

; 133  : 	
; 134  : 		first_free_entity = entities;

  00123	a1 00 00 00 00	 mov	 eax, DWORD PTR ?entities@@3PAUENTITY@@A ; entities
  00128	a3 00 00 00 00	 mov	 DWORD PTR ?first_free_entity@@3PAUENTITY@@A, eax ; first_free_entity

; 135  : 	
; 136  : 		first_used_entity = NULL;

  0012d	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?first_used_entity@@3PAUENTITY@@A, 0 ; first_used_entity

; 137  : 
; 138  : 		//Xhit: Mark the start of the local only entity heap. (030428)
; 139  : 		first_free_local_entity = &entities[start_of_local_entity_heap];

  00137	a1 00 00 00 00	 mov	 eax, DWORD PTR ?start_of_local_entity_heap@@3HA ; start_of_local_entity_heap
  0013c	c1 e0 04	 shl	 eax, 4
  0013f	03 05 00 00 00
	00		 add	 eax, DWORD PTR ?entities@@3PAUENTITY@@A ; entities
  00145	a3 00 00 00 00	 mov	 DWORD PTR ?first_free_local_entity@@3PAUENTITY@@A, eax ; first_free_local_entity

; 140  : 		first_used_local_entity = NULL;

  0014a	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?first_used_local_entity@@3PAUENTITY@@A, 0 ; first_used_local_entity

; 141  : 	}
; 142  : 	else

  00154	e9 84 00 00 00	 jmp	 $LN1@reset_enti
$LN11@reset_enti:

; 143  : 	{
; 144  : 		for (i = 0; i < number_of_entities; i++)

  00159	c7 45 fc 00 00
	00 00		 mov	 DWORD PTR _i$[ebp], 0
  00160	eb 09		 jmp	 SHORT $LN7@reset_enti
$LN5@reset_enti:
  00162	8b 45 fc	 mov	 eax, DWORD PTR _i$[ebp]
  00165	83 c0 01	 add	 eax, 1
  00168	89 45 fc	 mov	 DWORD PTR _i$[ebp], eax
$LN7@reset_enti:
  0016b	8b 45 fc	 mov	 eax, DWORD PTR _i$[ebp]
  0016e	3b 05 00 00 00
	00		 cmp	 eax, DWORD PTR ?number_of_entities@@3HA ; number_of_entities
  00174	7d 53		 jge	 SHORT $LN6@reset_enti

; 145  : 		{
; 146  : 			if (i < number_of_entities - 1)

  00176	a1 00 00 00 00	 mov	 eax, DWORD PTR ?number_of_entities@@3HA ; number_of_entities
  0017b	83 e8 01	 sub	 eax, 1
  0017e	39 45 fc	 cmp	 DWORD PTR _i$[ebp], eax
  00181	7d 1f		 jge	 SHORT $LN18@reset_enti

; 147  : 			{
; 148  : 				entities[i].succ = &entities[i + 1];

  00183	8b 45 fc	 mov	 eax, DWORD PTR _i$[ebp]
  00186	83 c0 01	 add	 eax, 1
  00189	c1 e0 04	 shl	 eax, 4
  0018c	03 05 00 00 00
	00		 add	 eax, DWORD PTR ?entities@@3PAUENTITY@@A ; entities
  00192	8b 4d fc	 mov	 ecx, DWORD PTR _i$[ebp]
  00195	c1 e1 04	 shl	 ecx, 4
  00198	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?entities@@3PAUENTITY@@A ; entities
  0019e	89 44 0a 08	 mov	 DWORD PTR [edx+ecx+8], eax
$LN18@reset_enti:

; 149  : 			}
; 150  : 	
; 151  : 			if (i > 0)

  001a2	83 7d fc 00	 cmp	 DWORD PTR _i$[ebp], 0
  001a6	7e 1f		 jle	 SHORT $LN19@reset_enti

; 152  : 			{
; 153  : 				entities[i].pred = &entities[i - 1];

  001a8	8b 45 fc	 mov	 eax, DWORD PTR _i$[ebp]
  001ab	83 e8 01	 sub	 eax, 1
  001ae	c1 e0 04	 shl	 eax, 4
  001b1	03 05 00 00 00
	00		 add	 eax, DWORD PTR ?entities@@3PAUENTITY@@A ; entities
  001b7	8b 4d fc	 mov	 ecx, DWORD PTR _i$[ebp]
  001ba	c1 e1 04	 shl	 ecx, 4
  001bd	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?entities@@3PAUENTITY@@A ; entities
  001c3	89 44 0a 0c	 mov	 DWORD PTR [edx+ecx+12], eax
$LN19@reset_enti:

; 154  : 			}
; 155  : 		}	

  001c7	eb 99		 jmp	 SHORT $LN5@reset_enti
$LN6@reset_enti:

; 156  : 		
; 157  : 		first_free_entity = entities;

  001c9	a1 00 00 00 00	 mov	 eax, DWORD PTR ?entities@@3PAUENTITY@@A ; entities
  001ce	a3 00 00 00 00	 mov	 DWORD PTR ?first_free_entity@@3PAUENTITY@@A, eax ; first_free_entity

; 158  : 	
; 159  : 		first_used_entity = NULL;

  001d3	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?first_used_entity@@3PAUENTITY@@A, 0 ; first_used_entity
$LN1@reset_enti:

; 160  : 
; 161  : 	}	
; 162  : }

  001dd	5f		 pop	 edi
  001de	5e		 pop	 esi
  001df	5b		 pop	 ebx
  001e0	8b e5		 mov	 esp, ebp
  001e2	5d		 pop	 ebp
  001e3	c3		 ret	 0
?reset_entity_heap@@YGXXZ ENDP				; reset_entity_heap
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\system\en_main\en_heap.c
;	COMDAT ?unpack_entity_safe_ptr@@YGPAUENTITY@@XZ
_TEXT	SEGMENT
tv68 = -76						; size = 4
_en$ = -8						; size = 4
_index$ = -4						; size = 4
?unpack_entity_safe_ptr@@YGPAUENTITY@@XZ PROC		; unpack_entity_safe_ptr, COMDAT

; 595  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 4c	 sub	 esp, 76			; 0000004cH
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 596  : 	int
; 597  : 		index;
; 598  : 
; 599  : 	entity
; 600  : 		*en;
; 601  : 
; 602  : 	index = unpack_entity_safe_index ();

  00009	e8 00 00 00 00	 call	 ?unpack_entity_safe_index@@YGHXZ ; unpack_entity_safe_index
  0000e	89 45 fc	 mov	 DWORD PTR _index$[ebp], eax

; 603  : 
; 604  : 	en = get_local_entity_safe_ptr (index);

  00011	83 7d fc ff	 cmp	 DWORD PTR _index$[ebp], -1
  00015	74 11		 je	 SHORT $LN3@unpack_ent
  00017	8b 45 fc	 mov	 eax, DWORD PTR _index$[ebp]
  0001a	c1 e0 04	 shl	 eax, 4
  0001d	03 05 00 00 00
	00		 add	 eax, DWORD PTR ?entities@@3PAUENTITY@@A ; entities
  00023	89 45 b4	 mov	 DWORD PTR tv68[ebp], eax
  00026	eb 07		 jmp	 SHORT $LN4@unpack_ent
$LN3@unpack_ent:
  00028	c7 45 b4 00 00
	00 00		 mov	 DWORD PTR tv68[ebp], 0
$LN4@unpack_ent:
  0002f	8b 4d b4	 mov	 ecx, DWORD PTR tv68[ebp]
  00032	89 4d f8	 mov	 DWORD PTR _en$[ebp], ecx

; 605  : 
; 606  : 	return (en);

  00035	8b 45 f8	 mov	 eax, DWORD PTR _en$[ebp]

; 607  : }

  00038	5f		 pop	 edi
  00039	5e		 pop	 esi
  0003a	5b		 pop	 ebx
  0003b	8b e5		 mov	 esp, ebp
  0003d	5d		 pop	 ebp
  0003e	c3		 ret	 0
?unpack_entity_safe_ptr@@YGPAUENTITY@@XZ ENDP		; unpack_entity_safe_ptr
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\system\en_main\en_heap.c
;	COMDAT ?pack_entity_safe_ptr@@YGXPAUENTITY@@@Z
_TEXT	SEGMENT
tv67 = -72						; size = 4
_index$ = -4						; size = 4
_en$ = 8						; size = 4
?pack_entity_safe_ptr@@YGXPAUENTITY@@@Z PROC		; pack_entity_safe_ptr, COMDAT

; 581  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 48	 sub	 esp, 72			; 00000048H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 582  : 	int
; 583  : 		index;
; 584  : 
; 585  : 	index = get_local_entity_safe_index (en);

  00009	83 7d 08 00	 cmp	 DWORD PTR _en$[ebp], 0
  0000d	74 11		 je	 SHORT $LN3@pack_entit
  0000f	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  00012	2b 05 00 00 00
	00		 sub	 eax, DWORD PTR ?entities@@3PAUENTITY@@A ; entities
  00018	c1 f8 04	 sar	 eax, 4
  0001b	89 45 b8	 mov	 DWORD PTR tv67[ebp], eax
  0001e	eb 07		 jmp	 SHORT $LN4@pack_entit
$LN3@pack_entit:
  00020	c7 45 b8 ff ff
	ff ff		 mov	 DWORD PTR tv67[ebp], -1
$LN4@pack_entit:
  00027	8b 4d b8	 mov	 ecx, DWORD PTR tv67[ebp]
  0002a	89 4d fc	 mov	 DWORD PTR _index$[ebp], ecx

; 586  : 
; 587  : 	pack_entity_safe_index (index);

  0002d	8b 45 fc	 mov	 eax, DWORD PTR _index$[ebp]
  00030	50		 push	 eax
  00031	e8 00 00 00 00	 call	 ?pack_entity_safe_index@@YGXH@Z ; pack_entity_safe_index

; 588  : }

  00036	5f		 pop	 edi
  00037	5e		 pop	 esi
  00038	5b		 pop	 ebx
  00039	8b e5		 mov	 esp, ebp
  0003b	5d		 pop	 ebp
  0003c	c2 04 00	 ret	 4
?pack_entity_safe_ptr@@YGXPAUENTITY@@@Z ENDP		; pack_entity_safe_ptr
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\system\en_main\en_heap.c
;	COMDAT ?unpack_entity_safe_index@@YGHXZ
_TEXT	SEGMENT
_index$ = -4						; size = 4
?unpack_entity_safe_index@@YGHXZ PROC			; unpack_entity_safe_index, COMDAT

; 557  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 44	 sub	 esp, 68			; 00000044H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 558  : 	int
; 559  : 		index;
; 560  : 
; 561  : 	index = unpack_signed_data (NUM_ENTITY_INDEX_PACK_BITS);

  00009	6a 14		 push	 20			; 00000014H
  0000b	e8 00 00 00 00	 call	 ?unpack_signed_data@@YGHH@Z ; unpack_signed_data
  00010	89 45 fc	 mov	 DWORD PTR _index$[ebp], eax

; 562  : 
; 563  : 	ASSERT ((index == ENTITY_INDEX_DONT_CARE) || ((index >= 0) && (index < number_of_entities)));

  00013	83 7d fc ff	 cmp	 DWORD PTR _index$[ebp], -1
  00017	74 29		 je	 SHORT $LN2@unpack_ent
  00019	83 7d fc 00	 cmp	 DWORD PTR _index$[ebp], 0
  0001d	7c 0b		 jl	 SHORT $LN3@unpack_ent
  0001f	8b 45 fc	 mov	 eax, DWORD PTR _index$[ebp]
  00022	3b 05 00 00 00
	00		 cmp	 eax, DWORD PTR ?number_of_entities@@3HA ; number_of_entities
  00028	7c 18		 jl	 SHORT $LN2@unpack_ent
$LN3@unpack_ent:
  0002a	a1 00 00 00 00	 mov	 eax, DWORD PTR ?__LINE__Var@?0??unpack_entity_safe_index@@YGHXZ@4JA
  0002f	83 c0 06	 add	 eax, 6
  00032	50		 push	 eax
  00033	68 00 00 00 00	 push	 OFFSET ??_C@_0EM@CMJBMJMN@c?3?2users?2nhv90?2projects?2eech?2ap@
  00038	68 00 00 00 00	 push	 OFFSET ??_C@_0FE@DHMGHHOK@?$CIindex?5?$DN?$DN?5ENTITY_INDEX_DONT_CAR@
  0003d	e8 00 00 00 00	 call	 ?process_assert@@YGXPBD0H@Z ; process_assert
$LN2@unpack_ent:

; 564  : 
; 565  : 	#if (DEBUG_MODULE_PACK_ALL)
; 566  : 
; 567  : 	debug_log_entity_args (ENTITY_DEBUG_UNPACK, ENTITY_DEBUG_ENTITY_INDEX, NULL, index);
; 568  : 
; 569  : 	#endif
; 570  : 
; 571  : 	//debug_log ("EN_HEAP: index %d", index);
; 572  : 
; 573  : 	return (index);

  00042	8b 45 fc	 mov	 eax, DWORD PTR _index$[ebp]

; 574  : }

  00045	5f		 pop	 edi
  00046	5e		 pop	 esi
  00047	5b		 pop	 ebx
  00048	8b e5		 mov	 esp, ebp
  0004a	5d		 pop	 ebp
  0004b	c3		 ret	 0
?unpack_entity_safe_index@@YGHXZ ENDP			; unpack_entity_safe_index
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\system\en_main\en_heap.c
;	COMDAT ?pack_entity_safe_index@@YGXH@Z
_TEXT	SEGMENT
_index$ = 8						; size = 4
?pack_entity_safe_index@@YGXH@Z PROC			; pack_entity_safe_index, COMDAT

; 540  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 40	 sub	 esp, 64			; 00000040H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 541  : 	ASSERT ((index == ENTITY_INDEX_DONT_CARE) || ((index >= 0) && (index < number_of_entities)));

  00009	83 7d 08 ff	 cmp	 DWORD PTR _index$[ebp], -1
  0000d	74 29		 je	 SHORT $LN2@pack_entit
  0000f	83 7d 08 00	 cmp	 DWORD PTR _index$[ebp], 0
  00013	7c 0b		 jl	 SHORT $LN3@pack_entit
  00015	8b 45 08	 mov	 eax, DWORD PTR _index$[ebp]
  00018	3b 05 00 00 00
	00		 cmp	 eax, DWORD PTR ?number_of_entities@@3HA ; number_of_entities
  0001e	7c 18		 jl	 SHORT $LN2@pack_entit
$LN3@pack_entit:
  00020	a1 00 00 00 00	 mov	 eax, DWORD PTR ?__LINE__Var@?0??pack_entity_safe_index@@YGXH@Z@4JA
  00025	83 c0 01	 add	 eax, 1
  00028	50		 push	 eax
  00029	68 00 00 00 00	 push	 OFFSET ??_C@_0EM@CMJBMJMN@c?3?2users?2nhv90?2projects?2eech?2ap@
  0002e	68 00 00 00 00	 push	 OFFSET ??_C@_0FE@DHMGHHOK@?$CIindex?5?$DN?$DN?5ENTITY_INDEX_DONT_CAR@
  00033	e8 00 00 00 00	 call	 ?process_assert@@YGXPBD0H@Z ; process_assert
$LN2@pack_entit:

; 542  : 
; 543  : 	#if (DEBUG_MODULE_PACK_ALL)
; 544  : 
; 545  : 	debug_log_entity_args (ENTITY_DEBUG_PACK, ENTITY_DEBUG_ENTITY_INDEX, NULL, index);
; 546  : 
; 547  : 	#endif
; 548  : 
; 549  : 	pack_signed_data (index, NUM_ENTITY_INDEX_PACK_BITS);

  00038	6a 14		 push	 20			; 00000014H
  0003a	8b 45 08	 mov	 eax, DWORD PTR _index$[ebp]
  0003d	50		 push	 eax
  0003e	e8 00 00 00 00	 call	 ?pack_signed_data@@YGXHH@Z ; pack_signed_data

; 550  : }

  00043	5f		 pop	 edi
  00044	5e		 pop	 esi
  00045	5b		 pop	 ebx
  00046	8b e5		 mov	 esp, ebp
  00048	5d		 pop	 ebp
  00049	c2 04 00	 ret	 4
?pack_entity_safe_index@@YGXH@Z ENDP			; pack_entity_safe_index
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\system\en_main\en_heap.c
;	COMDAT ?set_free_entity@@YGXPAUENTITY@@@Z
_TEXT	SEGMENT
_en$ = 8						; size = 4
?set_free_entity@@YGXPAUENTITY@@@Z PROC			; set_free_entity, COMDAT

; 494  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 40	 sub	 esp, 64			; 00000040H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 495  : 	ASSERT (en);

  00009	83 7d 08 00	 cmp	 DWORD PTR _en$[ebp], 0
  0000d	75 18		 jne	 SHORT $LN2@set_free_e
  0000f	a1 00 00 00 00	 mov	 eax, DWORD PTR ?__LINE__Var@?0??set_free_entity@@YGXPAUENTITY@@@Z@4JA
  00014	83 c0 01	 add	 eax, 1
  00017	50		 push	 eax
  00018	68 00 00 00 00	 push	 OFFSET ??_C@_0EM@CMJBMJMN@c?3?2users?2nhv90?2projects?2eech?2ap@
  0001d	68 00 00 00 00	 push	 OFFSET ??_C@_02LFNMGJAP@en@
  00022	e8 00 00 00 00	 call	 ?process_assert@@YGXPBD0H@Z ; process_assert
$LN2@set_free_e:

; 496  : 
; 497  : 	en->type = ENTITY_TYPE_UNKNOWN;

  00027	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  0002a	c7 00 00 00 00
	00		 mov	 DWORD PTR [eax], 0

; 498  : 
; 499  : 	en->data = NULL;

  00030	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  00033	c7 40 04 00 00
	00 00		 mov	 DWORD PTR [eax+4], 0

; 500  : 
; 501  : 	//
; 502  : 	// unlink entity from used list
; 503  : 	//
; 504  : 
; 505  : 	if (en->pred)

  0003a	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  0003d	83 78 0c 00	 cmp	 DWORD PTR [eax+12], 0
  00041	74 11		 je	 SHORT $LN3@set_free_e

; 506  : 	{
; 507  : 		en->pred->succ = en->succ;

  00043	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  00046	8b 48 0c	 mov	 ecx, DWORD PTR [eax+12]
  00049	8b 55 08	 mov	 edx, DWORD PTR _en$[ebp]
  0004c	8b 42 08	 mov	 eax, DWORD PTR [edx+8]
  0004f	89 41 08	 mov	 DWORD PTR [ecx+8], eax

; 508  : 	}
; 509  : 	else

  00052	eb 0c		 jmp	 SHORT $LN4@set_free_e
$LN3@set_free_e:

; 510  : 	{
; 511  : 		first_used_entity = en->succ;

  00054	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  00057	8b 48 08	 mov	 ecx, DWORD PTR [eax+8]
  0005a	89 0d 00 00 00
	00		 mov	 DWORD PTR ?first_used_entity@@3PAUENTITY@@A, ecx ; first_used_entity
$LN4@set_free_e:

; 512  : 	}
; 513  : 
; 514  : 	if (en->succ)

  00060	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  00063	83 78 08 00	 cmp	 DWORD PTR [eax+8], 0
  00067	74 0f		 je	 SHORT $LN5@set_free_e

; 515  : 	{
; 516  : 		en->succ->pred = en->pred;

  00069	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  0006c	8b 48 08	 mov	 ecx, DWORD PTR [eax+8]
  0006f	8b 55 08	 mov	 edx, DWORD PTR _en$[ebp]
  00072	8b 42 0c	 mov	 eax, DWORD PTR [edx+12]
  00075	89 41 0c	 mov	 DWORD PTR [ecx+12], eax
$LN5@set_free_e:

; 517  : 	}
; 518  : 
; 519  : 	//
; 520  : 	// link entity into start of free list
; 521  : 	//
; 522  : 
; 523  : 	en->succ = first_free_entity;

  00078	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  0007b	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?first_free_entity@@3PAUENTITY@@A ; first_free_entity
  00081	89 48 08	 mov	 DWORD PTR [eax+8], ecx

; 524  : 
; 525  : 	if (en->succ)

  00084	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  00087	83 78 08 00	 cmp	 DWORD PTR [eax+8], 0
  0008b	74 0c		 je	 SHORT $LN6@set_free_e

; 526  : 	{
; 527  : 		en->succ->pred = en;

  0008d	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  00090	8b 48 08	 mov	 ecx, DWORD PTR [eax+8]
  00093	8b 55 08	 mov	 edx, DWORD PTR _en$[ebp]
  00096	89 51 0c	 mov	 DWORD PTR [ecx+12], edx
$LN6@set_free_e:

; 528  : 	}
; 529  : 
; 530  : 	en->pred = NULL;

  00099	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  0009c	c7 40 0c 00 00
	00 00		 mov	 DWORD PTR [eax+12], 0

; 531  : 
; 532  : 	first_free_entity = en;

  000a3	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  000a6	a3 00 00 00 00	 mov	 DWORD PTR ?first_free_entity@@3PAUENTITY@@A, eax ; first_free_entity

; 533  : }

  000ab	5f		 pop	 edi
  000ac	5e		 pop	 esi
  000ad	5b		 pop	 ebx
  000ae	8b e5		 mov	 esp, ebp
  000b0	5d		 pop	 ebp
  000b1	c2 04 00	 ret	 4
?set_free_entity@@YGXPAUENTITY@@@Z ENDP			; set_free_entity
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\system\en_main\en_heap.c
;	COMDAT ?get_free_entity@@YGPAUENTITY@@H@Z
_TEXT	SEGMENT
tv132 = -72						; size = 4
tv91 = -72						; size = 4
_en$ = -4						; size = 4
_index$ = 8						; size = 4
?get_free_entity@@YGPAUENTITY@@H@Z PROC			; get_free_entity, COMDAT

; 353  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 48	 sub	 esp, 72			; 00000048H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 354  : 	entity
; 355  : 		*en;
; 356  : 
; 357  : 	if (index == ENTITY_INDEX_DONT_CARE)

  00009	83 7d 08 ff	 cmp	 DWORD PTR _index$[ebp], -1
  0000d	75 6f		 jne	 SHORT $LN2@get_free_e

; 358  : 	{
; 359  : 		en = first_free_entity;

  0000f	a1 00 00 00 00	 mov	 eax, DWORD PTR ?first_free_entity@@3PAUENTITY@@A ; first_free_entity
  00014	89 45 fc	 mov	 DWORD PTR _en$[ebp], eax

; 360  : 
; 361  : 		if (en)

  00017	83 7d fc 00	 cmp	 DWORD PTR _en$[ebp], 0
  0001b	74 4d		 je	 SHORT $LN4@get_free_e

; 362  : 		{
; 363  : 			//
; 364  : 			// unlink entity from start of free list
; 365  : 			//
; 366  : 
; 367  : 			first_free_entity = en->succ;

  0001d	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  00020	8b 48 08	 mov	 ecx, DWORD PTR [eax+8]
  00023	89 0d 00 00 00
	00		 mov	 DWORD PTR ?first_free_entity@@3PAUENTITY@@A, ecx ; first_free_entity

; 368  : 
; 369  : 			if (en->succ)

  00029	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  0002c	83 78 08 00	 cmp	 DWORD PTR [eax+8], 0
  00030	74 0d		 je	 SHORT $LN6@get_free_e

; 370  : 			{
; 371  : 				en->succ->pred = NULL;

  00032	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  00035	8b 48 08	 mov	 ecx, DWORD PTR [eax+8]
  00038	c7 41 0c 00 00
	00 00		 mov	 DWORD PTR [ecx+12], 0
$LN6@get_free_e:

; 372  : 			}
; 373  : 
; 374  : 			//
; 375  : 			// insert entity into start of used list (en->pred already set to NULL)
; 376  : 			//
; 377  : 
; 378  : 			en->succ = first_used_entity;

  0003f	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  00042	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?first_used_entity@@3PAUENTITY@@A ; first_used_entity
  00048	89 48 08	 mov	 DWORD PTR [eax+8], ecx

; 379  : 
; 380  : 			if (en->succ)

  0004b	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  0004e	83 78 08 00	 cmp	 DWORD PTR [eax+8], 0
  00052	74 0c		 je	 SHORT $LN7@get_free_e

; 381  : 			{
; 382  : 				en->succ->pred = en;

  00054	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  00057	8b 48 08	 mov	 ecx, DWORD PTR [eax+8]
  0005a	8b 55 fc	 mov	 edx, DWORD PTR _en$[ebp]
  0005d	89 51 0c	 mov	 DWORD PTR [ecx+12], edx
$LN7@get_free_e:

; 383  : 			}
; 384  : 
; 385  : 			first_used_entity = en;

  00060	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  00063	a3 00 00 00 00	 mov	 DWORD PTR ?first_used_entity@@3PAUENTITY@@A, eax ; first_used_entity

; 386  : 		}
; 387  : 		else

  00068	eb 0f		 jmp	 SHORT $LN5@get_free_e
$LN4@get_free_e:

; 388  : 		{
; 389  : 			debug_colour_log (DEBUG_COLOUR_RED, "WARNING! Failed to get a free entity");

  0006a	68 00 00 00 00	 push	 OFFSET ??_C@_0CF@IFCPMCKD@WARNING?$CB?5Failed?5to?5get?5a?5free?5e@
  0006f	6a 04		 push	 4
  00071	e8 00 00 00 00	 call	 ?debug_colour_log@@YAXW4DEBUG_COLOURS@@PBDZZ ; debug_colour_log
  00076	83 c4 08	 add	 esp, 8
$LN5@get_free_e:

; 390  : 		}
; 391  : 	}
; 392  : 	else

  00079	e9 25 01 00 00	 jmp	 $LN3@get_free_e
$LN2@get_free_e:

; 393  : 	{
; 394  : 		ASSERT ((index >= 0) && (index < number_of_entities));

  0007e	83 7d 08 00	 cmp	 DWORD PTR _index$[ebp], 0
  00082	7c 0b		 jl	 SHORT $LN9@get_free_e
  00084	8b 45 08	 mov	 eax, DWORD PTR _index$[ebp]
  00087	3b 05 00 00 00
	00		 cmp	 eax, DWORD PTR ?number_of_entities@@3HA ; number_of_entities
  0008d	7c 18		 jl	 SHORT $LN8@get_free_e
$LN9@get_free_e:
  0008f	a1 00 00 00 00	 mov	 eax, DWORD PTR ?__LINE__Var@?0??get_free_entity@@YGPAUENTITY@@H@Z@4JA
  00094	83 c0 29	 add	 eax, 41			; 00000029H
  00097	50		 push	 eax
  00098	68 00 00 00 00	 push	 OFFSET ??_C@_0EM@CMJBMJMN@c?3?2users?2nhv90?2projects?2eech?2ap@
  0009d	68 00 00 00 00	 push	 OFFSET ??_C@_0CN@BMFDOBOO@?$CIindex?5?$DO?$DN?50?$CJ?5?$CG?$CG?5?$CIindex?5?$DM?5number@
  000a2	e8 00 00 00 00	 call	 ?process_assert@@YGXPBD0H@Z ; process_assert
$LN8@get_free_e:

; 395  : 
; 396  : 		en = get_local_entity_ptr (index);

  000a7	8b 45 08	 mov	 eax, DWORD PTR _index$[ebp]
  000aa	c1 e0 04	 shl	 eax, 4
  000ad	03 05 00 00 00
	00		 add	 eax, DWORD PTR ?entities@@3PAUENTITY@@A ; entities
  000b3	89 45 fc	 mov	 DWORD PTR _en$[ebp], eax

; 397  : 
; 398  : 		if (get_local_entity_type (en) != ENTITY_TYPE_UNKNOWN)

  000b6	74 0a		 je	 SHORT $LN16@get_free_e
  000b8	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  000bb	8b 08		 mov	 ecx, DWORD PTR [eax]
  000bd	89 4d b8	 mov	 DWORD PTR tv91[ebp], ecx
  000c0	eb 1d		 jmp	 SHORT $LN17@get_free_e
$LN16@get_free_e:
  000c2	68 8e 01 00 00	 push	 398			; 0000018eH
  000c7	68 00 00 00 00	 push	 OFFSET ??_C@_0EM@CMJBMJMN@c?3?2users?2nhv90?2projects?2eech?2ap@
  000cc	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?null_entity_pointer_message@@3PBDB ; null_entity_pointer_message
  000d2	52		 push	 edx
  000d3	e8 00 00 00 00	 call	 ?process_assert@@YGXPBD0H@Z ; process_assert
  000d8	c7 45 b8 00 00
	00 00		 mov	 DWORD PTR tv91[ebp], 0
$LN17@get_free_e:
  000df	83 7d b8 00	 cmp	 DWORD PTR tv91[ebp], 0
  000e3	74 4d		 je	 SHORT $LN10@get_free_e

; 399  : 		{
; 400  : 			debug_fatal ("Entity already in use: %s (index = %d)", get_local_entity_type_name (en), index);

  000e5	83 7d fc 00	 cmp	 DWORD PTR _en$[ebp], 0
  000e9	74 0a		 je	 SHORT $LN18@get_free_e
  000eb	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  000ee	8b 08		 mov	 ecx, DWORD PTR [eax]
  000f0	89 4d b8	 mov	 DWORD PTR tv132[ebp], ecx
  000f3	eb 21		 jmp	 SHORT $LN19@get_free_e
$LN18@get_free_e:
  000f5	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?__LINE__Var@?0??get_free_entity@@YGPAUENTITY@@H@Z@4JA
  000fb	83 c2 2f	 add	 edx, 47			; 0000002fH
  000fe	52		 push	 edx
  000ff	68 00 00 00 00	 push	 OFFSET ??_C@_0EM@CMJBMJMN@c?3?2users?2nhv90?2projects?2eech?2ap@
  00104	a1 00 00 00 00	 mov	 eax, DWORD PTR ?null_entity_pointer_message@@3PBDB ; null_entity_pointer_message
  00109	50		 push	 eax
  0010a	e8 00 00 00 00	 call	 ?process_assert@@YGXPBD0H@Z ; process_assert
  0010f	c7 45 b8 00 00
	00 00		 mov	 DWORD PTR tv132[ebp], 0
$LN19@get_free_e:
  00116	8b 4d 08	 mov	 ecx, DWORD PTR _index$[ebp]
  00119	51		 push	 ecx
  0011a	6b 55 b8 0c	 imul	 edx, DWORD PTR tv132[ebp], 12
  0011e	8b 82 00 00 00
	00		 mov	 eax, DWORD PTR ?entity_type_database@@3PAUENTITY_TYPE_DATA@@A[edx]
  00124	50		 push	 eax
  00125	68 00 00 00 00	 push	 OFFSET ??_C@_0CH@IHKGGMMB@Entity?5already?5in?5use?3?5?$CFs?5?$CIinde@
  0012a	e8 00 00 00 00	 call	 ?debug_fatal@@YAXPBDZZ	; debug_fatal
  0012f	83 c4 0c	 add	 esp, 12			; 0000000cH
$LN10@get_free_e:

; 401  : 		}
; 402  : 
; 403  : 		//
; 404  : 		// unlink entity from free list
; 405  : 		//
; 406  : 
; 407  : 		if (en->pred)

  00132	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  00135	83 78 0c 00	 cmp	 DWORD PTR [eax+12], 0
  00139	74 11		 je	 SHORT $LN11@get_free_e

; 408  : 		{
; 409  : 			en->pred->succ = en->succ;

  0013b	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  0013e	8b 48 0c	 mov	 ecx, DWORD PTR [eax+12]
  00141	8b 55 fc	 mov	 edx, DWORD PTR _en$[ebp]
  00144	8b 42 08	 mov	 eax, DWORD PTR [edx+8]
  00147	89 41 08	 mov	 DWORD PTR [ecx+8], eax

; 410  : 		}
; 411  : 		else

  0014a	eb 0c		 jmp	 SHORT $LN12@get_free_e
$LN11@get_free_e:

; 412  : 		{
; 413  : 			first_free_entity = en->succ;

  0014c	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  0014f	8b 48 08	 mov	 ecx, DWORD PTR [eax+8]
  00152	89 0d 00 00 00
	00		 mov	 DWORD PTR ?first_free_entity@@3PAUENTITY@@A, ecx ; first_free_entity
$LN12@get_free_e:

; 414  : 		}
; 415  : 
; 416  : 		if (en->succ)

  00158	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  0015b	83 78 08 00	 cmp	 DWORD PTR [eax+8], 0
  0015f	74 0f		 je	 SHORT $LN13@get_free_e

; 417  : 		{
; 418  : 			en->succ->pred = en->pred;

  00161	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  00164	8b 48 08	 mov	 ecx, DWORD PTR [eax+8]
  00167	8b 55 fc	 mov	 edx, DWORD PTR _en$[ebp]
  0016a	8b 42 0c	 mov	 eax, DWORD PTR [edx+12]
  0016d	89 41 0c	 mov	 DWORD PTR [ecx+12], eax
$LN13@get_free_e:

; 419  : 		}
; 420  : 
; 421  : 		//
; 422  : 		// insert entity into start of used list
; 423  : 		//
; 424  : 
; 425  : 		en->succ = first_used_entity;

  00170	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  00173	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?first_used_entity@@3PAUENTITY@@A ; first_used_entity
  00179	89 48 08	 mov	 DWORD PTR [eax+8], ecx

; 426  : 
; 427  : 		if (en->succ)

  0017c	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  0017f	83 78 08 00	 cmp	 DWORD PTR [eax+8], 0
  00183	74 0c		 je	 SHORT $LN14@get_free_e

; 428  : 		{
; 429  : 			en->succ->pred = en;

  00185	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  00188	8b 48 08	 mov	 ecx, DWORD PTR [eax+8]
  0018b	8b 55 fc	 mov	 edx, DWORD PTR _en$[ebp]
  0018e	89 51 0c	 mov	 DWORD PTR [ecx+12], edx
$LN14@get_free_e:

; 430  : 		}
; 431  : 
; 432  : 		en->pred = NULL;

  00191	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  00194	c7 40 0c 00 00
	00 00		 mov	 DWORD PTR [eax+12], 0

; 433  : 
; 434  : 		first_used_entity = en;

  0019b	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  0019e	a3 00 00 00 00	 mov	 DWORD PTR ?first_used_entity@@3PAUENTITY@@A, eax ; first_used_entity
$LN3@get_free_e:

; 435  : 	}
; 436  : 
; 437  : 	//debug_log ("EN_HEAP: index %d", get_local_entity_index (en));
; 438  : 
; 439  : 	return (en);

  001a3	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]

; 440  : }

  001a6	5f		 pop	 edi
  001a7	5e		 pop	 esi
  001a8	5b		 pop	 ebx
  001a9	8b e5		 mov	 esp, ebp
  001ab	5d		 pop	 ebp
  001ac	c2 04 00	 ret	 4
?get_free_entity@@YGPAUENTITY@@H@Z ENDP			; get_free_entity
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\system\en_main\en_heap.c
;	COMDAT ?deinitialise_entity_heap@@YGXXZ
_TEXT	SEGMENT
?deinitialise_entity_heap@@YGXXZ PROC			; deinitialise_entity_heap, COMDAT

; 263  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 40	 sub	 esp, 64			; 00000040H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 264  : 	check_no_entities_in_use ();

  00009	e8 00 00 00 00	 call	 ?check_no_entities_in_use@@YGXXZ ; check_no_entities_in_use

; 265  : 
; 266  : 	//Xhit: Check the local entity heap space also. (030428)
; 267  : 	//VJ 030508 if downwash 
; 268  : 	if (command_line_downwash)

  0000e	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?command_line_downwash@@3HA, 0 ; command_line_downwash
  00015	74 05		 je	 SHORT $LN2@deinitiali

; 269  : 		check_no_local_entities_in_use ();

  00017	e8 00 00 00 00	 call	 ?check_no_local_entities_in_use@@YGXXZ ; check_no_local_entities_in_use
$LN2@deinitiali:

; 270  : 
; 271  : 	free_mem (entities);

  0001c	a1 00 00 00 00	 mov	 eax, DWORD PTR ?entities@@3PAUENTITY@@A ; entities
  00021	50		 push	 eax
  00022	e8 00 00 00 00	 call	 ?free_mem@@YGXPAX@Z	; free_mem

; 272  : 
; 273  : 	number_of_entities = 0;

  00027	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?number_of_entities@@3HA, 0 ; number_of_entities

; 274  : 
; 275  : 	entities = NULL;

  00031	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?entities@@3PAUENTITY@@A, 0 ; entities

; 276  : 
; 277  : 	first_free_entity = NULL;

  0003b	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?first_free_entity@@3PAUENTITY@@A, 0 ; first_free_entity

; 278  : 
; 279  : 	first_used_entity = NULL;

  00045	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?first_used_entity@@3PAUENTITY@@A, 0 ; first_used_entity

; 280  : 
; 281  : 	//Xhit: Set the local entity heap pointers to NULL. (030428)
; 282  : 	//VJ 030508 if downwash 
; 283  : 	if (command_line_downwash)

  0004f	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?command_line_downwash@@3HA, 0 ; command_line_downwash
  00056	74 14		 je	 SHORT $LN1@deinitiali

; 284  : 	{
; 285  : 		first_free_local_entity = NULL;

  00058	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?first_free_local_entity@@3PAUENTITY@@A, 0 ; first_free_local_entity

; 286  : 		first_used_local_entity = NULL;

  00062	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?first_used_local_entity@@3PAUENTITY@@A, 0 ; first_used_local_entity
$LN1@deinitiali:

; 287  : 	}	
; 288  : 
; 289  : }

  0006c	5f		 pop	 edi
  0006d	5e		 pop	 esi
  0006e	5b		 pop	 ebx
  0006f	8b e5		 mov	 esp, ebp
  00071	5d		 pop	 ebp
  00072	c3		 ret	 0
?deinitialise_entity_heap@@YGXXZ ENDP			; deinitialise_entity_heap
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\system\en_main\en_heap.c
;	COMDAT ?reinitialise_entity_heap@@YGXXZ
_TEXT	SEGMENT
?reinitialise_entity_heap@@YGXXZ PROC			; reinitialise_entity_heap, COMDAT

; 247  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 40	 sub	 esp, 64			; 00000040H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 248  : 	check_no_entities_in_use ();

  00009	e8 00 00 00 00	 call	 ?check_no_entities_in_use@@YGXXZ ; check_no_entities_in_use

; 249  : 
; 250  : 	//Xhit: Check the local entity heap space also. (030428)
; 251  : 	//VJ 030508 if downwash 
; 252  : 	if (command_line_downwash)

  0000e	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?command_line_downwash@@3HA, 0 ; command_line_downwash
  00015	74 05		 je	 SHORT $LN2@reinitiali

; 253  : 		check_no_local_entities_in_use ();

  00017	e8 00 00 00 00	 call	 ?check_no_local_entities_in_use@@YGXXZ ; check_no_local_entities_in_use
$LN2@reinitiali:

; 254  : 
; 255  : 	reset_entity_heap ();

  0001c	e8 00 00 00 00	 call	 ?reset_entity_heap@@YGXXZ ; reset_entity_heap

; 256  : }

  00021	5f		 pop	 edi
  00022	5e		 pop	 esi
  00023	5b		 pop	 ebx
  00024	8b e5		 mov	 esp, ebp
  00026	5d		 pop	 ebp
  00027	c3		 ret	 0
?reinitialise_entity_heap@@YGXXZ ENDP			; reinitialise_entity_heap
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\system\en_main\en_heap.c
;	COMDAT ?initialise_entity_heap@@YGXH@Z
_TEXT	SEGMENT
_num_entities$ = 8					; size = 4
?initialise_entity_heap@@YGXH@Z PROC			; initialise_entity_heap, COMDAT

; 226  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 40	 sub	 esp, 64			; 00000040H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 227  : 	ASSERT ((num_entities > 0) && (num_entities < MAX_NUM_ENTITIES));

  00009	83 7d 08 00	 cmp	 DWORD PTR _num_entities$[ebp], 0
  0000d	7e 09		 jle	 SHORT $LN3@initialise
  0000f	81 7d 08 00 00
	08 00		 cmp	 DWORD PTR _num_entities$[ebp], 524288 ; 00080000H
  00016	7c 18		 jl	 SHORT $LN2@initialise
$LN3@initialise:
  00018	a1 00 00 00 00	 mov	 eax, DWORD PTR ?__LINE__Var@?0??initialise_entity_heap@@YGXH@Z@4JA
  0001d	83 c0 01	 add	 eax, 1
  00020	50		 push	 eax
  00021	68 00 00 00 00	 push	 OFFSET ??_C@_0EM@CMJBMJMN@c?3?2users?2nhv90?2projects?2eech?2ap@
  00026	68 00 00 00 00	 push	 OFFSET ??_C@_0DI@HBPAPOOD@?$CInum_entities?5?$DO?50?$CJ?5?$CG?$CG?5?$CInum_enti@
  0002b	e8 00 00 00 00	 call	 ?process_assert@@YGXPBD0H@Z ; process_assert
$LN2@initialise:

; 228  : 
; 229  : 	number_of_entities = num_entities;

  00030	8b 45 08	 mov	 eax, DWORD PTR _num_entities$[ebp]
  00033	a3 00 00 00 00	 mov	 DWORD PTR ?number_of_entities@@3HA, eax ; number_of_entities

; 230  : 
; 231  : 	//Xhit: The last 10000 entities in the heap is local only. (030428)
; 232  : 	//VJ 030508 if downwash 
; 233  : 	if (command_line_downwash)

  00038	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?command_line_downwash@@3HA, 0 ; command_line_downwash
  0003f	74 0f		 je	 SHORT $LN4@initialise

; 234  : 		start_of_local_entity_heap = number_of_entities - 10000;

  00041	a1 00 00 00 00	 mov	 eax, DWORD PTR ?number_of_entities@@3HA ; number_of_entities
  00046	2d 10 27 00 00	 sub	 eax, 10000		; 00002710H
  0004b	a3 00 00 00 00	 mov	 DWORD PTR ?start_of_local_entity_heap@@3HA, eax ; start_of_local_entity_heap
$LN4@initialise:

; 235  : 
; 236  : 	entities = (entity *) malloc_heap_mem (number_of_entities * sizeof (entity));

  00050	a1 00 00 00 00	 mov	 eax, DWORD PTR ?number_of_entities@@3HA ; number_of_entities
  00055	c1 e0 04	 shl	 eax, 4
  00058	50		 push	 eax
  00059	e8 00 00 00 00	 call	 ?malloc_heap_memory@@YGPAXI@Z ; malloc_heap_memory
  0005e	a3 00 00 00 00	 mov	 DWORD PTR ?entities@@3PAUENTITY@@A, eax ; entities

; 237  : 	//VJ 050308 if not downwash than number_of_entities = 125000 (original)
; 238  : 
; 239  : 	reset_entity_heap ();

  00063	e8 00 00 00 00	 call	 ?reset_entity_heap@@YGXXZ ; reset_entity_heap

; 240  : }

  00068	5f		 pop	 edi
  00069	5e		 pop	 esi
  0006a	5b		 pop	 ebx
  0006b	8b e5		 mov	 esp, ebp
  0006d	5d		 pop	 ebp
  0006e	c2 04 00	 ret	 4
?initialise_entity_heap@@YGXH@Z ENDP			; initialise_entity_heap
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\system\en_main\en_heap.c
;	COMDAT ?set_free_local_entity@@YGXPAUENTITY@@@Z
_TEXT	SEGMENT
_en$ = 8						; size = 4
?set_free_local_entity@@YGXPAUENTITY@@@Z PROC		; set_free_local_entity, COMDAT

; 448  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 40	 sub	 esp, 64			; 00000040H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 449  : 	ASSERT (en);

  00009	83 7d 08 00	 cmp	 DWORD PTR _en$[ebp], 0
  0000d	75 18		 jne	 SHORT $LN2@set_free_l
  0000f	a1 00 00 00 00	 mov	 eax, DWORD PTR ?__LINE__Var@?0??set_free_local_entity@@YGXPAUENTITY@@@Z@4JA
  00014	83 c0 01	 add	 eax, 1
  00017	50		 push	 eax
  00018	68 00 00 00 00	 push	 OFFSET ??_C@_0EM@CMJBMJMN@c?3?2users?2nhv90?2projects?2eech?2ap@
  0001d	68 00 00 00 00	 push	 OFFSET ??_C@_02LFNMGJAP@en@
  00022	e8 00 00 00 00	 call	 ?process_assert@@YGXPBD0H@Z ; process_assert
$LN2@set_free_l:

; 450  : 
; 451  : 	en->type = ENTITY_TYPE_UNKNOWN;

  00027	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  0002a	c7 00 00 00 00
	00		 mov	 DWORD PTR [eax], 0

; 452  : 
; 453  : 	en->data = NULL;

  00030	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  00033	c7 40 04 00 00
	00 00		 mov	 DWORD PTR [eax+4], 0

; 454  : 
; 455  : 	//
; 456  : 	// unlink entity from used list
; 457  : 	//
; 458  : 
; 459  : 	if (en->pred)

  0003a	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  0003d	83 78 0c 00	 cmp	 DWORD PTR [eax+12], 0
  00041	74 11		 je	 SHORT $LN3@set_free_l

; 460  : 	{
; 461  : 		en->pred->succ = en->succ;

  00043	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  00046	8b 48 0c	 mov	 ecx, DWORD PTR [eax+12]
  00049	8b 55 08	 mov	 edx, DWORD PTR _en$[ebp]
  0004c	8b 42 08	 mov	 eax, DWORD PTR [edx+8]
  0004f	89 41 08	 mov	 DWORD PTR [ecx+8], eax

; 462  : 	}
; 463  : 	else

  00052	eb 0c		 jmp	 SHORT $LN4@set_free_l
$LN3@set_free_l:

; 464  : 	{
; 465  : 		first_used_local_entity = en->succ;

  00054	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  00057	8b 48 08	 mov	 ecx, DWORD PTR [eax+8]
  0005a	89 0d 00 00 00
	00		 mov	 DWORD PTR ?first_used_local_entity@@3PAUENTITY@@A, ecx ; first_used_local_entity
$LN4@set_free_l:

; 466  : 	}
; 467  : 
; 468  : 	if (en->succ)

  00060	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  00063	83 78 08 00	 cmp	 DWORD PTR [eax+8], 0
  00067	74 0f		 je	 SHORT $LN5@set_free_l

; 469  : 	{
; 470  : 		en->succ->pred = en->pred;

  00069	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  0006c	8b 48 08	 mov	 ecx, DWORD PTR [eax+8]
  0006f	8b 55 08	 mov	 edx, DWORD PTR _en$[ebp]
  00072	8b 42 0c	 mov	 eax, DWORD PTR [edx+12]
  00075	89 41 0c	 mov	 DWORD PTR [ecx+12], eax
$LN5@set_free_l:

; 471  : 	}
; 472  : 
; 473  : 	//
; 474  : 	// link entity into start of free list
; 475  : 	//
; 476  : 
; 477  : 	en->succ = first_free_local_entity;

  00078	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  0007b	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?first_free_local_entity@@3PAUENTITY@@A ; first_free_local_entity
  00081	89 48 08	 mov	 DWORD PTR [eax+8], ecx

; 478  : 
; 479  : 	if (en->succ)

  00084	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  00087	83 78 08 00	 cmp	 DWORD PTR [eax+8], 0
  0008b	74 0c		 je	 SHORT $LN6@set_free_l

; 480  : 	{
; 481  : 		en->succ->pred = en;

  0008d	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  00090	8b 48 08	 mov	 ecx, DWORD PTR [eax+8]
  00093	8b 55 08	 mov	 edx, DWORD PTR _en$[ebp]
  00096	89 51 0c	 mov	 DWORD PTR [ecx+12], edx
$LN6@set_free_l:

; 482  : 	}
; 483  : 
; 484  : 	en->pred = NULL;

  00099	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  0009c	c7 40 0c 00 00
	00 00		 mov	 DWORD PTR [eax+12], 0

; 485  : 
; 486  : 	first_free_local_entity = en;

  000a3	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  000a6	a3 00 00 00 00	 mov	 DWORD PTR ?first_free_local_entity@@3PAUENTITY@@A, eax ; first_free_local_entity

; 487  : }

  000ab	5f		 pop	 edi
  000ac	5e		 pop	 esi
  000ad	5b		 pop	 ebx
  000ae	8b e5		 mov	 esp, ebp
  000b0	5d		 pop	 ebp
  000b1	c2 04 00	 ret	 4
?set_free_local_entity@@YGXPAUENTITY@@@Z ENDP		; set_free_local_entity
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\system\en_main\en_heap.c
;	COMDAT ?get_free_local_entity@@YGPAUENTITY@@H@Z
_TEXT	SEGMENT
_en$ = -4						; size = 4
_index$ = 8						; size = 4
?get_free_local_entity@@YGPAUENTITY@@H@Z PROC		; get_free_local_entity, COMDAT

; 297  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 44	 sub	 esp, 68			; 00000044H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 298  : 	entity
; 299  : 		*en;
; 300  : 
; 301  : 	if (index == ENTITY_INDEX_CREATE_LOCAL)

  00009	83 7d 08 fe	 cmp	 DWORD PTR _index$[ebp], -2 ; fffffffeH
  0000d	75 6c		 jne	 SHORT $LN2@get_free_l

; 302  : 	{
; 303  : 		en = first_free_local_entity;

  0000f	a1 00 00 00 00	 mov	 eax, DWORD PTR ?first_free_local_entity@@3PAUENTITY@@A ; first_free_local_entity
  00014	89 45 fc	 mov	 DWORD PTR _en$[ebp], eax

; 304  : 
; 305  : 		if (en)

  00017	83 7d fc 00	 cmp	 DWORD PTR _en$[ebp], 0
  0001b	74 4d		 je	 SHORT $LN4@get_free_l

; 306  : 		{
; 307  : 			//
; 308  : 			// unlink local_entity from start of free list
; 309  : 			//
; 310  : 
; 311  : 			first_free_local_entity = en->succ;

  0001d	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  00020	8b 48 08	 mov	 ecx, DWORD PTR [eax+8]
  00023	89 0d 00 00 00
	00		 mov	 DWORD PTR ?first_free_local_entity@@3PAUENTITY@@A, ecx ; first_free_local_entity

; 312  : 
; 313  : 			if (en->succ)

  00029	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  0002c	83 78 08 00	 cmp	 DWORD PTR [eax+8], 0
  00030	74 0d		 je	 SHORT $LN6@get_free_l

; 314  : 			{
; 315  : 				en->succ->pred = NULL;

  00032	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  00035	8b 48 08	 mov	 ecx, DWORD PTR [eax+8]
  00038	c7 41 0c 00 00
	00 00		 mov	 DWORD PTR [ecx+12], 0
$LN6@get_free_l:

; 316  : 			}
; 317  : 
; 318  : 			//
; 319  : 			// insert local_entity into start of used list (en->pred already set to NULL)
; 320  : 			//
; 321  : 
; 322  : 			en->succ = first_used_local_entity;

  0003f	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  00042	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?first_used_local_entity@@3PAUENTITY@@A ; first_used_local_entity
  00048	89 48 08	 mov	 DWORD PTR [eax+8], ecx

; 323  : 
; 324  : 			if (en->succ)

  0004b	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  0004e	83 78 08 00	 cmp	 DWORD PTR [eax+8], 0
  00052	74 0c		 je	 SHORT $LN7@get_free_l

; 325  : 			{
; 326  : 				en->succ->pred = en;

  00054	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  00057	8b 48 08	 mov	 ecx, DWORD PTR [eax+8]
  0005a	8b 55 fc	 mov	 edx, DWORD PTR _en$[ebp]
  0005d	89 51 0c	 mov	 DWORD PTR [ecx+12], edx
$LN7@get_free_l:

; 327  : 			}
; 328  : 
; 329  : 			first_used_local_entity = en;

  00060	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]
  00063	a3 00 00 00 00	 mov	 DWORD PTR ?first_used_local_entity@@3PAUENTITY@@A, eax ; first_used_local_entity

; 330  : 		}
; 331  : 		else

  00068	eb 0f		 jmp	 SHORT $LN5@get_free_l
$LN4@get_free_l:

; 332  : 		{
; 333  : 			debug_colour_log (DEBUG_COLOUR_RED, "WARNING! Failed to get a free local_entity");

  0006a	68 00 00 00 00	 push	 OFFSET ??_C@_0CL@LPNABDKG@WARNING?$CB?5Failed?5to?5get?5a?5free?5l@
  0006f	6a 04		 push	 4
  00071	e8 00 00 00 00	 call	 ?debug_colour_log@@YAXW4DEBUG_COLOURS@@PBDZZ ; debug_colour_log
  00076	83 c4 08	 add	 esp, 8
$LN5@get_free_l:

; 334  : 		}
; 335  : 	}
; 336  : 	else

  00079	eb 1e		 jmp	 SHORT $LN3@get_free_l
$LN2@get_free_l:

; 337  : 	{
; 338  : 		debug_fatal ("Entity already in use: %s (index = %d)", entity_type_names[index], index);

  0007b	8b 45 08	 mov	 eax, DWORD PTR _index$[ebp]
  0007e	50		 push	 eax
  0007f	8b 4d 08	 mov	 ecx, DWORD PTR _index$[ebp]
  00082	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?entity_type_names@@3PAPBDA ; entity_type_names
  00088	8b 04 8a	 mov	 eax, DWORD PTR [edx+ecx*4]
  0008b	50		 push	 eax
  0008c	68 00 00 00 00	 push	 OFFSET ??_C@_0CH@IHKGGMMB@Entity?5already?5in?5use?3?5?$CFs?5?$CIinde@
  00091	e8 00 00 00 00	 call	 ?debug_fatal@@YAXPBDZZ	; debug_fatal
  00096	83 c4 0c	 add	 esp, 12			; 0000000cH
$LN3@get_free_l:

; 339  : 	}
; 340  : 
; 341  : 	return (en);

  00099	8b 45 fc	 mov	 eax, DWORD PTR _en$[ebp]

; 342  : }

  0009c	5f		 pop	 edi
  0009d	5e		 pop	 esi
  0009e	5b		 pop	 ebx
  0009f	8b e5		 mov	 esp, ebp
  000a1	5d		 pop	 ebp
  000a2	c2 04 00	 ret	 4
?get_free_local_entity@@YGPAUENTITY@@H@Z ENDP		; get_free_local_entity
_TEXT	ENDS
END
