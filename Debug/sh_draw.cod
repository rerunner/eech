; Listing generated by Microsoft (R) Optimizing Compiler Version 19.16.27045.0 

	TITLE	C:\Users\nhv90\Projects\eech\aphavoc\source\entity\mobile\vehicle\ship\sh_draw.c
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB MSVCRTD
INCLUDELIB OLDNAMES

PUBLIC	?overload_ship_vehicle_draw_functions@@YGXXZ	; overload_ship_vehicle_draw_functions
PUBLIC	?__LINE__Var@?0??draw_local_3d_object@@YGXPAUENTITY@@M@Z@4JA ; `draw_local_3d_object'::`1'::__LINE__Var
PUBLIC	??_C@_0FB@KOEJNOGA@c?3?2users?2nhv90?2projects?2eech?2ap@ ; `string'
EXTRN	_memcpy:PROC
EXTRN	?process_assert@@YGXPBD0H@Z:PROC		; process_assert
EXTRN	?insert_zbiased_object_into_3d_scene@@YGXW4OBJECT_3D_DRAWING_TYPES@@PAXM@Z:PROC ; insert_zbiased_object_into_3d_scene
EXTRN	?animate_and_draw_entity_muzzle_flash_effect@@YGXPAUENTITY@@@Z:PROC ; animate_and_draw_entity_muzzle_flash_effect
EXTRN	?animate_vehicle_loading_doors@@YGXPAUENTITY@@@Z:PROC ; animate_vehicle_loading_doors
EXTRN	?animate_vehicle_weapon_system_ready@@YGXPAUENTITY@@@Z:PROC ; animate_vehicle_weapon_system_ready
EXTRN	?animate_vehicle_radar@@YGXPAUENTITY@@@Z:PROC	; animate_vehicle_radar
EXTRN	?animate_ship_rotors@@YGXPAUENTITY@@@Z:PROC	; animate_ship_rotors
EXTRN	?null_entity_pointer_message@@3PBDB:DWORD	; null_entity_pointer_message
EXTRN	?fn_draw_local_entity_3d_object@@3PAP6GXPAUENTITY@@M@ZA:BYTE ; fn_draw_local_entity_3d_object
EXTRN	?overload_invalid_int_type_message@@3PBDB:DWORD	; overload_invalid_int_type_message
EXTRN	?fn_get_local_entity_int_value@@3PAY0BBH@P6GHPAUENTITY@@W4INT_TYPES@@@ZA:BYTE ; fn_get_local_entity_int_value
EXTRN	?session_entity@@3PAUENTITY@@A:DWORD		; session_entity
EXTRN	__fltused:DWORD
;	COMDAT ??_C@_0FB@KOEJNOGA@c?3?2users?2nhv90?2projects?2eech?2ap@
CONST	SEGMENT
??_C@_0FB@KOEJNOGA@c?3?2users?2nhv90?2projects?2eech?2ap@ DB 'c:\users\nh'
	DB	'v90\projects\eech\aphavoc\source\entity\mobile\vehicle\ship\s'
	DB	'h_draw.c', 00H				; `string'
CONST	ENDS
;	COMDAT ?__LINE__Var@?0??draw_local_3d_object@@YGXPAUENTITY@@M@Z@4JA
_DATA	SEGMENT
?__LINE__Var@?0??draw_local_3d_object@@YGXPAUENTITY@@M@Z@4JA DD 050H ; `draw_local_3d_object'::`1'::__LINE__Var
_DATA	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\mobile\vehicle\ship\sh_draw.c
;	COMDAT ?draw_local_3d_object@@YGXPAUENTITY@@M@Z
_TEXT	SEGMENT
tv133 = -80						; size = 4
tv144 = -76						; size = 4
tv93 = -76						; size = 4
_day_segment_type$ = -8					; size = 4
_raw$ = -4						; size = 4
_en$ = 8						; size = 4
_range$ = 12						; size = 4
?draw_local_3d_object@@YGXPAUENTITY@@M@Z PROC		; draw_local_3d_object, COMDAT

; 80   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 50	 sub	 esp, 80			; 00000050H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 81   : 	ship_vehicle
; 82   : 		*raw;
; 83   : 
; 84   : 	day_segment_types
; 85   : 		day_segment_type;
; 86   : 
; 87   : 	raw = (ship_vehicle *) get_local_entity_data (en);

  00009	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  0000c	8b 48 04	 mov	 ecx, DWORD PTR [eax+4]
  0000f	89 4d fc	 mov	 DWORD PTR _raw$[ebp], ecx

; 88   : 
; 89   : 	//
; 90   : 	// update viewpoint
; 91   : 	//
; 92   : 
; 93   : 	raw->vh.inst3d->vp.position = raw->vh.mob.position;

  00012	8b 45 fc	 mov	 eax, DWORD PTR _raw$[ebp]
  00015	83 c0 04	 add	 eax, 4
  00018	8b 4d fc	 mov	 ecx, DWORD PTR _raw$[ebp]
  0001b	8b 91 84 00 00
	00		 mov	 edx, DWORD PTR [ecx+132]
  00021	83 c2 08	 add	 edx, 8
  00024	8b 08		 mov	 ecx, DWORD PTR [eax]
  00026	89 0a		 mov	 DWORD PTR [edx], ecx
  00028	8b 48 04	 mov	 ecx, DWORD PTR [eax+4]
  0002b	89 4a 04	 mov	 DWORD PTR [edx+4], ecx
  0002e	8b 40 08	 mov	 eax, DWORD PTR [eax+8]
  00031	89 42 08	 mov	 DWORD PTR [edx+8], eax

; 94   : 
; 95   : 	memcpy (&raw->vh.inst3d->vp.attitude, &raw->vh.mob.attitude, sizeof (matrix3x3));

  00034	6a 24		 push	 36			; 00000024H
  00036	8b 45 fc	 mov	 eax, DWORD PTR _raw$[ebp]
  00039	83 c0 10	 add	 eax, 16			; 00000010H
  0003c	50		 push	 eax
  0003d	8b 4d fc	 mov	 ecx, DWORD PTR _raw$[ebp]
  00040	8b 91 84 00 00
	00		 mov	 edx, DWORD PTR [ecx+132]
  00046	83 c2 14	 add	 edx, 20			; 00000014H
  00049	52		 push	 edx
  0004a	e8 00 00 00 00	 call	 _memcpy
  0004f	83 c4 0c	 add	 esp, 12			; 0000000cH

; 96   : 
; 97   : 	//
; 98   : 	// animate
; 99   : 	//
; 100  : 
; 101  : 	animate_ship_rotors (en);

  00052	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  00055	50		 push	 eax
  00056	e8 00 00 00 00	 call	 ?animate_ship_rotors@@YGXPAUENTITY@@@Z ; animate_ship_rotors

; 102  : 
; 103  : 	animate_vehicle_loading_doors (en);

  0005b	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  0005e	50		 push	 eax
  0005f	e8 00 00 00 00	 call	 ?animate_vehicle_loading_doors@@YGXPAUENTITY@@@Z ; animate_vehicle_loading_doors

; 104  : 
; 105  : 	animate_vehicle_radar (en);

  00064	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  00067	50		 push	 eax
  00068	e8 00 00 00 00	 call	 ?animate_vehicle_radar@@YGXPAUENTITY@@@Z ; animate_vehicle_radar

; 106  : 
; 107  : 	animate_vehicle_weapon_system_ready (en);

  0006d	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  00070	50		 push	 eax
  00071	e8 00 00 00 00	 call	 ?animate_vehicle_weapon_system_ready@@YGXPAUENTITY@@@Z ; animate_vehicle_weapon_system_ready

; 108  : 
; 109  : 	day_segment_type = (day_segment_types) get_local_entity_int_value (get_session_entity (), INT_TYPE_DAY_SEGMENT_TYPE);

  00076	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?session_entity@@3PAUENTITY@@A, 0 ; session_entity
  0007d	74 0c		 je	 SHORT $LN3@draw_local
  0007f	a1 00 00 00 00	 mov	 eax, DWORD PTR ?session_entity@@3PAUENTITY@@A ; session_entity
  00084	8b 08		 mov	 ecx, DWORD PTR [eax]
  00086	89 4d b4	 mov	 DWORD PTR tv93[ebp], ecx
  00089	eb 21		 jmp	 SHORT $LN4@draw_local
$LN3@draw_local:
  0008b	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?__LINE__Var@?0??draw_local_3d_object@@YGXPAUENTITY@@M@Z@4JA
  00091	83 c2 1d	 add	 edx, 29			; 0000001dH
  00094	52		 push	 edx
  00095	68 00 00 00 00	 push	 OFFSET ??_C@_0FB@KOEJNOGA@c?3?2users?2nhv90?2projects?2eech?2ap@
  0009a	a1 00 00 00 00	 mov	 eax, DWORD PTR ?null_entity_pointer_message@@3PBDB ; null_entity_pointer_message
  0009f	50		 push	 eax
  000a0	e8 00 00 00 00	 call	 ?process_assert@@YGXPBD0H@Z ; process_assert
  000a5	c7 45 b4 00 00
	00 00		 mov	 DWORD PTR tv93[ebp], 0
$LN4@draw_local:
  000ac	b9 01 00 00 00	 mov	 ecx, 1
  000b1	85 c9		 test	 ecx, ecx
  000b3	74 09		 je	 SHORT $LN5@draw_local
  000b5	c7 45 b0 27 00
	00 00		 mov	 DWORD PTR tv133[ebp], 39 ; 00000027H
  000bc	eb 21		 jmp	 SHORT $LN6@draw_local
$LN5@draw_local:
  000be	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?__LINE__Var@?0??draw_local_3d_object@@YGXPAUENTITY@@M@Z@4JA
  000c4	83 c2 1d	 add	 edx, 29			; 0000001dH
  000c7	52		 push	 edx
  000c8	68 00 00 00 00	 push	 OFFSET ??_C@_0FB@KOEJNOGA@c?3?2users?2nhv90?2projects?2eech?2ap@
  000cd	a1 00 00 00 00	 mov	 eax, DWORD PTR ?overload_invalid_int_type_message@@3PBDB ; overload_invalid_int_type_message
  000d2	50		 push	 eax
  000d3	e8 00 00 00 00	 call	 ?process_assert@@YGXPBD0H@Z ; process_assert
  000d8	c7 45 b0 00 00
	00 00		 mov	 DWORD PTR tv133[ebp], 0
$LN6@draw_local:
  000df	6a 27		 push	 39			; 00000027H
  000e1	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?session_entity@@3PAUENTITY@@A ; session_entity
  000e7	51		 push	 ecx
  000e8	69 55 b4 5c 04
	00 00		 imul	 edx, DWORD PTR tv93[ebp], 1116
  000ef	8b 45 b0	 mov	 eax, DWORD PTR tv133[ebp]
  000f2	8b 8c 82 00 00
	00 00		 mov	 ecx, DWORD PTR ?fn_get_local_entity_int_value@@3PAY0BBH@P6GHPAUENTITY@@W4INT_TYPES@@@ZA[edx+eax*4]
  000f9	ff d1		 call	 ecx
  000fb	89 45 f8	 mov	 DWORD PTR _day_segment_type$[ebp], eax

; 110  : 
; 111  : 	raw->vh.inst3d->object_internal_lighting = ((day_segment_type == DAY_SEGMENT_TYPE_NIGHT) || (day_segment_type == DAY_SEGMENT_TYPE_DUSK));

  000fe	83 7d f8 03	 cmp	 DWORD PTR _day_segment_type$[ebp], 3
  00102	74 0f		 je	 SHORT $LN7@draw_local
  00104	83 7d f8 02	 cmp	 DWORD PTR _day_segment_type$[ebp], 2
  00108	74 09		 je	 SHORT $LN7@draw_local
  0010a	c7 45 b4 00 00
	00 00		 mov	 DWORD PTR tv144[ebp], 0
  00111	eb 07		 jmp	 SHORT $LN8@draw_local
$LN7@draw_local:
  00113	c7 45 b4 01 00
	00 00		 mov	 DWORD PTR tv144[ebp], 1
$LN8@draw_local:
  0011a	8b 45 fc	 mov	 eax, DWORD PTR _raw$[ebp]
  0011d	8b 88 84 00 00
	00		 mov	 ecx, DWORD PTR [eax+132]
  00123	8b 55 b4	 mov	 edx, DWORD PTR tv144[ebp]
  00126	83 e2 01	 and	 edx, 1
  00129	c1 e2 03	 shl	 edx, 3
  0012c	8b 41 50	 mov	 eax, DWORD PTR [ecx+80]
  0012f	83 e0 f7	 and	 eax, -9			; fffffff7H
  00132	0b c2		 or	 eax, edx
  00134	8b 4d fc	 mov	 ecx, DWORD PTR _raw$[ebp]
  00137	8b 91 84 00 00
	00		 mov	 edx, DWORD PTR [ecx+132]
  0013d	89 42 50	 mov	 DWORD PTR [edx+80], eax

; 112  : 
; 113  : 	raw->vh.inst3d->object_sprite_lights = raw->vh.inst3d->object_internal_lighting;

  00140	8b 45 fc	 mov	 eax, DWORD PTR _raw$[ebp]
  00143	8b 88 84 00 00
	00		 mov	 ecx, DWORD PTR [eax+132]
  00149	8b 51 50	 mov	 edx, DWORD PTR [ecx+80]
  0014c	c1 ea 03	 shr	 edx, 3
  0014f	83 e2 01	 and	 edx, 1
  00152	8b 45 fc	 mov	 eax, DWORD PTR _raw$[ebp]
  00155	8b 88 84 00 00
	00		 mov	 ecx, DWORD PTR [eax+132]
  0015b	83 e2 01	 and	 edx, 1
  0015e	c1 e2 0c	 shl	 edx, 12			; 0000000cH
  00161	8b 41 50	 mov	 eax, DWORD PTR [ecx+80]
  00164	25 ff ef ff ff	 and	 eax, -4097		; ffffefffH
  00169	0b c2		 or	 eax, edx
  0016b	8b 4d fc	 mov	 ecx, DWORD PTR _raw$[ebp]
  0016e	8b 91 84 00 00
	00		 mov	 edx, DWORD PTR [ecx+132]
  00174	89 42 50	 mov	 DWORD PTR [edx+80], eax

; 114  : 
; 115  : 	//
; 116  : 	// draw
; 117  : 	//
; 118  : 
; 119  : 	animate_and_draw_entity_muzzle_flash_effect (en);

  00177	8b 45 08	 mov	 eax, DWORD PTR _en$[ebp]
  0017a	50		 push	 eax
  0017b	e8 00 00 00 00	 call	 ?animate_and_draw_entity_muzzle_flash_effect@@YGXPAUENTITY@@@Z ; animate_and_draw_entity_muzzle_flash_effect

; 120  : 
; 121  : 	raw->vh.inst3d->object_has_shadow = FALSE;

  00180	8b 45 fc	 mov	 eax, DWORD PTR _raw$[ebp]
  00183	8b 88 84 00 00
	00		 mov	 ecx, DWORD PTR [eax+132]
  00189	8b 51 50	 mov	 edx, DWORD PTR [ecx+80]
  0018c	83 e2 fb	 and	 edx, -5			; fffffffbH
  0018f	8b 45 fc	 mov	 eax, DWORD PTR _raw$[ebp]
  00192	8b 88 84 00 00
	00		 mov	 ecx, DWORD PTR [eax+132]
  00198	89 51 50	 mov	 DWORD PTR [ecx+80], edx

; 122  : 
; 123  : 	insert_object_into_3d_scene (OBJECT_3D_DRAW_TYPE_OBJECT, raw->vh.inst3d);

  0019b	51		 push	 ecx
  0019c	0f 57 c0	 xorps	 xmm0, xmm0
  0019f	f3 0f 11 04 24	 movss	 DWORD PTR [esp], xmm0
  001a4	8b 45 fc	 mov	 eax, DWORD PTR _raw$[ebp]
  001a7	8b 88 84 00 00
	00		 mov	 ecx, DWORD PTR [eax+132]
  001ad	51		 push	 ecx
  001ae	6a 01		 push	 1
  001b0	e8 00 00 00 00	 call	 ?insert_zbiased_object_into_3d_scene@@YGXW4OBJECT_3D_DRAWING_TYPES@@PAXM@Z ; insert_zbiased_object_into_3d_scene

; 124  : }

  001b5	5f		 pop	 edi
  001b6	5e		 pop	 esi
  001b7	5b		 pop	 ebx
  001b8	8b e5		 mov	 esp, ebp
  001ba	5d		 pop	 ebp
  001bb	c2 08 00	 ret	 8
?draw_local_3d_object@@YGXPAUENTITY@@M@Z ENDP		; draw_local_3d_object
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\entity\mobile\vehicle\ship\sh_draw.c
;	COMDAT ?overload_ship_vehicle_draw_functions@@YGXXZ
_TEXT	SEGMENT
?overload_ship_vehicle_draw_functions@@YGXXZ PROC	; overload_ship_vehicle_draw_functions, COMDAT

; 131  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 40	 sub	 esp, 64			; 00000040H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 132  : 	fn_draw_local_entity_3d_object[ENTITY_TYPE_SHIP_VEHICLE]	= draw_local_3d_object;

  00009	b8 04 00 00 00	 mov	 eax, 4
  0000e	6b c8 1c	 imul	 ecx, eax, 28
  00011	c7 81 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?fn_draw_local_entity_3d_object@@3PAP6GXPAUENTITY@@M@ZA[ecx], OFFSET ?draw_local_3d_object@@YGXPAUENTITY@@M@Z ; draw_local_3d_object

; 133  : }

  0001b	5f		 pop	 edi
  0001c	5e		 pop	 esi
  0001d	5b		 pop	 ebx
  0001e	8b e5		 mov	 esp, ebp
  00020	5d		 pop	 ebp
  00021	c3		 ret	 0
?overload_ship_vehicle_draw_functions@@YGXXZ ENDP	; overload_ship_vehicle_draw_functions
_TEXT	ENDS
END
