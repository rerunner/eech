; Listing generated by Microsoft (R) Optimizing Compiler Version 19.16.27045.0 

	TITLE	C:\Users\nhv90\Projects\eech\aphavoc\source\comms\commsserver.c
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB MSVCRTD
INCLUDELIB OLDNAMES

PUBLIC	?register_connection@@YGPAUCONNECTION_LIST_TYPE@@K@Z ; register_connection
PUBLIC	?unregister_connection@@YGXK@Z			; unregister_connection
PUBLIC	?get_connection_list_head@@YGPAUCONNECTION_LIST_TYPE@@XZ ; get_connection_list_head
PUBLIC	?get_connection_list_item@@YGPAUCONNECTION_LIST_TYPE@@K@Z ; get_connection_list_item
PUBLIC	?validate_connections@@YGXXZ			; validate_connections
PUBLIC	?server_create_session@@YGHXZ			; server_create_session
PUBLIC	?get_gunships_connection_list_item@@YGPAUCONNECTION_LIST_TYPE@@PAUENTITY@@@Z ; get_gunships_connection_list_item
PUBLIC	??_C@_0CJ@GFLGHPNP@SERVER?3?5already?5registered?5conn@ ; `string'
PUBLIC	??_C@_0DM@JOODOOMB@SERVER?3?5connection?5receive?5buff@ ; `string'
PUBLIC	??_C@_0CG@NCGBHMNJ@SERVER?3?5registering?5new?5connect@ ; `string'
PUBLIC	??_C@_0BG@BAHIHKMO@Connection?5id?5?$CFd?5data@	; `string'
PUBLIC	??_C@_0BL@EENIOLGB@?7number?5of?5packets?7?7?7?7?$DN?5?$CFd@ ; `string'
PUBLIC	??_C@_0BC@IAFFBNPD@?7size?7?7?7?7?7?7?7?7?$DN?5?$CFd@ ; `string'
PUBLIC	??_C@_0BK@HHDFJLH@?7send?5personal?5id?7?7?7?7?$DN?5?$CFd@ ; `string'
PUBLIC	??_C@_0BK@BGDKANOE@?7receive?5group?5id?7?7?7?7?$DN?5?$CFd@ ; `string'
PUBLIC	??_C@_0BN@KJCLIFFG@?7receive?5personal?5id?7?7?7?7?$DN?5?$CFd@ ; `string'
PUBLIC	??_C@_0BL@MPBMHENP@?7rerequest?5counter?7?7?7?7?$DN?5?$CFd@ ; `string'
PUBLIC	??_C@_0BH@NEJJELLJ@?7gunship?5ptr?7?7?7?7?7?7?$DN?5?$CFd@ ; `string'
PUBLIC	??_C@_0BH@BDNANHAP@?7player?5ptr?7?7?7?7?7?7?7?$DN?5?$CFd@ ; `string'
PUBLIC	??_C@_0BI@FICLJKLI@?7gunship?5number?7?7?7?7?$DN?5?$CFd@ ; `string'
PUBLIC	??_C@_0BN@BNNIKHFG@?7group?5resend?5time?7?7?7?7?5?7?$DN?5?$CFf@ ; `string'
PUBLIC	??_C@_0BP@OHJJIGDE@?7personal?5resend?5time?7?7?7?5?7?$DN?5?$CFf@ ; `string'
PUBLIC	??_C@_0CE@IGBAFIIC@SERVER?3?5unregistering?5connectio@ ; `string'
PUBLIC	??_C@_0DM@MNHIDIBG@SERVER?3?5Error?3?5unregister_conne@ ; `string'
PUBLIC	??_C@_0BK@PMBMHEKE@SERVER?3?5new?5connection?5?$CFd@ ; `string'
PUBLIC	?__LINE__Var@?0??validate_connections@@YGXXZ@4JA ; `validate_connections'::`1'::__LINE__Var
PUBLIC	??_C@_0EA@FAGNCFK@c?3?2users?2nhv90?2projects?2eech?2ap@ ; `string'
PUBLIC	??_C@_0BC@KLKOHLBP@?$CFs?5removed?5by?5cvc@	; `string'
PUBLIC	??_C@_0BH@LHCPBMAM@Unknown?5player?5removed@	; `string'
PUBLIC	??_C@_0CN@JGJKIPBH@SERVER?3?5TIMEOUT?3?5Unregistering?5@ ; `string'
PUBLIC	??_C@_0BP@PFIDCJBG@SERVER?3?5TIMEOUT?3?5Quitting?5game@ ; `string'
PUBLIC	??_C@_0CJ@IMKOJMKF@SERVER?3?5sending?5?$CFd?5CONNECTION_V@ ; `string'
EXTRN	_memset:PROC
EXTRN	?process_assert@@YGXPBD0H@Z:PROC		; process_assert
EXTRN	?server_log@@YAXPBDZZ:PROC			; server_log
EXTRN	?debug_log@@YAXPBDZZ:PROC			; debug_log
EXTRN	?debug_watch@@YGXPBDW4mt_type@@PAX@Z:PROC	; debug_watch
EXTRN	?get_system_time@@YGIXZ:PROC			; get_system_time
EXTRN	?malloc_heap_memory@@YGPAXI@Z:PROC		; malloc_heap_memory
EXTRN	?free_mem@@YGXPAX@Z:PROC			; free_mem
EXTRN	?direct_play_close_session@@YGHXZ:PROC		; direct_play_close_session
EXTRN	?direct_play_create_session@@YGHH@Z:PROC	; direct_play_create_session
EXTRN	?direct_play_session_capabilities@@YGHXZ:PROC	; direct_play_session_capabilities
EXTRN	?direct_play_create_player@@YGHXZ:PROC		; direct_play_create_player
EXTRN	?direct_play_get_group_id@@YGHXZ:PROC		; direct_play_get_group_id
EXTRN	?direct_play_get_player_id@@YGHXZ:PROC		; direct_play_get_player_id
EXTRN	?direct_play_get_connection_data@@YGPAUCONNECTION_DATA_TYPE@@XZ:PROC ; direct_play_get_connection_data
EXTRN	?direct_play_set_session_type_and_name@@YGXH@Z:PROC ; direct_play_set_session_type_and_name
EXTRN	?send_packet@@YGXKW4PACKET_TYPES@@PAEHW4SEND_TYPES@@@Z:PROC ; send_packet
EXTRN	?free_connection_packets@@YGXK@Z:PROC		; free_connection_packets
EXTRN	?start_game_exit@@YGXW4GAME_EXIT_TYPES@@H@Z:PROC ; start_game_exit
EXTRN	?set_min_time_acceleration@@YGXPAUEVENT@@@Z:PROC ; set_min_time_acceleration
EXTRN	?command_line_comms_connection_receive_size@@3HA:DWORD ; command_line_comms_connection_receive_size
EXTRN	?command_line_comms_timeout@@3HA:DWORD		; command_line_comms_timeout
EXTRN	?null_entity_pointer_message@@3PBDB:DWORD	; null_entity_pointer_message
EXTRN	?system_comms_model@@3W4COMMS_MODEL_TYPES@@A:DWORD ; system_comms_model
EXTRN	?system_server_id@@3KA:DWORD			; system_server_id
EXTRN	?fn_destroy_client_server_entity@@3PAY01P6GXPAUENTITY@@@ZA:BYTE ; fn_destroy_client_server_entity
EXTRN	?overload_invalid_int_type_message@@3PBDB:DWORD	; overload_invalid_int_type_message
EXTRN	?fn_set_client_server_entity_int_value@@3PAY1BBH@1P6GXPAUENTITY@@W4INT_TYPES@@H@ZA:BYTE ; fn_set_client_server_entity_int_value
EXTRN	?overload_invalid_string_type_message@@3PBDB:DWORD ; overload_invalid_string_type_message
EXTRN	?fn_get_local_entity_string@@3PAY0N@P6GPBDPAUENTITY@@W4STRING_TYPES@@@ZA:BYTE ; fn_get_local_entity_string
EXTRN	?game_type@@3W4GAME_TYPES@@A:DWORD		; game_type
EXTRN	__fltused:DWORD
_BSS	SEGMENT
?connection_list_head@@3PAUCONNECTION_LIST_TYPE@@A DD 01H DUP (?) ; connection_list_head
_BSS	ENDS
;	COMDAT ??_C@_0CJ@IMKOJMKF@SERVER?3?5sending?5?$CFd?5CONNECTION_V@
CONST	SEGMENT
??_C@_0CJ@IMKOJMKF@SERVER?3?5sending?5?$CFd?5CONNECTION_V@ DB 'SERVER: se'
	DB	'nding %d CONNECTION_VALIDATION', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0BP@PFIDCJBG@SERVER?3?5TIMEOUT?3?5Quitting?5game@
CONST	SEGMENT
??_C@_0BP@PFIDCJBG@SERVER?3?5TIMEOUT?3?5Quitting?5game@ DB 'SERVER: TIMEO'
	DB	'UT: Quitting game', 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0CN@JGJKIPBH@SERVER?3?5TIMEOUT?3?5Unregistering?5@
CONST	SEGMENT
??_C@_0CN@JGJKIPBH@SERVER?3?5TIMEOUT?3?5Unregistering?5@ DB 'SERVER: TIME'
	DB	'OUT: Unregistering connection %d', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0BH@LHCPBMAM@Unknown?5player?5removed@
CONST	SEGMENT
??_C@_0BH@LHCPBMAM@Unknown?5player?5removed@ DB 'Unknown player removed', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BC@KLKOHLBP@?$CFs?5removed?5by?5cvc@
CONST	SEGMENT
??_C@_0BC@KLKOHLBP@?$CFs?5removed?5by?5cvc@ DB '%s removed by cvc', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0EA@FAGNCFK@c?3?2users?2nhv90?2projects?2eech?2ap@
CONST	SEGMENT
??_C@_0EA@FAGNCFK@c?3?2users?2nhv90?2projects?2eech?2ap@ DB 'c:\users\nhv'
	DB	'90\projects\eech\aphavoc\source\comms\commsserver.c', 00H ; `string'
CONST	ENDS
;	COMDAT ?__LINE__Var@?0??validate_connections@@YGXXZ@4JA
_DATA	SEGMENT
?__LINE__Var@?0??validate_connections@@YGXXZ@4JA DD 011aH ; `validate_connections'::`1'::__LINE__Var
_DATA	ENDS
;	COMDAT ??_C@_0BK@PMBMHEKE@SERVER?3?5new?5connection?5?$CFd@
CONST	SEGMENT
??_C@_0BK@PMBMHEKE@SERVER?3?5new?5connection?5?$CFd@ DB 'SERVER: new conn'
	DB	'ection %d', 00H				; `string'
CONST	ENDS
;	COMDAT ??_C@_0DM@MNHIDIBG@SERVER?3?5Error?3?5unregister_conne@
CONST	SEGMENT
??_C@_0DM@MNHIDIBG@SERVER?3?5Error?3?5unregister_conne@ DB 'SERVER: Error'
	DB	': unregister_connection, connection_id unknown', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0CE@IGBAFIIC@SERVER?3?5unregistering?5connectio@
CONST	SEGMENT
??_C@_0CE@IGBAFIIC@SERVER?3?5unregistering?5connectio@ DB 'SERVER: unregi'
	DB	'stering connection %d', 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0BP@OHJJIGDE@?7personal?5resend?5time?7?7?7?5?7?$DN?5?$CFf@
CONST	SEGMENT
??_C@_0BP@OHJJIGDE@?7personal?5resend?5time?7?7?7?5?7?$DN?5?$CFf@ DB 09H, 'p'
	DB	'ersonal resend time', 09H, 09H, 09H, ' ', 09H, '= %f', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BN@BNNIKHFG@?7group?5resend?5time?7?7?7?7?5?7?$DN?5?$CFf@
CONST	SEGMENT
??_C@_0BN@BNNIKHFG@?7group?5resend?5time?7?7?7?7?5?7?$DN?5?$CFf@ DB 09H, 'g'
	DB	'roup resend time', 09H, 09H, 09H, 09H, ' ', 09H, '= %f', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BI@FICLJKLI@?7gunship?5number?7?7?7?7?$DN?5?$CFd@
CONST	SEGMENT
??_C@_0BI@FICLJKLI@?7gunship?5number?7?7?7?7?$DN?5?$CFd@ DB 09H, 'gunship'
	DB	' number', 09H, 09H, 09H, 09H, '= %d', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0BH@BDNANHAP@?7player?5ptr?7?7?7?7?7?7?7?$DN?5?$CFd@
CONST	SEGMENT
??_C@_0BH@BDNANHAP@?7player?5ptr?7?7?7?7?7?7?7?$DN?5?$CFd@ DB 09H, 'playe'
	DB	'r ptr', 09H, 09H, 09H, 09H, 09H, 09H, 09H, '= %d', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BH@NEJJELLJ@?7gunship?5ptr?7?7?7?7?7?7?$DN?5?$CFd@
CONST	SEGMENT
??_C@_0BH@NEJJELLJ@?7gunship?5ptr?7?7?7?7?7?7?$DN?5?$CFd@ DB 09H, 'gunshi'
	DB	'p ptr', 09H, 09H, 09H, 09H, 09H, 09H, '= %d', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BL@MPBMHENP@?7rerequest?5counter?7?7?7?7?$DN?5?$CFd@
CONST	SEGMENT
??_C@_0BL@MPBMHENP@?7rerequest?5counter?7?7?7?7?$DN?5?$CFd@ DB 09H, 'rere'
	DB	'quest counter', 09H, 09H, 09H, 09H, '= %d', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BN@KJCLIFFG@?7receive?5personal?5id?7?7?7?7?$DN?5?$CFd@
CONST	SEGMENT
??_C@_0BN@KJCLIFFG@?7receive?5personal?5id?7?7?7?7?$DN?5?$CFd@ DB 09H, 'r'
	DB	'eceive personal id', 09H, 09H, 09H, 09H, '= %d', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BK@BGDKANOE@?7receive?5group?5id?7?7?7?7?$DN?5?$CFd@
CONST	SEGMENT
??_C@_0BK@BGDKANOE@?7receive?5group?5id?7?7?7?7?$DN?5?$CFd@ DB 09H, 'rece'
	DB	'ive group id', 09H, 09H, 09H, 09H, '= %d', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BK@HHDFJLH@?7send?5personal?5id?7?7?7?7?$DN?5?$CFd@
CONST	SEGMENT
??_C@_0BK@HHDFJLH@?7send?5personal?5id?7?7?7?7?$DN?5?$CFd@ DB 09H, 'send '
	DB	'personal id', 09H, 09H, 09H, 09H, '= %d', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BC@IAFFBNPD@?7size?7?7?7?7?7?7?7?7?$DN?5?$CFd@
CONST	SEGMENT
??_C@_0BC@IAFFBNPD@?7size?7?7?7?7?7?7?7?7?$DN?5?$CFd@ DB 09H, 'size', 09H
	DB	09H, 09H, 09H, 09H, 09H, 09H, 09H, '= %d', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BL@EENIOLGB@?7number?5of?5packets?7?7?7?7?$DN?5?$CFd@
CONST	SEGMENT
??_C@_0BL@EENIOLGB@?7number?5of?5packets?7?7?7?7?$DN?5?$CFd@ DB 09H, 'num'
	DB	'ber of packets', 09H, 09H, 09H, 09H, '= %d', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BG@BAHIHKMO@Connection?5id?5?$CFd?5data@
CONST	SEGMENT
??_C@_0BG@BAHIHKMO@Connection?5id?5?$CFd?5data@ DB 'Connection id %d data'
	DB	00H						; `string'
CONST	ENDS
;	COMDAT ??_C@_0CG@NCGBHMNJ@SERVER?3?5registering?5new?5connect@
CONST	SEGMENT
??_C@_0CG@NCGBHMNJ@SERVER?3?5registering?5new?5connect@ DB 'SERVER: regis'
	DB	'tering new connection %d', 00H		; `string'
CONST	ENDS
;	COMDAT ??_C@_0DM@JOODOOMB@SERVER?3?5connection?5receive?5buff@
CONST	SEGMENT
??_C@_0DM@JOODOOMB@SERVER?3?5connection?5receive?5buff@ DB 'SERVER: conne'
	DB	'ction receive buffer size = %d, commandline %d', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0CJ@GFLGHPNP@SERVER?3?5already?5registered?5conn@
CONST	SEGMENT
??_C@_0CJ@GFLGHPNP@SERVER?3?5already?5registered?5conn@ DB 'SERVER: alrea'
	DB	'dy registered connection %d', 00H		; `string'
CONST	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\comms\commsserver.c
;	COMDAT ?get_gunships_connection_list_item@@YGPAUCONNECTION_LIST_TYPE@@PAUENTITY@@@Z
_TEXT	SEGMENT
_this_connection$ = -4					; size = 4
_en$ = 8						; size = 4
?get_gunships_connection_list_item@@YGPAUCONNECTION_LIST_TYPE@@PAUENTITY@@@Z PROC ; get_gunships_connection_list_item, COMDAT

; 450  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 44	 sub	 esp, 68			; 00000044H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 451  : 
; 452  : 	connection_list_type
; 453  : 		*this_connection;
; 454  : 
; 455  : 	this_connection = connection_list_head;

  00009	a1 00 00 00 00	 mov	 eax, DWORD PTR ?connection_list_head@@3PAUCONNECTION_LIST_TYPE@@A
  0000e	89 45 fc	 mov	 DWORD PTR _this_connection$[ebp], eax
$LN2@get_gunshi:

; 456  : 
; 457  : 	while (this_connection)

  00011	83 7d fc 00	 cmp	 DWORD PTR _this_connection$[ebp], 0
  00015	74 1b		 je	 SHORT $LN3@get_gunshi

; 458  : 	{
; 459  : 
; 460  : 		if (this_connection->gunship_entity == en)

  00017	8b 45 fc	 mov	 eax, DWORD PTR _this_connection$[ebp]
  0001a	8b 48 30	 mov	 ecx, DWORD PTR [eax+48]
  0001d	3b 4d 08	 cmp	 ecx, DWORD PTR _en$[ebp]
  00020	75 05		 jne	 SHORT $LN4@get_gunshi

; 461  : 		{
; 462  : 
; 463  : 			return this_connection;

  00022	8b 45 fc	 mov	 eax, DWORD PTR _this_connection$[ebp]
  00025	eb 0d		 jmp	 SHORT $LN1@get_gunshi
$LN4@get_gunshi:

; 464  : 		}
; 465  : 
; 466  : 		this_connection = this_connection->next;

  00027	8b 45 fc	 mov	 eax, DWORD PTR _this_connection$[ebp]
  0002a	8b 48 3c	 mov	 ecx, DWORD PTR [eax+60]
  0002d	89 4d fc	 mov	 DWORD PTR _this_connection$[ebp], ecx

; 467  : 	}

  00030	eb df		 jmp	 SHORT $LN2@get_gunshi
$LN3@get_gunshi:

; 468  : 
; 469  : 	return NULL;

  00032	33 c0		 xor	 eax, eax
$LN1@get_gunshi:

; 470  : }

  00034	5f		 pop	 edi
  00035	5e		 pop	 esi
  00036	5b		 pop	 ebx
  00037	8b e5		 mov	 esp, ebp
  00039	5d		 pop	 ebp
  0003a	c2 04 00	 ret	 4
?get_gunships_connection_list_item@@YGPAUCONNECTION_LIST_TYPE@@PAUENTITY@@@Z ENDP ; get_gunships_connection_list_item
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\comms\commsserver.c
;	COMDAT ?server_create_session@@YGHXZ
_TEXT	SEGMENT
_comms_connection$ = -8					; size = 4
_connection_created$ = -4				; size = 4
?server_create_session@@YGHXZ PROC			; server_create_session, COMDAT

; 389  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 48	 sub	 esp, 72			; 00000048H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 390  : 
; 391  : 	int
; 392  : 		connection_created;
; 393  : 
; 394  :    connection_data_type
; 395  :       *comms_connection;
; 396  : 
; 397  : 	comms_connection = direct_play_get_connection_data ();

  00009	e8 00 00 00 00	 call	 ?direct_play_get_connection_data@@YGPAUCONNECTION_DATA_TYPE@@XZ ; direct_play_get_connection_data
  0000e	89 45 f8	 mov	 DWORD PTR _comms_connection$[ebp], eax

; 398  : 
; 399  : 	if ( ( comms_connection ) && ( comms_connection->is_initialised ) )

  00011	83 7d f8 00	 cmp	 DWORD PTR _comms_connection$[ebp], 0
  00015	74 74		 je	 SHORT $LN2@server_cre
  00017	8b 45 f8	 mov	 eax, DWORD PTR _comms_connection$[ebp]
  0001a	8b 48 3c	 mov	 ecx, DWORD PTR [eax+60]
  0001d	83 e1 01	 and	 ecx, 1
  00020	74 69		 je	 SHORT $LN2@server_cre

; 400  : 	{
; 401  : 
; 402  : 		if ( !comms_connection->one_way_hosting_setup )

  00022	8b 45 f8	 mov	 eax, DWORD PTR _comms_connection$[ebp]
  00025	83 78 38 00	 cmp	 DWORD PTR [eax+56], 0
  00029	75 55		 jne	 SHORT $LN3@server_cre

; 403  : 		{
; 404  : 		
; 405  : 			direct_play_close_session ();

  0002b	e8 00 00 00 00	 call	 ?direct_play_close_session@@YGHXZ ; direct_play_close_session

; 406  : 
; 407  : 			connection_created = FALSE;

  00030	c7 45 fc 00 00
	00 00		 mov	 DWORD PTR _connection_created$[ebp], 0

; 408  : 
; 409  : 			if ( direct_play_create_session (get_game_type ()) )

  00037	a1 00 00 00 00	 mov	 eax, DWORD PTR ?game_type@@3W4GAME_TYPES@@A ; game_type
  0003c	50		 push	 eax
  0003d	e8 00 00 00 00	 call	 ?direct_play_create_session@@YGHH@Z ; direct_play_create_session
  00042	85 c0		 test	 eax, eax
  00044	74 23		 je	 SHORT $LN5@server_cre

; 410  : 			{
; 411  : 			
; 412  : 				if ( direct_play_session_capabilities () )

  00046	e8 00 00 00 00	 call	 ?direct_play_session_capabilities@@YGHXZ ; direct_play_session_capabilities
  0004b	85 c0		 test	 eax, eax
  0004d	74 1a		 je	 SHORT $LN5@server_cre

; 413  : 				{
; 414  : 				// Jabberwock 050303 Remove DP groups
; 415  : 				//	if ( direct_play_create_group () )
; 416  : 					{
; 417  : 					
; 418  : 						if ( direct_play_create_player () )

  0004f	e8 00 00 00 00	 call	 ?direct_play_create_player@@YGHXZ ; direct_play_create_player
  00054	85 c0		 test	 eax, eax
  00056	74 11		 je	 SHORT $LN5@server_cre

; 419  : 						{
; 420  : 						
; 421  : 							set_server_id (direct_play_get_player_id ());

  00058	e8 00 00 00 00	 call	 ?direct_play_get_player_id@@YGHXZ ; direct_play_get_player_id
  0005d	a3 00 00 00 00	 mov	 DWORD PTR ?system_server_id@@3KA, eax ; system_server_id

; 422  : 
; 423  : 							connection_created = TRUE;

  00062	c7 45 fc 01 00
	00 00		 mov	 DWORD PTR _connection_created$[ebp], 1
$LN5@server_cre:

; 424  : 						}
; 425  : 					}
; 426  : 				}
; 427  : 			}
; 428  : 
; 429  : 			if ( !connection_created )

  00069	83 7d fc 00	 cmp	 DWORD PTR _connection_created$[ebp], 0
  0006d	75 0f		 jne	 SHORT $LN8@server_cre

; 430  : 			{
; 431  : 
; 432  : 				comms_connection->is_initialised = FALSE;

  0006f	8b 45 f8	 mov	 eax, DWORD PTR _comms_connection$[ebp]
  00072	8b 48 3c	 mov	 ecx, DWORD PTR [eax+60]
  00075	83 e1 fe	 and	 ecx, -2			; fffffffeH
  00078	8b 55 f8	 mov	 edx, DWORD PTR _comms_connection$[ebp]
  0007b	89 4a 3c	 mov	 DWORD PTR [edx+60], ecx
$LN8@server_cre:

; 433  : 			}
; 434  : 		}
; 435  : 		else

  0007e	eb 0b		 jmp	 SHORT $LN2@server_cre
$LN3@server_cre:

; 436  : 		{
; 437  : 
; 438  : 			direct_play_set_session_type_and_name ( get_game_type () );

  00080	a1 00 00 00 00	 mov	 eax, DWORD PTR ?game_type@@3W4GAME_TYPES@@A ; game_type
  00085	50		 push	 eax
  00086	e8 00 00 00 00	 call	 ?direct_play_set_session_type_and_name@@YGXH@Z ; direct_play_set_session_type_and_name
$LN2@server_cre:

; 439  : 		}
; 440  : 	}
; 441  : 
; 442  : 	return ( TRUE );

  0008b	b8 01 00 00 00	 mov	 eax, 1

; 443  : }

  00090	5f		 pop	 edi
  00091	5e		 pop	 esi
  00092	5b		 pop	 ebx
  00093	8b e5		 mov	 esp, ebp
  00095	5d		 pop	 ebp
  00096	c3		 ret	 0
?server_create_session@@YGHXZ ENDP			; server_create_session
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\comms\commsserver.c
;	COMDAT ?validate_connections@@YGXXZ
_TEXT	SEGMENT
tv154 = -84						; size = 4
tv95 = -84						; size = 4
tv171 = -80						; size = 4
tv146 = -80						; size = 4
tv87 = -80						; size = 4
_timeout_limit$ = -12					; size = 4
_this_connection$ = -8					; size = 4
_destroy_connection$ = -4				; size = 4
?validate_connections@@YGXXZ PROC			; validate_connections, COMDAT

; 282  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 54	 sub	 esp, 84			; 00000054H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 283  : 
; 284  : 	connection_list_type
; 285  : 		*destroy_connection,
; 286  : 		*this_connection;
; 287  : 	unsigned int
; 288  : 		timeout_limit;
; 289  : 
; 290  : 	this_connection = connection_list_head;

  00009	a1 00 00 00 00	 mov	 eax, DWORD PTR ?connection_list_head@@3PAUCONNECTION_LIST_TYPE@@A
  0000e	89 45 f8	 mov	 DWORD PTR _this_connection$[ebp], eax
$LN2@validate_c:

; 291  : 
; 292  : 	while (this_connection)

  00011	83 7d f8 00	 cmp	 DWORD PTR _this_connection$[ebp], 0
  00015	0f 84 a8 02 00
	00		 je	 $LN1@validate_c

; 293  : 	{
; 294  : 
; 295  : 		destroy_connection = this_connection;

  0001b	8b 45 f8	 mov	 eax, DWORD PTR _this_connection$[ebp]
  0001e	89 45 fc	 mov	 DWORD PTR _destroy_connection$[ebp], eax

; 296  : 
; 297  : 		this_connection = this_connection->next;

  00021	8b 45 f8	 mov	 eax, DWORD PTR _this_connection$[ebp]
  00024	8b 48 3c	 mov	 ecx, DWORD PTR [eax+60]
  00027	89 4d f8	 mov	 DWORD PTR _this_connection$[ebp], ecx

; 298  : 
; 299  : 		if (get_comms_model () == COMMS_MODEL_SERVER) // Jabberwock 040603 cvc turned off for clients

  0002a	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?system_comms_model@@3W4COMMS_MODEL_TYPES@@A, 0 ; system_comms_model
  00031	0f 85 87 02 00
	00		 jne	 $LN4@validate_c

; 300  : 		{
; 301  : 			
; 302  : 			// added count_limit for connecting players
; 303  : 			if (destroy_connection->pilot_entity)

  00037	8b 45 fc	 mov	 eax, DWORD PTR _destroy_connection$[ebp]
  0003a	83 78 34 00	 cmp	 DWORD PTR [eax+52], 0
  0003e	74 0a		 je	 SHORT $LN5@validate_c

; 304  : 			{
; 305  : 				timeout_limit = command_line_comms_timeout;

  00040	a1 00 00 00 00	 mov	 eax, DWORD PTR ?command_line_comms_timeout@@3HA ; command_line_comms_timeout
  00045	89 45 f4	 mov	 DWORD PTR _timeout_limit$[ebp], eax

; 306  : 			}
; 307  : 			else

  00048	eb 0b		 jmp	 SHORT $LN6@validate_c
$LN5@validate_c:

; 308  : 			{
; 309  : 				timeout_limit = command_line_comms_timeout + 15;

  0004a	a1 00 00 00 00	 mov	 eax, DWORD PTR ?command_line_comms_timeout@@3HA ; command_line_comms_timeout
  0004f	83 c0 0f	 add	 eax, 15			; 0000000fH
  00052	89 45 f4	 mov	 DWORD PTR _timeout_limit$[ebp], eax
$LN6@validate_c:

; 310  : 			}
; 311  : 		
; 312  : 			if ((get_system_time () - destroy_connection->connection_validation_time) > timeout_limit * TIME_1_SECOND)

  00055	e8 00 00 00 00	 call	 ?get_system_time@@YGIXZ	; get_system_time
  0005a	8b 4d fc	 mov	 ecx, DWORD PTR _destroy_connection$[ebp]
  0005d	2b 41 48	 sub	 eax, DWORD PTR [ecx+72]
  00060	69 55 f4 e8 03
	00 00		 imul	 edx, DWORD PTR _timeout_limit$[ebp], 1000
  00067	3b c2		 cmp	 eax, edx
  00069	0f 86 4f 02 00
	00		 jbe	 $LN4@validate_c

; 313  : 			{
; 314  : 				if (destroy_connection->validation_count > 2) // Jabberwock 040603 Three passes

  0006f	8b 45 fc	 mov	 eax, DWORD PTR _destroy_connection$[ebp]
  00072	83 78 44 02	 cmp	 DWORD PTR [eax+68], 2
  00076	0f 8e 02 02 00
	00		 jle	 $LN8@validate_c

; 315  : 				{
; 316  : // Jabberwock 031107 MP bug search - this is where original crash occurs, but it's symptom, not the cause!
; 317  : /*                                 	if (destroy_connection->pilot_entity)
; 318  : 					{
; 319  :  					     entity
; 320  :  						*gunship;
; 321  :       						gunship = get_local_entity_parent (destroy_connection->pilot_entity, LIST_TYPE_AIRCREW);
; 322  : 	
; 323  : 						if (gunship)
; 324  : 						{
; 325  : 							set_client_server_entity_int_value (gunship, INT_TYPE_PLAYER, ENTITY_PLAYER_AI);
; 326  : 							debug_log ("SERVER: TIMEOUT: Resetting clients gunship to AI");
; 327  : 						}
; 328  : */
; 329  : // below is the replacement code for the above: sets back the helo to AI - OK
; 330  : 					if (destroy_connection->gunship_entity)

  0007c	8b 45 fc	 mov	 eax, DWORD PTR _destroy_connection$[ebp]
  0007f	83 78 30 00	 cmp	 DWORD PTR [eax+48], 0
  00083	0f 84 96 00 00
	00		 je	 $LN10@validate_c

; 331  : 					{
; 332  : 						set_client_server_entity_int_value (destroy_connection->gunship_entity, INT_TYPE_PLAYER, ENTITY_PLAYER_AI);

  00089	8b 45 fc	 mov	 eax, DWORD PTR _destroy_connection$[ebp]
  0008c	83 78 30 00	 cmp	 DWORD PTR [eax+48], 0
  00090	74 0d		 je	 SHORT $LN16@validate_c
  00092	8b 4d fc	 mov	 ecx, DWORD PTR _destroy_connection$[ebp]
  00095	8b 51 30	 mov	 edx, DWORD PTR [ecx+48]
  00098	8b 02		 mov	 eax, DWORD PTR [edx]
  0009a	89 45 b0	 mov	 DWORD PTR tv87[ebp], eax
  0009d	eb 22		 jmp	 SHORT $LN17@validate_c
$LN16@validate_c:
  0009f	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?__LINE__Var@?0??validate_connections@@YGXXZ@4JA
  000a5	83 c1 32	 add	 ecx, 50			; 00000032H
  000a8	51		 push	 ecx
  000a9	68 00 00 00 00	 push	 OFFSET ??_C@_0EA@FAGNCFK@c?3?2users?2nhv90?2projects?2eech?2ap@
  000ae	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?null_entity_pointer_message@@3PBDB ; null_entity_pointer_message
  000b4	52		 push	 edx
  000b5	e8 00 00 00 00	 call	 ?process_assert@@YGXPBD0H@Z ; process_assert
  000ba	c7 45 b0 00 00
	00 00		 mov	 DWORD PTR tv87[ebp], 0
$LN17@validate_c:
  000c1	b8 01 00 00 00	 mov	 eax, 1
  000c6	85 c0		 test	 eax, eax
  000c8	74 09		 je	 SHORT $LN18@validate_c
  000ca	c7 45 ac 9c 00
	00 00		 mov	 DWORD PTR tv95[ebp], 156 ; 0000009cH
  000d1	eb 22		 jmp	 SHORT $LN19@validate_c
$LN18@validate_c:
  000d3	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?__LINE__Var@?0??validate_connections@@YGXXZ@4JA
  000d9	83 c1 32	 add	 ecx, 50			; 00000032H
  000dc	51		 push	 ecx
  000dd	68 00 00 00 00	 push	 OFFSET ??_C@_0EA@FAGNCFK@c?3?2users?2nhv90?2projects?2eech?2ap@
  000e2	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?overload_invalid_int_type_message@@3PBDB ; overload_invalid_int_type_message
  000e8	52		 push	 edx
  000e9	e8 00 00 00 00	 call	 ?process_assert@@YGXPBD0H@Z ; process_assert
  000ee	c7 45 ac 00 00
	00 00		 mov	 DWORD PTR tv95[ebp], 0
$LN19@validate_c:
  000f5	6a 00		 push	 0
  000f7	68 9c 00 00 00	 push	 156			; 0000009cH
  000fc	8b 45 fc	 mov	 eax, DWORD PTR _destroy_connection$[ebp]
  000ff	8b 48 30	 mov	 ecx, DWORD PTR [eax+48]
  00102	51		 push	 ecx
  00103	69 55 b0 b8 08
	00 00		 imul	 edx, DWORD PTR tv87[ebp], 2232
  0010a	8b 45 ac	 mov	 eax, DWORD PTR tv95[ebp]
  0010d	8d 8c c2 00 00
	00 00		 lea	 ecx, DWORD PTR ?fn_set_client_server_entity_int_value@@3PAY1BBH@1P6GXPAUENTITY@@W4INT_TYPES@@H@ZA[edx+eax*8]
  00114	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?system_comms_model@@3W4COMMS_MODEL_TYPES@@A ; system_comms_model
  0011a	8b 04 91	 mov	 eax, DWORD PTR [ecx+edx*4]
  0011d	ff d0		 call	 eax
$LN10@validate_c:

; 333  : 					}
; 334  : // the original destroy pilot_entity - may cause invalid assignment? (random entity)
; 335  : //					destroy_client_server_entity (destroy_connection->pilot_entity);
; 336  : //					debug_log ("SERVER: TIMEOUT: destroying clients pilot entity");
; 337  : //					}
; 338  : 
; 339  : 					if (destroy_connection->pilot_entity)

  0011f	8b 45 fc	 mov	 eax, DWORD PTR _destroy_connection$[ebp]
  00122	83 78 34 00	 cmp	 DWORD PTR [eax+52], 0
  00126	0f 84 f3 00 00
	00		 je	 $LN11@validate_c

; 340  : 					{
; 341  : 						server_log("%s removed by cvc", get_local_entity_string (destroy_connection->pilot_entity, STRING_TYPE_PILOTS_NAME));

  0012c	8b 45 fc	 mov	 eax, DWORD PTR _destroy_connection$[ebp]
  0012f	83 78 34 00	 cmp	 DWORD PTR [eax+52], 0
  00133	74 0d		 je	 SHORT $LN20@validate_c
  00135	8b 4d fc	 mov	 ecx, DWORD PTR _destroy_connection$[ebp]
  00138	8b 51 34	 mov	 edx, DWORD PTR [ecx+52]
  0013b	8b 02		 mov	 eax, DWORD PTR [edx]
  0013d	89 45 b0	 mov	 DWORD PTR tv146[ebp], eax
  00140	eb 22		 jmp	 SHORT $LN21@validate_c
$LN20@validate_c:
  00142	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?__LINE__Var@?0??validate_connections@@YGXXZ@4JA
  00148	83 c1 3b	 add	 ecx, 59			; 0000003bH
  0014b	51		 push	 ecx
  0014c	68 00 00 00 00	 push	 OFFSET ??_C@_0EA@FAGNCFK@c?3?2users?2nhv90?2projects?2eech?2ap@
  00151	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?null_entity_pointer_message@@3PBDB ; null_entity_pointer_message
  00157	52		 push	 edx
  00158	e8 00 00 00 00	 call	 ?process_assert@@YGXPBD0H@Z ; process_assert
  0015d	c7 45 b0 00 00
	00 00		 mov	 DWORD PTR tv146[ebp], 0
$LN21@validate_c:
  00164	b8 01 00 00 00	 mov	 eax, 1
  00169	85 c0		 test	 eax, eax
  0016b	74 09		 je	 SHORT $LN22@validate_c
  0016d	c7 45 ac 0a 00
	00 00		 mov	 DWORD PTR tv154[ebp], 10 ; 0000000aH
  00174	eb 22		 jmp	 SHORT $LN23@validate_c
$LN22@validate_c:
  00176	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?__LINE__Var@?0??validate_connections@@YGXXZ@4JA
  0017c	83 c1 3b	 add	 ecx, 59			; 0000003bH
  0017f	51		 push	 ecx
  00180	68 00 00 00 00	 push	 OFFSET ??_C@_0EA@FAGNCFK@c?3?2users?2nhv90?2projects?2eech?2ap@
  00185	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?overload_invalid_string_type_message@@3PBDB ; overload_invalid_string_type_message
  0018b	52		 push	 edx
  0018c	e8 00 00 00 00	 call	 ?process_assert@@YGXPBD0H@Z ; process_assert
  00191	c7 45 ac 00 00
	00 00		 mov	 DWORD PTR tv154[ebp], 0
$LN23@validate_c:
  00198	6a 0a		 push	 10			; 0000000aH
  0019a	8b 45 fc	 mov	 eax, DWORD PTR _destroy_connection$[ebp]
  0019d	8b 48 34	 mov	 ecx, DWORD PTR [eax+52]
  001a0	51		 push	 ecx
  001a1	6b 55 b0 34	 imul	 edx, DWORD PTR tv146[ebp], 52
  001a5	8b 45 ac	 mov	 eax, DWORD PTR tv154[ebp]
  001a8	8b 8c 82 00 00
	00 00		 mov	 ecx, DWORD PTR ?fn_get_local_entity_string@@3PAY0N@P6GPBDPAUENTITY@@W4STRING_TYPES@@@ZA[edx+eax*4]
  001af	ff d1		 call	 ecx
  001b1	50		 push	 eax
  001b2	68 00 00 00 00	 push	 OFFSET ??_C@_0BC@KLKOHLBP@?$CFs?5removed?5by?5cvc@
  001b7	e8 00 00 00 00	 call	 ?server_log@@YAXPBDZZ	; server_log
  001bc	83 c4 08	 add	 esp, 8

; 342  : 
; 343  : 						destroy_client_server_entity (destroy_connection->pilot_entity);

  001bf	8b 45 fc	 mov	 eax, DWORD PTR _destroy_connection$[ebp]
  001c2	83 78 34 00	 cmp	 DWORD PTR [eax+52], 0
  001c6	74 0d		 je	 SHORT $LN24@validate_c
  001c8	8b 4d fc	 mov	 ecx, DWORD PTR _destroy_connection$[ebp]
  001cb	8b 51 34	 mov	 edx, DWORD PTR [ecx+52]
  001ce	8b 02		 mov	 eax, DWORD PTR [edx]
  001d0	89 45 b0	 mov	 DWORD PTR tv171[ebp], eax
  001d3	eb 22		 jmp	 SHORT $LN25@validate_c
$LN24@validate_c:
  001d5	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?__LINE__Var@?0??validate_connections@@YGXXZ@4JA
  001db	83 c1 3d	 add	 ecx, 61			; 0000003dH
  001de	51		 push	 ecx
  001df	68 00 00 00 00	 push	 OFFSET ??_C@_0EA@FAGNCFK@c?3?2users?2nhv90?2projects?2eech?2ap@
  001e4	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?null_entity_pointer_message@@3PBDB ; null_entity_pointer_message
  001ea	52		 push	 edx
  001eb	e8 00 00 00 00	 call	 ?process_assert@@YGXPBD0H@Z ; process_assert
  001f0	c7 45 b0 00 00
	00 00		 mov	 DWORD PTR tv171[ebp], 0
$LN25@validate_c:
  001f7	8b 45 fc	 mov	 eax, DWORD PTR _destroy_connection$[ebp]
  001fa	8b 48 34	 mov	 ecx, DWORD PTR [eax+52]
  001fd	51		 push	 ecx
  001fe	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?system_comms_model@@3W4COMMS_MODEL_TYPES@@A ; system_comms_model
  00204	c1 e2 02	 shl	 edx, 2
  00207	8b 45 b0	 mov	 eax, DWORD PTR tv171[ebp]
  0020a	8b 8c c2 00 00
	00 00		 mov	 ecx, DWORD PTR ?fn_destroy_client_server_entity@@3PAY01P6GXPAUENTITY@@@ZA[edx+eax*8]
  00211	ff d1		 call	 ecx

; 344  : 
; 345  : 						destroy_connection->pilot_entity = NULL;

  00213	8b 45 fc	 mov	 eax, DWORD PTR _destroy_connection$[ebp]
  00216	c7 40 34 00 00
	00 00		 mov	 DWORD PTR [eax+52], 0

; 346  : 					}
; 347  : 					else

  0021d	eb 0d		 jmp	 SHORT $LN12@validate_c
$LN11@validate_c:

; 348  : 					{
; 349  : 						server_log("Unknown player removed");

  0021f	68 00 00 00 00	 push	 OFFSET ??_C@_0BH@LHCPBMAM@Unknown?5player?5removed@
  00224	e8 00 00 00 00	 call	 ?server_log@@YAXPBDZZ	; server_log
  00229	83 c4 04	 add	 esp, 4
$LN12@validate_c:

; 350  : 					}
; 351  : 
; 352  : // Jabberwock 031108 - ends - seems to work!
; 353  : 					
; 354  : 					if (get_comms_model () == COMMS_MODEL_SERVER)

  0022c	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?system_comms_model@@3W4COMMS_MODEL_TYPES@@A, 0 ; system_comms_model
  00233	75 2b		 jne	 SHORT $LN13@validate_c

; 355  : 					{
; 356  : 						debug_log ("SERVER: TIMEOUT: Unregistering connection %d", destroy_connection->connection_id);

  00235	8b 45 fc	 mov	 eax, DWORD PTR _destroy_connection$[ebp]
  00238	8b 08		 mov	 ecx, DWORD PTR [eax]
  0023a	51		 push	 ecx
  0023b	68 00 00 00 00	 push	 OFFSET ??_C@_0CN@JGJKIPBH@SERVER?3?5TIMEOUT?3?5Unregistering?5@
  00240	e8 00 00 00 00	 call	 ?debug_log@@YAXPBDZZ	; debug_log
  00245	83 c4 08	 add	 esp, 8

; 357  : 						free_connection_packets (destroy_connection->connection_id); // Jabberwock 040602 Maybe this will clear DP groups... 

  00248	8b 45 fc	 mov	 eax, DWORD PTR _destroy_connection$[ebp]
  0024b	8b 08		 mov	 ecx, DWORD PTR [eax]
  0024d	51		 push	 ecx
  0024e	e8 00 00 00 00	 call	 ?free_connection_packets@@YGXK@Z ; free_connection_packets

; 358  : 						// Jabberwock 0312073 MP bug search - Not working - DP timeout kills the player first....
; 359  : 
; 360  : 						//direct_play_remove_player_from_group (destroy_connection->connection_id);
; 361  : 						unregister_connection (destroy_connection->connection_id);

  00253	8b 45 fc	 mov	 eax, DWORD PTR _destroy_connection$[ebp]
  00256	8b 08		 mov	 ecx, DWORD PTR [eax]
  00258	51		 push	 ecx
  00259	e8 00 00 00 00	 call	 ?unregister_connection@@YGXK@Z ; unregister_connection

; 362  : 					}
; 363  : 					else

  0025e	eb 1c		 jmp	 SHORT $LN14@validate_c
$LN13@validate_c:

; 364  : 					{
; 365  : 						debug_log ("SERVER: TIMEOUT: Quitting game", destroy_connection->connection_id); // Jabberwock 040603 cvc removed for clients - DP will crash anyway...

  00260	8b 45 fc	 mov	 eax, DWORD PTR _destroy_connection$[ebp]
  00263	8b 08		 mov	 ecx, DWORD PTR [eax]
  00265	51		 push	 ecx
  00266	68 00 00 00 00	 push	 OFFSET ??_C@_0BP@PFIDCJBG@SERVER?3?5TIMEOUT?3?5Quitting?5game@
  0026b	e8 00 00 00 00	 call	 ?debug_log@@YAXPBDZZ	; debug_log
  00270	83 c4 08	 add	 esp, 8

; 366  : 						start_game_exit (GAME_EXIT_KICKOUT, FALSE);

  00273	6a 00		 push	 0
  00275	6a 06		 push	 6
  00277	e8 00 00 00 00	 call	 ?start_game_exit@@YGXW4GAME_EXIT_TYPES@@H@Z ; start_game_exit
$LN14@validate_c:

; 367  : 					}
; 368  : 				}
; 369  : 				else

  0027c	eb 40		 jmp	 SHORT $LN4@validate_c
$LN8@validate_c:

; 370  : 				{
; 371  : 					debug_log ("SERVER: sending %d CONNECTION_VALIDATION", destroy_connection->connection_id);

  0027e	8b 45 fc	 mov	 eax, DWORD PTR _destroy_connection$[ebp]
  00281	8b 08		 mov	 ecx, DWORD PTR [eax]
  00283	51		 push	 ecx
  00284	68 00 00 00 00	 push	 OFFSET ??_C@_0CJ@IMKOJMKF@SERVER?3?5sending?5?$CFd?5CONNECTION_V@
  00289	e8 00 00 00 00	 call	 ?debug_log@@YAXPBDZZ	; debug_log
  0028e	83 c4 08	 add	 esp, 8

; 372  : 
; 373  : 					send_packet (destroy_connection->connection_id, PACKET_TYPE_CONNECTION_VALIDATION, NULL, 0, SEND_TYPE_PERSONAL);

  00291	6a 00		 push	 0
  00293	6a 00		 push	 0
  00295	6a 00		 push	 0
  00297	6a 0f		 push	 15			; 0000000fH
  00299	8b 45 fc	 mov	 eax, DWORD PTR _destroy_connection$[ebp]
  0029c	8b 08		 mov	 ecx, DWORD PTR [eax]
  0029e	51		 push	 ecx
  0029f	e8 00 00 00 00	 call	 ?send_packet@@YGXKW4PACKET_TYPES@@PAEHW4SEND_TYPES@@@Z ; send_packet

; 374  : 
; 375  : 					destroy_connection->connection_validation_time = get_system_time (); // Jabberwock 040603 Restored

  002a4	e8 00 00 00 00	 call	 ?get_system_time@@YGIXZ	; get_system_time
  002a9	8b 4d fc	 mov	 ecx, DWORD PTR _destroy_connection$[ebp]
  002ac	89 41 48	 mov	 DWORD PTR [ecx+72], eax

; 376  : 
; 377  : 					destroy_connection->validation_count ++;

  002af	8b 45 fc	 mov	 eax, DWORD PTR _destroy_connection$[ebp]
  002b2	8b 48 44	 mov	 ecx, DWORD PTR [eax+68]
  002b5	83 c1 01	 add	 ecx, 1
  002b8	8b 55 fc	 mov	 edx, DWORD PTR _destroy_connection$[ebp]
  002bb	89 4a 44	 mov	 DWORD PTR [edx+68], ecx
$LN4@validate_c:

; 378  : 				}
; 379  : 			}
; 380  : 		}
; 381  : 	}

  002be	e9 4e fd ff ff	 jmp	 $LN2@validate_c
$LN1@validate_c:

; 382  : }

  002c3	5f		 pop	 edi
  002c4	5e		 pop	 esi
  002c5	5b		 pop	 ebx
  002c6	8b e5		 mov	 esp, ebp
  002c8	5d		 pop	 ebp
  002c9	c3		 ret	 0
?validate_connections@@YGXXZ ENDP			; validate_connections
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\comms\commsserver.c
;	COMDAT ?get_connection_list_item@@YGPAUCONNECTION_LIST_TYPE@@K@Z
_TEXT	SEGMENT
_current_connection$ = -4				; size = 4
_connection_id$ = 8					; size = 4
?get_connection_list_item@@YGPAUCONNECTION_LIST_TYPE@@K@Z PROC ; get_connection_list_item, COMDAT

; 245  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 44	 sub	 esp, 68			; 00000044H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 246  : 
; 247  : 	connection_list_type
; 248  : 		*current_connection;
; 249  : 
; 250  : 	current_connection = connection_list_head;

  00009	a1 00 00 00 00	 mov	 eax, DWORD PTR ?connection_list_head@@3PAUCONNECTION_LIST_TYPE@@A
  0000e	89 45 fc	 mov	 DWORD PTR _current_connection$[ebp], eax

; 251  : 
; 252  : 	// if dpid_all_players just return the first one.
; 253  : 
; 254  : 	if ((connection_id == direct_play_get_group_id ()) || (connection_id == DPID_ALLPLAYERS))

  00011	e8 00 00 00 00	 call	 ?direct_play_get_group_id@@YGHXZ ; direct_play_get_group_id
  00016	39 45 08	 cmp	 DWORD PTR _connection_id$[ebp], eax
  00019	74 06		 je	 SHORT $LN5@get_connec
  0001b	83 7d 08 00	 cmp	 DWORD PTR _connection_id$[ebp], 0
  0001f	75 05		 jne	 SHORT $LN2@get_connec
$LN5@get_connec:

; 255  : 	{
; 256  : 
; 257  : 		return current_connection;

  00021	8b 45 fc	 mov	 eax, DWORD PTR _current_connection$[ebp]
  00024	eb 33		 jmp	 SHORT $LN1@get_connec
$LN2@get_connec:

; 258  : 	}
; 259  : 
; 260  : 	while (current_connection)

  00026	83 7d fc 00	 cmp	 DWORD PTR _current_connection$[ebp], 0
  0002a	74 1a		 je	 SHORT $LN3@get_connec

; 261  : 	{
; 262  : 
; 263  : 		if (current_connection->connection_id == connection_id)

  0002c	8b 45 fc	 mov	 eax, DWORD PTR _current_connection$[ebp]
  0002f	8b 08		 mov	 ecx, DWORD PTR [eax]
  00031	3b 4d 08	 cmp	 ecx, DWORD PTR _connection_id$[ebp]
  00034	75 05		 jne	 SHORT $LN6@get_connec

; 264  : 		{
; 265  : 
; 266  : 			return current_connection;

  00036	8b 45 fc	 mov	 eax, DWORD PTR _current_connection$[ebp]
  00039	eb 1e		 jmp	 SHORT $LN1@get_connec
$LN6@get_connec:

; 267  : 		}
; 268  : 
; 269  : 		current_connection = current_connection->next;

  0003b	8b 45 fc	 mov	 eax, DWORD PTR _current_connection$[ebp]
  0003e	8b 48 3c	 mov	 ecx, DWORD PTR [eax+60]
  00041	89 4d fc	 mov	 DWORD PTR _current_connection$[ebp], ecx

; 270  : 	}

  00044	eb e0		 jmp	 SHORT $LN2@get_connec
$LN3@get_connec:

; 271  : 
; 272  : 	debug_log ("SERVER: new connection %d", connection_id);

  00046	8b 45 08	 mov	 eax, DWORD PTR _connection_id$[ebp]
  00049	50		 push	 eax
  0004a	68 00 00 00 00	 push	 OFFSET ??_C@_0BK@PMBMHEKE@SERVER?3?5new?5connection?5?$CFd@
  0004f	e8 00 00 00 00	 call	 ?debug_log@@YAXPBDZZ	; debug_log
  00054	83 c4 08	 add	 esp, 8

; 273  : 
; 274  : 	return NULL;

  00057	33 c0		 xor	 eax, eax
$LN1@get_connec:

; 275  : }

  00059	5f		 pop	 edi
  0005a	5e		 pop	 esi
  0005b	5b		 pop	 ebx
  0005c	8b e5		 mov	 esp, ebp
  0005e	5d		 pop	 ebp
  0005f	c2 04 00	 ret	 4
?get_connection_list_item@@YGPAUCONNECTION_LIST_TYPE@@K@Z ENDP ; get_connection_list_item
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\comms\commsserver.c
;	COMDAT ?get_connection_list_head@@YGPAUCONNECTION_LIST_TYPE@@XZ
_TEXT	SEGMENT
?get_connection_list_head@@YGPAUCONNECTION_LIST_TYPE@@XZ PROC ; get_connection_list_head, COMDAT

; 235  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 40	 sub	 esp, 64			; 00000040H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 236  : 
; 237  : 	return connection_list_head;

  00009	a1 00 00 00 00	 mov	 eax, DWORD PTR ?connection_list_head@@3PAUCONNECTION_LIST_TYPE@@A

; 238  : }

  0000e	5f		 pop	 edi
  0000f	5e		 pop	 esi
  00010	5b		 pop	 ebx
  00011	8b e5		 mov	 esp, ebp
  00013	5d		 pop	 ebp
  00014	c3		 ret	 0
?get_connection_list_head@@YGPAUCONNECTION_LIST_TYPE@@XZ ENDP ; get_connection_list_head
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\comms\commsserver.c
;	COMDAT ?unregister_connection@@YGXK@Z
_TEXT	SEGMENT
_new_connection$ = -8					; size = 4
_prev_connection$ = -4					; size = 4
_connection_id$ = 8					; size = 4
?unregister_connection@@YGXK@Z PROC			; unregister_connection, COMDAT

; 176  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 48	 sub	 esp, 72			; 00000048H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 177  : 
; 178  : 	connection_list_type
; 179  : 		*prev_connection,
; 180  : 		*new_connection;
; 181  : 
; 182  : 	new_connection = connection_list_head;

  00009	a1 00 00 00 00	 mov	 eax, DWORD PTR ?connection_list_head@@3PAUCONNECTION_LIST_TYPE@@A
  0000e	89 45 f8	 mov	 DWORD PTR _new_connection$[ebp], eax

; 183  : 
; 184  : 	prev_connection = NULL;

  00011	c7 45 fc 00 00
	00 00		 mov	 DWORD PTR _prev_connection$[ebp], 0
$LN2@unregister:

; 185  : 
; 186  : 	while (new_connection)

  00018	83 7d f8 00	 cmp	 DWORD PTR _new_connection$[ebp], 0
  0001c	74 6c		 je	 SHORT $LN3@unregister

; 187  : 	{
; 188  : 
; 189  : 		if (new_connection->connection_id == connection_id)

  0001e	8b 45 f8	 mov	 eax, DWORD PTR _new_connection$[ebp]
  00021	8b 08		 mov	 ecx, DWORD PTR [eax]
  00023	3b 4d 08	 cmp	 ecx, DWORD PTR _connection_id$[ebp]
  00026	75 51		 jne	 SHORT $LN4@unregister

; 190  : 		{
; 191  : 
; 192  : 			if (prev_connection)

  00028	83 7d fc 00	 cmp	 DWORD PTR _prev_connection$[ebp], 0
  0002c	74 0e		 je	 SHORT $LN5@unregister

; 193  : 			{
; 194  : 
; 195  : 				prev_connection->next = new_connection->next;

  0002e	8b 45 fc	 mov	 eax, DWORD PTR _prev_connection$[ebp]
  00031	8b 4d f8	 mov	 ecx, DWORD PTR _new_connection$[ebp]
  00034	8b 51 3c	 mov	 edx, DWORD PTR [ecx+60]
  00037	89 50 3c	 mov	 DWORD PTR [eax+60], edx

; 196  : 			}
; 197  : 			else

  0003a	eb 0c		 jmp	 SHORT $LN6@unregister
$LN5@unregister:

; 198  : 			{
; 199  : 
; 200  : 				connection_list_head = new_connection->next;

  0003c	8b 45 f8	 mov	 eax, DWORD PTR _new_connection$[ebp]
  0003f	8b 48 3c	 mov	 ecx, DWORD PTR [eax+60]
  00042	89 0d 00 00 00
	00		 mov	 DWORD PTR ?connection_list_head@@3PAUCONNECTION_LIST_TYPE@@A, ecx
$LN6@unregister:

; 201  : 			}
; 202  : 
; 203  : 			free_mem (new_connection->connection_receive_buffer);

  00048	8b 45 f8	 mov	 eax, DWORD PTR _new_connection$[ebp]
  0004b	8b 48 24	 mov	 ecx, DWORD PTR [eax+36]
  0004e	51		 push	 ecx
  0004f	e8 00 00 00 00	 call	 ?free_mem@@YGXPAX@Z	; free_mem

; 204  : 
; 205  : 			free_mem (new_connection);

  00054	8b 45 f8	 mov	 eax, DWORD PTR _new_connection$[ebp]
  00057	50		 push	 eax
  00058	e8 00 00 00 00	 call	 ?free_mem@@YGXPAX@Z	; free_mem

; 206  : 
; 207  : 			#if SERVER_DEBUG
; 208  : 
; 209  : 			debug_log ("SERVER: unregistering connection %d", connection_id);

  0005d	8b 45 08	 mov	 eax, DWORD PTR _connection_id$[ebp]
  00060	50		 push	 eax
  00061	68 00 00 00 00	 push	 OFFSET ??_C@_0CE@IGBAFIIC@SERVER?3?5unregistering?5connectio@
  00066	e8 00 00 00 00	 call	 ?debug_log@@YAXPBDZZ	; debug_log
  0006b	83 c4 08	 add	 esp, 8

; 210  : 
; 211  : 			#endif
; 212  : 
; 213  : 			//
; 214  : 			// remove any packets for connection_id in packet_list
; 215  : 			//
; 216  : 
; 217  : 			free_connection_packets (connection_id);

  0006e	8b 45 08	 mov	 eax, DWORD PTR _connection_id$[ebp]
  00071	50		 push	 eax
  00072	e8 00 00 00 00	 call	 ?free_connection_packets@@YGXK@Z ; free_connection_packets

; 218  : 
; 219  : 			return;

  00077	eb 1e		 jmp	 SHORT $LN1@unregister
$LN4@unregister:

; 220  : 		}
; 221  : 
; 222  : 		prev_connection = new_connection;

  00079	8b 45 f8	 mov	 eax, DWORD PTR _new_connection$[ebp]
  0007c	89 45 fc	 mov	 DWORD PTR _prev_connection$[ebp], eax

; 223  : 
; 224  : 		new_connection = new_connection->next;

  0007f	8b 45 f8	 mov	 eax, DWORD PTR _new_connection$[ebp]
  00082	8b 48 3c	 mov	 ecx, DWORD PTR [eax+60]
  00085	89 4d f8	 mov	 DWORD PTR _new_connection$[ebp], ecx

; 225  : 	}

  00088	eb 8e		 jmp	 SHORT $LN2@unregister
$LN3@unregister:

; 226  : 
; 227  : 	debug_log ("SERVER: Error: unregister_connection, connection_id unknown"); //schorpp

  0008a	68 00 00 00 00	 push	 OFFSET ??_C@_0DM@MNHIDIBG@SERVER?3?5Error?3?5unregister_conne@
  0008f	e8 00 00 00 00	 call	 ?debug_log@@YAXPBDZZ	; debug_log
  00094	83 c4 04	 add	 esp, 4
$LN1@unregister:

; 228  : }

  00097	5f		 pop	 edi
  00098	5e		 pop	 esi
  00099	5b		 pop	 ebx
  0009a	8b e5		 mov	 esp, ebp
  0009c	5d		 pop	 ebp
  0009d	c2 04 00	 ret	 4
?unregister_connection@@YGXK@Z ENDP			; unregister_connection
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\comms\commsserver.c
;	COMDAT ?register_connection@@YGPAUCONNECTION_LIST_TYPE@@K@Z
_TEXT	SEGMENT
_new_connection$ = -4					; size = 4
_connection_id$ = 8					; size = 4
?register_connection@@YGPAUCONNECTION_LIST_TYPE@@K@Z PROC ; register_connection, COMDAT

; 89   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 44	 sub	 esp, 68			; 00000044H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 90   : 
; 91   : 	connection_list_type
; 92   : 		*new_connection;
; 93   : 
; 94   : 	//
; 95   : 	// stop pause or time acceleration if game is not single player
; 96   : 	//
; 97   : 
; 98   : 	set_min_time_acceleration (NULL);

  00009	6a 00		 push	 0
  0000b	e8 00 00 00 00	 call	 ?set_min_time_acceleration@@YGXPAUEVENT@@@Z ; set_min_time_acceleration

; 99   : 
; 100  : 	//
; 101  : 	//
; 102  : 	//
; 103  : 
; 104  : 	if (new_connection = get_connection_list_item (connection_id))

  00010	8b 45 08	 mov	 eax, DWORD PTR _connection_id$[ebp]
  00013	50		 push	 eax
  00014	e8 00 00 00 00	 call	 ?get_connection_list_item@@YGPAUCONNECTION_LIST_TYPE@@K@Z ; get_connection_list_item
  00019	89 45 fc	 mov	 DWORD PTR _new_connection$[ebp], eax
  0001c	83 7d fc 00	 cmp	 DWORD PTR _new_connection$[ebp], 0
  00020	74 1e		 je	 SHORT $LN2@register_c

; 105  : 	{
; 106  : 
; 107  : 		#if SERVER_DEBUG
; 108  : 
; 109  : 		debug_log ("SERVER: already registered connection %d", connection_id);

  00022	8b 45 08	 mov	 eax, DWORD PTR _connection_id$[ebp]
  00025	50		 push	 eax
  00026	68 00 00 00 00	 push	 OFFSET ??_C@_0CJ@GFLGHPNP@SERVER?3?5already?5registered?5conn@
  0002b	e8 00 00 00 00	 call	 ?debug_log@@YAXPBDZZ	; debug_log
  00030	83 c4 08	 add	 esp, 8

; 110  : 
; 111  : 		#endif
; 112  : 
; 113  : 		return new_connection;

  00033	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  00036	e9 a5 01 00 00	 jmp	 $LN3@register_c

; 114  : 	}
; 115  : 	else

  0003b	e9 a0 01 00 00	 jmp	 $LN3@register_c
$LN2@register_c:

; 116  : 	{
; 117  : 
; 118  : 		new_connection = (connection_list_type *) malloc_heap_mem (sizeof (connection_list_type));

  00040	6a 58		 push	 88			; 00000058H
  00042	e8 00 00 00 00	 call	 ?malloc_heap_memory@@YGPAXI@Z ; malloc_heap_memory
  00047	89 45 fc	 mov	 DWORD PTR _new_connection$[ebp], eax

; 119  : 
; 120  : 		memset (new_connection, 0, sizeof (connection_list_type));

  0004a	6a 58		 push	 88			; 00000058H
  0004c	6a 00		 push	 0
  0004e	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  00051	50		 push	 eax
  00052	e8 00 00 00 00	 call	 _memset
  00057	83 c4 0c	 add	 esp, 12			; 0000000cH

; 121  : 
; 122  : 		new_connection->connection_receive_buffer = (unsigned char *) malloc_heap_mem (command_line_comms_connection_receive_size);

  0005a	a1 00 00 00 00	 mov	 eax, DWORD PTR ?command_line_comms_connection_receive_size@@3HA ; command_line_comms_connection_receive_size
  0005f	50		 push	 eax
  00060	e8 00 00 00 00	 call	 ?malloc_heap_memory@@YGPAXI@Z ; malloc_heap_memory
  00065	8b 4d fc	 mov	 ecx, DWORD PTR _new_connection$[ebp]
  00068	89 41 24	 mov	 DWORD PTR [ecx+36], eax

; 123  : 
; 124  : 		new_connection->connection_receive_buffer_size = command_line_comms_connection_receive_size;

  0006b	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  0006e	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?command_line_comms_connection_receive_size@@3HA ; command_line_comms_connection_receive_size
  00074	89 48 1c	 mov	 DWORD PTR [eax+28], ecx

; 125  : 
; 126  : 		debug_log ("SERVER: connection receive buffer size = %d, commandline %d", new_connection->connection_receive_buffer_size, command_line_comms_connection_receive_size);

  00077	a1 00 00 00 00	 mov	 eax, DWORD PTR ?command_line_comms_connection_receive_size@@3HA ; command_line_comms_connection_receive_size
  0007c	50		 push	 eax
  0007d	8b 4d fc	 mov	 ecx, DWORD PTR _new_connection$[ebp]
  00080	8b 51 1c	 mov	 edx, DWORD PTR [ecx+28]
  00083	52		 push	 edx
  00084	68 00 00 00 00	 push	 OFFSET ??_C@_0DM@JOODOOMB@SERVER?3?5connection?5receive?5buff@
  00089	e8 00 00 00 00	 call	 ?debug_log@@YAXPBDZZ	; debug_log
  0008e	83 c4 0c	 add	 esp, 12			; 0000000cH

; 127  : 
; 128  : 		new_connection->already_sent_query_data = FALSE;

  00091	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  00094	c7 40 04 00 00
	00 00		 mov	 DWORD PTR [eax+4], 0

; 129  : 
; 130  : 		new_connection->group_resend_timer = 0.0;

  0009b	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  0009e	0f 57 c0	 xorps	 xmm0, xmm0
  000a1	f3 0f 11 40 28	 movss	 DWORD PTR [eax+40], xmm0

; 131  : 
; 132  : 		new_connection->personal_resend_timer = 0.0;

  000a6	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  000a9	0f 57 c0	 xorps	 xmm0, xmm0
  000ac	f3 0f 11 40 2c	 movss	 DWORD PTR [eax+44], xmm0

; 133  : 
; 134  : 		new_connection->connection_id = connection_id;

  000b1	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  000b4	8b 4d 08	 mov	 ecx, DWORD PTR _connection_id$[ebp]
  000b7	89 08		 mov	 DWORD PTR [eax], ecx

; 135  : 
; 136  : 		new_connection->next = connection_list_head;

  000b9	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  000bc	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?connection_list_head@@3PAUCONNECTION_LIST_TYPE@@A
  000c2	89 48 3c	 mov	 DWORD PTR [eax+60], ecx

; 137  : 
; 138  : 		new_connection->receive_group_frame_id = 0;

  000c5	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  000c8	c7 40 10 00 00
	00 00		 mov	 DWORD PTR [eax+16], 0

; 139  : 
; 140  : 		new_connection->receive_personal_frame_id = 0;

  000cf	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  000d2	c7 40 14 00 00
	00 00		 mov	 DWORD PTR [eax+20], 0

; 141  : 
; 142  : 		new_connection->send_personal_frame_id = 0;

  000d9	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  000dc	c7 40 0c 00 00
	00 00		 mov	 DWORD PTR [eax+12], 0

; 143  : 
; 144  : 		connection_list_head = new_connection;

  000e3	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  000e6	a3 00 00 00 00	 mov	 DWORD PTR ?connection_list_head@@3PAUCONNECTION_LIST_TYPE@@A, eax

; 145  : 
; 146  : 		debug_log ("SERVER: registering new connection %d", connection_id);

  000eb	8b 45 08	 mov	 eax, DWORD PTR _connection_id$[ebp]
  000ee	50		 push	 eax
  000ef	68 00 00 00 00	 push	 OFFSET ??_C@_0CG@NCGBHMNJ@SERVER?3?5registering?5new?5connect@
  000f4	e8 00 00 00 00	 call	 ?debug_log@@YAXPBDZZ	; debug_log
  000f9	83 c4 08	 add	 esp, 8

; 147  : 
; 148  : 		#if SERVER_DEBUG
; 149  : 
; 150  : 		debug_watch ("Connection id %d data", MT_INT, &new_connection->connection_id);

  000fc	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  000ff	50		 push	 eax
  00100	6a 01		 push	 1
  00102	68 00 00 00 00	 push	 OFFSET ??_C@_0BG@BAHIHKMO@Connection?5id?5?$CFd?5data@
  00107	e8 00 00 00 00	 call	 ?debug_watch@@YGXPBDW4mt_type@@PAX@Z ; debug_watch

; 151  : 		debug_watch ("	number of packets				= %d", MT_INT, &new_connection->number_of_packets);

  0010c	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  0010f	83 c0 18	 add	 eax, 24			; 00000018H
  00112	50		 push	 eax
  00113	6a 01		 push	 1
  00115	68 00 00 00 00	 push	 OFFSET ??_C@_0BL@EENIOLGB@?7number?5of?5packets?7?7?7?7?$DN?5?$CFd@
  0011a	e8 00 00 00 00	 call	 ?debug_watch@@YGXPBDW4mt_type@@PAX@Z ; debug_watch

; 152  : 		debug_watch ("	size								= %d", MT_INT, &new_connection->size);

  0011f	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  00122	83 c0 20	 add	 eax, 32			; 00000020H
  00125	50		 push	 eax
  00126	6a 01		 push	 1
  00128	68 00 00 00 00	 push	 OFFSET ??_C@_0BC@IAFFBNPD@?7size?7?7?7?7?7?7?7?7?$DN?5?$CFd@
  0012d	e8 00 00 00 00	 call	 ?debug_watch@@YGXPBDW4mt_type@@PAX@Z ; debug_watch

; 153  : 		//debug_watch ("	send group id					= %d", MT_INT, &new_connection->send_group_frame_id);
; 154  : 		debug_watch ("	send personal id				= %d", MT_INT, &new_connection->send_personal_frame_id);

  00132	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  00135	83 c0 0c	 add	 eax, 12			; 0000000cH
  00138	50		 push	 eax
  00139	6a 01		 push	 1
  0013b	68 00 00 00 00	 push	 OFFSET ??_C@_0BK@HHDFJLH@?7send?5personal?5id?7?7?7?7?$DN?5?$CFd@
  00140	e8 00 00 00 00	 call	 ?debug_watch@@YGXPBDW4mt_type@@PAX@Z ; debug_watch

; 155  : 		debug_watch ("	receive group id				= %d", MT_INT, &new_connection->receive_group_frame_id);

  00145	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  00148	83 c0 10	 add	 eax, 16			; 00000010H
  0014b	50		 push	 eax
  0014c	6a 01		 push	 1
  0014e	68 00 00 00 00	 push	 OFFSET ??_C@_0BK@BGDKANOE@?7receive?5group?5id?7?7?7?7?$DN?5?$CFd@
  00153	e8 00 00 00 00	 call	 ?debug_watch@@YGXPBDW4mt_type@@PAX@Z ; debug_watch

; 156  : 		debug_watch ("	receive personal id				= %d", MT_INT, &new_connection->receive_personal_frame_id);

  00158	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  0015b	83 c0 14	 add	 eax, 20			; 00000014H
  0015e	50		 push	 eax
  0015f	6a 01		 push	 1
  00161	68 00 00 00 00	 push	 OFFSET ??_C@_0BN@KJCLIFFG@?7receive?5personal?5id?7?7?7?7?$DN?5?$CFd@
  00166	e8 00 00 00 00	 call	 ?debug_watch@@YGXPBDW4mt_type@@PAX@Z ; debug_watch

; 157  : 		debug_watch ("	rerequest counter				= %d", MT_INT, &new_connection->packet_rerequested);

  0016b	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  0016e	83 c0 08	 add	 eax, 8
  00171	50		 push	 eax
  00172	6a 01		 push	 1
  00174	68 00 00 00 00	 push	 OFFSET ??_C@_0BL@MPBMHENP@?7rerequest?5counter?7?7?7?7?$DN?5?$CFd@
  00179	e8 00 00 00 00	 call	 ?debug_watch@@YGXPBDW4mt_type@@PAX@Z ; debug_watch

; 158  : 		debug_watch ("	gunship ptr						= %d", MT_INT, &new_connection->gunship_entity);

  0017e	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  00181	83 c0 30	 add	 eax, 48			; 00000030H
  00184	50		 push	 eax
  00185	6a 01		 push	 1
  00187	68 00 00 00 00	 push	 OFFSET ??_C@_0BH@NEJJELLJ@?7gunship?5ptr?7?7?7?7?7?7?$DN?5?$CFd@
  0018c	e8 00 00 00 00	 call	 ?debug_watch@@YGXPBDW4mt_type@@PAX@Z ; debug_watch

; 159  : 		debug_watch ("	player ptr							= %d", MT_INT, &new_connection->pilot_entity);

  00191	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  00194	83 c0 34	 add	 eax, 52			; 00000034H
  00197	50		 push	 eax
  00198	6a 01		 push	 1
  0019a	68 00 00 00 00	 push	 OFFSET ??_C@_0BH@BDNANHAP@?7player?5ptr?7?7?7?7?7?7?7?$DN?5?$CFd@
  0019f	e8 00 00 00 00	 call	 ?debug_watch@@YGXPBDW4mt_type@@PAX@Z ; debug_watch

; 160  : 		debug_watch ("	gunship number				= %d", MT_INT, &new_connection->gunship_number);

  001a4	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  001a7	83 c0 38	 add	 eax, 56			; 00000038H
  001aa	50		 push	 eax
  001ab	6a 01		 push	 1
  001ad	68 00 00 00 00	 push	 OFFSET ??_C@_0BI@FICLJKLI@?7gunship?5number?7?7?7?7?$DN?5?$CFd@
  001b2	e8 00 00 00 00	 call	 ?debug_watch@@YGXPBDW4mt_type@@PAX@Z ; debug_watch

; 161  : 		//debug_watch ("	last packet time				 	= %d", MT_INT, &new_connection->time);
; 162  : 		debug_watch ("	group resend time				 	= %f", MT_FLOAT, &new_connection->group_resend_timer);

  001b7	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  001ba	83 c0 28	 add	 eax, 40			; 00000028H
  001bd	50		 push	 eax
  001be	6a 02		 push	 2
  001c0	68 00 00 00 00	 push	 OFFSET ??_C@_0BN@BNNIKHFG@?7group?5resend?5time?7?7?7?7?5?7?$DN?5?$CFf@
  001c5	e8 00 00 00 00	 call	 ?debug_watch@@YGXPBDW4mt_type@@PAX@Z ; debug_watch

; 163  : 		debug_watch ("	personal resend time			 	= %f", MT_FLOAT, &new_connection->personal_resend_timer);

  001ca	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
  001cd	83 c0 2c	 add	 eax, 44			; 0000002cH
  001d0	50		 push	 eax
  001d1	6a 02		 push	 2
  001d3	68 00 00 00 00	 push	 OFFSET ??_C@_0BP@OHJJIGDE@?7personal?5resend?5time?7?7?7?5?7?$DN?5?$CFf@
  001d8	e8 00 00 00 00	 call	 ?debug_watch@@YGXPBDW4mt_type@@PAX@Z ; debug_watch

; 164  : 
; 165  : 		#endif
; 166  : 
; 167  : 		return new_connection;

  001dd	8b 45 fc	 mov	 eax, DWORD PTR _new_connection$[ebp]
$LN3@register_c:

; 168  : 	}
; 169  : }

  001e0	5f		 pop	 edi
  001e1	5e		 pop	 esi
  001e2	5b		 pop	 ebx
  001e3	8b e5		 mov	 esp, ebp
  001e5	5d		 pop	 ebp
  001e6	c2 04 00	 ret	 4
?register_connection@@YGPAUCONNECTION_LIST_TYPE@@K@Z ENDP ; register_connection
_TEXT	ENDS
END
