; Listing generated by Microsoft (R) Optimizing Compiler Version 19.16.27045.0 

	TITLE	C:\Users\nhv90\Projects\eech\aphavoc\source\cdmusic.c
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB MSVCRTD
INCLUDELIB OLDNAMES

PUBLIC	?play_cd_music@@YGXW4CD_MUSIC_TYPES@@@Z		; play_cd_music
PUBLIC	?stop_cd_music@@YGXXZ				; stop_cd_music
EXTRN	?play_one_shot_cd_audio_track@@YGXH@Z:PROC	; play_one_shot_cd_audio_track
EXTRN	?stop_cd_audio@@YGXXZ:PROC			; stop_cd_audio
EXTRN	?is_cd_audio_playing@@YGHXZ:PROC		; is_cd_audio_playing
EXTRN	?random_number_seed@@3HA:DWORD			; random_number_seed
EXTRN	?global_options@@3UGLOBAL_OPTIONS_DATA@@A:BYTE	; global_options
_BSS	SEGMENT
?current_music_track@@3W4CD_MUSIC_TRACKS@@A DD 01H DUP (?) ; current_music_track
_BSS	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\cdmusic.c
;	COMDAT ?stop_cd_music@@YGXXZ
_TEXT	SEGMENT
?stop_cd_music@@YGXXZ PROC				; stop_cd_music, COMDAT

; 160  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 40	 sub	 esp, 64			; 00000040H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 161  : 
; 162  : 	if ( current_music_track != CD_MUSIC_TRACK_INVALID )

  00009	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?current_music_track@@3W4CD_MUSIC_TRACKS@@A, 0
  00010	74 0f		 je	 SHORT $LN1@stop_cd_mu

; 163  : 	{
; 164  : 	
; 165  : 		stop_cd_audio ();

  00012	e8 00 00 00 00	 call	 ?stop_cd_audio@@YGXXZ	; stop_cd_audio

; 166  : 	
; 167  : 		current_music_track = CD_MUSIC_TRACK_INVALID;

  00017	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?current_music_track@@3W4CD_MUSIC_TRACKS@@A, 0
$LN1@stop_cd_mu:

; 168  : 	}
; 169  : }

  00021	5f		 pop	 edi
  00022	5e		 pop	 esi
  00023	5b		 pop	 ebx
  00024	8b e5		 mov	 esp, ebp
  00026	5d		 pop	 ebp
  00027	c3		 ret	 0
?stop_cd_music@@YGXXZ ENDP				; stop_cd_music
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File c:\users\nhv90\projects\eech\aphavoc\source\cdmusic.c
;	COMDAT ?play_cd_music@@YGXW4CD_MUSIC_TYPES@@@Z
_TEXT	SEGMENT
tv67 = -72						; size = 4
_track$ = -4						; size = 4
_music_type$ = 8					; size = 4
?play_cd_music@@YGXW4CD_MUSIC_TYPES@@@Z PROC		; play_cd_music, COMDAT

; 87   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 48	 sub	 esp, 72			; 00000048H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 88   : 	cd_music_tracks
; 89   : 		track;
; 90   : 
; 91   : 	// Check that we've got permission to play the track
; 92   : 	if (get_global_sound_music () == GAME_MUSIC_ON)

  00009	83 3d 4c 00 00
	00 02		 cmp	 DWORD PTR ?global_options@@3UGLOBAL_OPTIONS_DATA@@A+76, 2
  00010	0f 85 c2 00 00
	00		 jne	 $LN1@play_cd_mu

; 93   : 	{
; 94   : 		// Never play over an already playing track
; 95   : 		if (!is_cd_audio_playing ())

  00016	e8 00 00 00 00	 call	 ?is_cd_audio_playing@@YGHXZ ; is_cd_audio_playing
  0001b	85 c0		 test	 eax, eax
  0001d	0f 85 b5 00 00
	00		 jne	 $LN1@play_cd_mu

; 96   : 		{
; 97   : 			switch (music_type)

  00023	8b 45 08	 mov	 eax, DWORD PTR _music_type$[ebp]
  00026	89 45 b8	 mov	 DWORD PTR tv67[ebp], eax
  00029	83 7d b8 00	 cmp	 DWORD PTR tv67[ebp], 0
  0002d	74 11		 je	 SHORT $LN6@play_cd_mu
  0002f	83 7d b8 01	 cmp	 DWORD PTR tv67[ebp], 1
  00033	74 21		 je	 SHORT $LN7@play_cd_mu
  00035	83 7d b8 02	 cmp	 DWORD PTR tv67[ebp], 2
  00039	74 5d		 je	 SHORT $LN8@play_cd_mu
  0003b	e9 98 00 00 00	 jmp	 $LN1@play_cd_mu
$LN6@play_cd_mu:

; 98   : 			{
; 99   : 		
; 100  : 				case CD_MUSIC_TYPE_INTRO:
; 101  : 				{
; 102  : 					current_music_track = CD_MUSIC_TRACK_INTRO;

  00040	c7 05 00 00 00
	00 02 00 00 00	 mov	 DWORD PTR ?current_music_track@@3W4CD_MUSIC_TRACKS@@A, 2

; 103  : 
; 104  : 					play_one_shot_cd_audio_track (CD_MUSIC_TRACK_INTRO);

  0004a	6a 02		 push	 2
  0004c	e8 00 00 00 00	 call	 ?play_one_shot_cd_audio_track@@YGXH@Z ; play_one_shot_cd_audio_track

; 105  : 			
; 106  : 					#if DEBUG_MODULE
; 107  : 						debug_filtered_log ("CDMUSIC.C: Playing Intro Tune");
; 108  : 					#endif
; 109  : 		
; 110  : 					break;

  00051	e9 82 00 00 00	 jmp	 $LN1@play_cd_mu
$LN7@play_cd_mu:

; 111  : 				}
; 112  : 		
; 113  : 				case CD_MUSIC_TYPE_COCKPIT:
; 114  : 				{
; 115  : 		
; 116  : 					track = ( cd_music_tracks ) ( CD_MUSIC_TRACK_INGAME1 + (rand16() % NUM_CD_MUSIC_COCKPIT_TRACKS) );

  00056	69 05 00 00 00
	00 6d 4e c6 41	 imul	 eax, DWORD PTR ?random_number_seed@@3HA, 1103515245 ; random_number_seed
  00060	05 39 30 00 00	 add	 eax, 12345		; 00003039H
  00065	a3 00 00 00 00	 mov	 DWORD PTR ?random_number_seed@@3HA, eax ; random_number_seed
  0006a	a1 00 00 00 00	 mov	 eax, DWORD PTR ?random_number_seed@@3HA ; random_number_seed
  0006f	c1 f8 10	 sar	 eax, 16			; 00000010H
  00072	25 ff 7f 00 00	 and	 eax, 32767		; 00007fffH
  00077	99		 cdq
  00078	b9 03 00 00 00	 mov	 ecx, 3
  0007d	f7 f9		 idiv	 ecx
  0007f	83 c2 03	 add	 edx, 3
  00082	89 55 fc	 mov	 DWORD PTR _track$[ebp], edx

; 117  : 					
; 118  : 					current_music_track = track;

  00085	8b 45 fc	 mov	 eax, DWORD PTR _track$[ebp]
  00088	a3 00 00 00 00	 mov	 DWORD PTR ?current_music_track@@3W4CD_MUSIC_TRACKS@@A, eax

; 119  : 		
; 120  : 					play_one_shot_cd_audio_track (track);

  0008d	8b 45 fc	 mov	 eax, DWORD PTR _track$[ebp]
  00090	50		 push	 eax
  00091	e8 00 00 00 00	 call	 ?play_one_shot_cd_audio_track@@YGXH@Z ; play_one_shot_cd_audio_track

; 121  : 		
; 122  : 					#if DEBUG_MODULE
; 123  : 						debug_filtered_log ("CDMUSIC.C: Playing Cockpit Tune, no:%d", current_music_track);
; 124  : 					#endif
; 125  : 		
; 126  : 					break;

  00096	eb 40		 jmp	 SHORT $LN1@play_cd_mu
$LN8@play_cd_mu:

; 127  : 				}
; 128  : 				
; 129  : 				case CD_MUSIC_TYPE_MISSION_COMPLETE:
; 130  : 				{
; 131  : 		
; 132  : 					track = ( cd_music_tracks ) ( CD_MUSIC_TRACK_MISSION_COMPLETE1 + (rand16() % NUM_CD_MUSIC_MISSION_COMPLETE_TRACKS) );

  00098	69 05 00 00 00
	00 6d 4e c6 41	 imul	 eax, DWORD PTR ?random_number_seed@@3HA, 1103515245 ; random_number_seed
  000a2	05 39 30 00 00	 add	 eax, 12345		; 00003039H
  000a7	a3 00 00 00 00	 mov	 DWORD PTR ?random_number_seed@@3HA, eax ; random_number_seed
  000ac	a1 00 00 00 00	 mov	 eax, DWORD PTR ?random_number_seed@@3HA ; random_number_seed
  000b1	c1 f8 10	 sar	 eax, 16			; 00000010H
  000b4	25 ff 7f 00 00	 and	 eax, 32767		; 00007fffH
  000b9	99		 cdq
  000ba	b9 03 00 00 00	 mov	 ecx, 3
  000bf	f7 f9		 idiv	 ecx
  000c1	83 c2 06	 add	 edx, 6
  000c4	89 55 fc	 mov	 DWORD PTR _track$[ebp], edx

; 133  : 					
; 134  : 					current_music_track = track;

  000c7	8b 45 fc	 mov	 eax, DWORD PTR _track$[ebp]
  000ca	a3 00 00 00 00	 mov	 DWORD PTR ?current_music_track@@3W4CD_MUSIC_TRACKS@@A, eax

; 135  : 		
; 136  : 					play_one_shot_cd_audio_track (track);

  000cf	8b 45 fc	 mov	 eax, DWORD PTR _track$[ebp]
  000d2	50		 push	 eax
  000d3	e8 00 00 00 00	 call	 ?play_one_shot_cd_audio_track@@YGXH@Z ; play_one_shot_cd_audio_track
$LN1@play_cd_mu:

; 137  : 		
; 138  : 					#if DEBUG_MODULE
; 139  : 						debug_filtered_log ("CDMUSIC.C: Playing Mission Complete Tune, no:%d", current_music_track);
; 140  : 					#endif
; 141  : 		
; 142  : 					break;
; 143  : 				}
; 144  : 			}
; 145  : 			#if DEBUG_MODULE
; 146  : 				debug_filtered_log ("CDMUSIC.C: Already playing music");
; 147  : 			#endif
; 148  : 		}
; 149  : 		#if DEBUG_MODULE
; 150  : 			debug_filtered_log ("CDMUSIC.C: Music set to OFF");
; 151  : 		#endif
; 152  : 	}
; 153  : }

  000d8	5f		 pop	 edi
  000d9	5e		 pop	 esi
  000da	5b		 pop	 ebx
  000db	8b e5		 mov	 esp, ebp
  000dd	5d		 pop	 ebp
  000de	c2 04 00	 ret	 4
?play_cd_music@@YGXW4CD_MUSIC_TYPES@@@Z ENDP		; play_cd_music
_TEXT	ENDS
END
